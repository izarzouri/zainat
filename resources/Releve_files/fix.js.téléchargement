var NBOOn = false; // Changer la valeur à true pour activer NBO.
var NBOUrl = '/rsc/contrib/script/nbo/nbo.bnpp.min.js'; // version minifié de NBO
// NBOUrl = '/rsc/contrib/script/nbo/nbo.hb.js'; // version non minifié de NBO

var clientSite = "connexion";
if (window.location.host.indexOf('mabanqueprivee') != -1 || window.location.host.indexOf('canalnet-bpf.bnpparibas.net') != -1) {
    $('link').each(function() {
        var tmpHref = $(this).attr('href');
        if (tmpHref.match(/base\.css/)) {
            $(this).attr('href', '/rsc/contrib/css/bpf/base_bpf.css');
        }
    });
    clientSite = "espace-prive";
}
if (window.location.host.indexOf('mabanquepro') != -1 || window.location.host.indexOf('canalnet-pro.bnpparibas.net') != -1) {
    $('link').each(function() {
        var tmpHref = $(this).attr('href');
        if (tmpHref.match(/base\.css/)) {
            $(this).attr('href', '/rsc/contrib/css/pro/base_pro.css');
        }
    });
    clientSite = "espace-pro";
}

$(function() {
    if (ENVIRONNEMENT == 'PREVIEW') {
        $('body').addClass('preview');
    }
    if (ENVIRONNEMENT == 'MACHINE') {
        $('body').addClass('machine');
    }

    if (DeviceSize.getDeviceState() == 'mobile') {
        if (window.location.pathname.indexOf('/banque-contacts/pourquoi-changer') != -1) {
            $('#iframe-toutsurmabanque-pc').height('3240');
        }
        if ($('.portrait-expert').length > 0 && $('#iframe-toutsurmabanque-pc').length > 0) {
            var iframe_expert_interval = setInterval(function() {
                var iframe_doc = $('#iframe-toutsurmabanque-pc').contents();
                if ($(iframe_doc).find('.loaded').length > 0) {
                    var iframe_document = $('#iframe-toutsurmabanque-pc').contents();
                    var iframe_height = $(iframe_document).height();
                    $('#iframe-toutsurmabanque-pc').height(iframe_height);
                    clearInterval(iframe_expert_interval);
                }
            }, 500)
        }
    }
    (function() {
        if ($(document).getUrlParam('rc') == 'webview') {
            $('body').addClass('webview');
        }
    })();


    (function() {
        var interval_ahref = setInterval(function() {
            if ($('a[href=#]').length > 0) {
                $('a[href=#]').on('click', function(e) {
                    e.preventDefault();
                });
                clearInterval(interval_ahref);
            }
        }, 2000);
    })();

    // Si en anglais, redirection sur la page d'accueil en français
    (function() {
        var lang = document.location.pathname.split("/").slice(-2, -1).toString();
        if (lang == 'en' || lang == 'de') {
            if (window.location.host.indexOf('mabanqueprivee') != -1) {
                window.location = '/fr/a-la-une-bpf';
                return;
            }
            if (window.location.host.indexOf('mabanquepro') != -1) {
                window.location = '/fr/a-la-une-pro';
                return;
            }
            // if ((window.location.host.indexOf('mabanque') != -1) && (window.ENVIRONNEMENT !== 'MACHINE')) {
            //     window.location = '/fr/Accueil-part-fr';
            //     return;
            // }
        }
    })();

    (function() {
        var ident_accessible_interval = setInterval(function() {
            if ($('#ia-identification-accessible #ch1').length > 0) {
                clearInterval(ident_accessible_interval);
                $('#ch1').on('blur', function() {
                    if ($(this).val().length >= 7) {
                        var str = "" + $(this).val();
                        var pad = "0000000000";
                        var new_val = pad.substring(0, pad.length - str.length) + str
                        $(this).val(new_val);
                    }
                });
            }
        }, 500);
    })();

    if ($('.abort').is(':visible')) {
        $('.onglet-pagination').addClass('hidden');
    }

    // ajoute lien sur "contacter mon conseiller"
    if (window.location.pathname.indexOf('/fr/connexion/mes-outils/profil/numero-de-mobile') != -1 || window.location.pathname.indexOf('/fr/espace-prive/mes-outils/profil/numero-de-mobile') != -1) {
        var anr_lienConseiller_interval = setInterval(function() {
            if ($('#ia-anr').length > 0 && $('body').hasClass('part')) {
                $('#btn-conseiller').attr('href', '/fr/connexion/mes-outils/messagerie');
            }
            if ($('#ia-anr').length > 0 && $('body').hasClass('bpf')) {
                $('#btn-conseiller').attr('href', '/fr/espace-prive/mes-outils/messagerie');
            }
        }, 500);
    }

    // Taille de l'iframe sur mes documents
    if ($('.ec-mesdocuments').length > 0) {
        setInterval(function() {
            if ($('.ec-mesdocuments iframe#viewer').length > 0) {
                $('.ec-mesdocuments iframe#viewer').height($(window).height());
                $('body').addClass('no-vertical-scroll');
            } else {
                $('body').removeClass('no-vertical-scroll');
            }
        }, 500);
    }

    if (ENVIRONNEMENT == 'PROD' || ENVIRONNEMENT == 'MACHINE') {
        setInterval(function() {
            if ($('.bpf .container-mes-documents').length > 0) {
                if ($('nav .content ul').length > 0) {
                    $("nav .content ul li:contains('Comptes rendus de gestion')").hide()
                }
            }
        }, 500);
    }

    // ajout clic link sur blocs pages hub
    if ($("[id^=wrapper-hub],.fpbpf_decouverte").length > 0) {
        $("[id^=wrapper-hub],.fpbpf_decouverte").find('li').on('click', function() {
            if ($(this).hasClass('fp-non-dispo')) {
                return false;
            }
            var page_href = $(this).find('a').eq(0).attr('href');
            document.location = page_href;
        });
    }

    $('#fp_outilsSim').find('li').prepend('<span class="bientot-dispo">Bientôt <br>disponible</span>');

    $.getJSON('/rsc/contrib/script/client/bientotDisponible.json', function(data) {
        var bientotDisponible = false;
        $.each(data.simulateur, function(index, urlData) {
            if (window.location.pathname == urlData.url && urlData.environnement.indexOf(ENVIRONNEMENT) != -1) {
                $('#fp_outilsSim').find('li').find('.bientot-dispo').remove();
                return false;
            }
        });
    });

    if (window.location.pathname.indexOf('notre-offre/epargne-et-bourse/epargne-logement/compte-epargne-logement') !== -1) {
        $('#fp_complement ul li:first-child').addClass('fp-non-dispo');
    }

    if (typeClientPourMultilingue != "part") {
        var opoprel_interval = setInterval(function() {
            if ($('#opo-prelevement').length > 0) {
                $('#opo-prelevement').attr('id', 'opo-prelevement2').addClass('disable');
                clearInterval(opoprel_interval);
            }
        }, 500);
    }
    if (typeClientPourMultilingue == "bpf") {
        $('.header-connecte-conseiller').removeClass('disable');
    }

    $('#mainMenu nav, #header').find('.disable').on('click', function() {
        initNotAvailablePopup($(this));
        return false;
    });

    $('.header-page.hub-priority').find('.disable').on('click', function() {
        initNotAvailablePopup($(this), $(this).offset());
        return false;
    });
    $('.onglet').find('.disable').on('click', function() {
        initNotAvailablePopup($(this), $(this).offset());
        return false;
    });
    // Delegation car les boutons actions rapides se chargent après le chargement de la page, (#1418660934523 = page opposition)
    $('#1418660934523').on('click', '.disable', function() {
        initNotAvailablePopup($(this));
        return false;
    });

    /* suppression disable nav pro */
    (function() {
        $('#nav7-besoins li.disable').find('a').each(function() {
            if ($(this).attr('href').indexOf("/fr/vos-besoins-pro/vos-besoins-et-projets-professionnels/creer-financer-developper-son-activite") != -1 || $(this).attr('href').indexOf("/fr/vos-besoins-pro/vos-besoins-et-projets-professionnels/gerer-tresorerie-et-excedents") != -1) {
                $(this).parent('li').removeClass('disable').addClass('no-disable');
            }
        })
    })();
    $('#nav7-besoins').find('.no-disable').find('a').on('click', function() {
        window.location.href = $(this).attr('href');
        return false;
    });

    function initNotAvailablePopup($this, offset) {
        if ($('.has-popup-opened').length > 0) {
            $('#tooltip-not-available').remove();
            $('.has-popup-opened').removeClass('has-popup-opened');
            $('.tooltip').removeClass('hidden');
        }
        var link = 'http://www.bnpparibas.net/';

        if ($('body').hasClass('pro')) {
            link = "http://www.bnpparibas.net/banque/portail/entrepros/HomePage?type=site";
        }

        var html = '<span id="tooltip-not-available" class="not-available help-text-popup"><span class="arrow"></span><span class="close pull-right">&#10005;</span><span class="popover-content">Cette fonctionnalité n\'est pas encore accessible sur le nouveau site.</span></span>';

        if ($('body').hasClass('part')) {
            html = '<span id="tooltip-not-available" class="not-available help-text-popup"><span class="arrow"></span><span class="close pull-right">&#10005;</span><span class="popover-content">Cette fonctionnalité sera bientôt disponible.</span></span>';
        }

        if ($('body').hasClass('en')) {
            html = '<span id="tooltip-not-available" class="not-available help-text-popup"><span class="arrow"></span><span class="close pull-right">&#10005;</span><span class="popover-content">Available soon.</span></span>';
        }

        if ($('body').hasClass('bpf')) {
            html = '<span id="tooltip-not-available" class="not-available help-text-popup"><span class="arrow"></span><span class="close pull-right">&#10005;</span><span class="popover-content">Cette fonctionnalité sera bientôt disponible.</span></span>';
        }


        if (offset) {
            $this.addClass('has-popup-opened');
            $('body').append(html)
            $('#tooltip-not-available').css({
                'top': 130,
                'left': Math.round(offset.left)
            });
            if ($this.parents('.header-page.hub-priority').length > 0) {
                $('#tooltip-not-available').css('top', 280);
            }
        } else {
            $this.addClass('has-popup-opened').append(html);
        }

        if ($this.find('.tooltip').length) {
            $this.find('.tooltip').addClass('hidden');
        }

        $('#tooltip-not-available a').on('click', function() {
            var href = $(this).attr('href');
            window.location.href = href;
        });
        $('#tooltip-not-available .close').on('click', function() {
            $(this).parents('li').find('.tooltip').removeClass('hidden');
            $('.has-popup-opened').removeClass('has-popup-opened');
            $('#tooltip-not-available').remove();
            return false;
        });
    }

    (function() {
        // Ajout de la classe no-titulaire sur la barre de recherche
        var titulaire_interval = setInterval(function() {
            if ($('#select-titulaire').length > 0) {
                $('.barre-recherche').removeClass('no-titulaire');
                clearInterval(titulaire_interval);
            } else {
                $('.barre-recherche').addClass('no-titulaire');
            }
        }, 500);


    })();

    (function() {
        // Ajout d'un élément <i> dans les actions rapides
        var icon_interval = setInterval(function() {
            if ($('.row-btn').length > 0) {
                $('.row-btn button.white-box').each(function() {
                    if ($(this).find('i').length == 0) {
                        $(this).prepend('<i />');
                    }
                });
            }
        }, 500);
    })();

    (function() {
        var ldd_interval = setInterval(function() {
            if ($('#form-ldd-etape-1').length > 0) {
                $('.circle-container').eq(0).remove();
                clearInterval(ldd_interval);
            }
        }, 500);
    })();

    (function() {
        var commande_interval = setInterval(function() {
            if ($('.commanderChequier').length > 0) {
                $('.commanderChequier').parents('.actions-rapides').removeClass('no-mob');
                clearInterval(commande_interval);
            }
        }, 500);
    })();

    (function() {
        // Ajout du téléchargement de relevé dans la barre de recherche
        var erreur_livretjeune_interval = setInterval(function() {
            if ($('.veb_erreur_tech').length > 0 || $('.veb_erreur').length > 0) {
                if ($('.veb_erreur_tech').find('p').text() != '') {
                    $('.veb_erreur_tech').show()
                }
                if ($('.veb_erreur').find('p').text() != '') {
                    $('.veb_erreur').show()
                }
                clearInterval(erreur_livretjeune_interval);
            }
        }, 500);
    })();

    (function() {
        // Gestion page contact prevoyance + messagerie
        if (window.location.pathname.indexOf('/fr/nous-contacter/contact-prevoyance') != -1) {
            if ($(document).getUrlParam('ref') !== null) {
              localStorage.setItem("refNextPrev", $(document).getUrlParam('ref'));
            }
        }
        if (window.location.pathname.indexOf('/fr/connexion/mes-outils/messagerie') != -1) {
            var referrer = document.referrer;
            if (localStorage["refNextPrev"] && document.referrer.indexOf('/fr/nous-contacter/contact-prevoyance')!=-1) {
                var newMsgRef_interval = setInterval(function() {
                    if ($('#bouton-nouveau-message').length > 0 && bnpp && bnpp.jquery('#template-liste-messagerie-placeholder h3').length) {
                        clearInterval(newMsgRef_interval);
                        bnpp.jquery("#bouton-nouveau-message").trigger("click");
                        var fillNewMsg_interval = setInterval(function() {
                            if (bnpp.jquery('#object1').length > 0) {
                                clearInterval(fillNewMsg_interval);
                                bnpp.jquery("#object1" ).val("Ma simulation prévoyance n°"+localStorage["refNextPrev"]+" du "+moment().format('DD/MM/YYYY'));
                                bnpp.jquery("#theme1").val("06");
                                bnpp.jquery("#textarea-nouveau-message").val("Bonjour,\n\nJe viens d'effectuer la simulation prévoyance n°"+localStorage["refNextPrev"]+".\n\nJe souhaite prendre un rendez-vous à ce sujet,\n\nDans l'attente de votre retour.").css('height','200px');
                                localStorage.removeItem("refNextPrev");
                            }
                        }, 500);
                    }
                }, 500);
            }
        }
    })();

    /* empêche double-click sur bouton submit anr */
    (function() {
        if (window.location.pathname.indexOf('numero-de-mobile') != -1) {
            var mobile_modif_interval = setInterval(function() {
                if ($('#btn-valider-modif').length > 0) {
                    clearInterval(mobile_modif_interval);
                    $('#btn-valider-modif').parents('form').on('submit', function() {
                        $('#btn-valider-modif').removeClass('btn-primary').addClass('loader');
                        $('#btn-valider-modif').parents('form').off('submit');
                        $('#btn-valider-modif').attr('type', 'button').attr('id', 'btn-valider-modif-disable');
                    });
                }
            }, 500);
        }

        // ajout message Clé Digitale sur confirmation ANR
        if (window.location.pathname.indexOf('/fr/connexion/mes-outils/profil/numero-de-mobile') != -1 || window.location.pathname.indexOf('/fr/espace-prive/mes-outils/profil/numero-de-mobile') != -1 || window.location.pathname.indexOf('/fr/espace-pro/mes-outils/profil/numero-de-mobile') != -1) {
            var cleDigitaleFP = '/fr/notre-offre/comptes-cartes-et-services/gerer-ses-comptes-et-son-budget/gerer-ses-comptes-en-ligne/cle-digitale';
            if ($('body').hasClass('bpf')) {
                cleDigitaleFP = '/fr/nos-solutions-dediees/services-bancaires-au-quotidien/cle-digitale';
            }
            if ($('body').hasClass('pro')) {
                cleDigitaleFP = '/fr/notre-offre-pro/comptes-cartes-et-services/gerer-ses-comptes-en-ligne/cle-digitale';
            }
            var anr_msgCD = '<p><span class="violet">Nouveau</span> Découvrez la Clé Digitale pour activer instantanément vos nouveaux bénéficiaires et augmenter votre plafond de virement.<br>Pour découvrir cette fonctionnalité, <a href="' + cleDigitaleFP + '">cliquez ici</a></p>';
            var anr_msgCD_interval = setInterval(function() {
                if ($('#confirmation').length > 0) {
                    $('.confirmation').append(anr_msgCD);
                    clearInterval(anr_msgCD_interval);
                }
            }, 500);
        }

    })();

    // (function() {
    //     if (window.location.pathname.indexOf('comptes-et-contrats') != -1) {
    //         var udc_msg_interval = setInterval(function() {
    //             if ($('.list-vue1.udc-assurance-vie').length > 0) {
    //                 clearInterval(udc_msg_interval);
    //                 if ( $('body').hasClass('bpf')) {
    //                     $('.list-vue1.udc-assurance-vie').after('<div class="message-assur-vie no-mob"> <div class="row form-info"> <div class="col-90"> <i class="icon pull-left icon-info violet"></i> <p class="violet">Pour des raisons techniques, les opérations de gestion de vos contrats d\'assurance vie seront indisponibles du samedi 5 mars 9h00 au dimanche 6 mars 16h00.<br> Veuillez nous excuser pour la gêne occasionnée</p> </div> </div> </div>');
    //                 }
    //                 else {
    //                     $('.list-vue1.udc-assurance-vie').after('<div class="message-assur-vie no-mob"> <div class="row form-info"> <div class="col-90"> <i class="icon pull-left icon-info violet"></i> <p class="violet">Pour des raisons techniques, les opérations de gestion de vos contrats d\'assurance vie seront indisponibles du samedi 5 mars 9h00 au dimanche 6 mars 16h00.<br> Veuillez nous excuser pour la gêne occasionnée</p> </div> </div> </div>');
    //                 }
    //             }
    //         }, 500);
    //     }
    // })();

    /* fix disable dans nav pro besoins */
    (function() {
        $('#nav7-besoins li.disable').find('a').each(function() {
            if ($(this).attr('href').indexOf("/fr/vos-besoins-pro/vos-besoins-et-projets-professionnels/creer-financer-developper-son-activite") != -1 || $(this).attr('href').indexOf("/fr/vos-besoins-pro/vos-besoins-et-projets-professionnels/gerer-tresorerie-et-excedents") != -1) {
                $(this).parent('li').removeClass('disable');
            }
        })
    })();

    /* Message entete watchlist CCI */
    (function() {
        if (window.location.pathname.indexOf('watchlist') != -1) {
            var watchlist_msg_interval = setInterval(function() {
                if ($('#mainContent').length > 0) {
                    clearInterval(watchlist_msg_interval);
                    $.get('/rsc/contrib/html/bourse/watchlist.html', function(data) {
                        $('#mainContent').prepend(data);
                    });
                }
            }, 500);
        }
    })();

    /* Activation entrée bourse mode connecté */
    (function() {
        if (window.location.pathname.indexOf('/fr/bourse/') != -1 && $('body').hasClass('client') && $('#nav1-client').is(':visible') && ENVIRONNEMENT=="PREVIEW") {
            var navBourse_interval = setInterval(function() {
                if (!$('#nav6-produits').hasClass('selected')) {
                    $('#nav5-portefeuille-bourse').removeClass('selected');
                    $('#nav6-produits').addClass('selected');
                }

            }, 500);
        }
    })();

    (function() {
        if (window.location.pathname.indexOf('/fr/souscription-pro/comptes-cartes-services/releves-en-ligne') != -1 && new Date(2016, 04, 01) <= new Date() && new Date(2016, 05, 10) >= new Date()) {
            var ajoutVisaRio = setInterval(function() {
                if ($('#demat-wrap .row').length > 0) {
                    clearInterval(ajoutVisaRio);
                    $('#demat-wrap .row').find('.btn-primary.pull-right').addClass('btn-secondary');
                    $('#demat-wrap .row').find('.btn-primary.pull-right').removeClass('btn-primary');
                    $('#demat-wrap .row').find('.btn-primary.pull-right.jeu').addClass('btn-primary');
                    $('#demat-wrap .row').find('br').remove('');
                    setTimeout($('#demat-wrap .row').prepend('<a class="btn-primary pull-right jeu" href="/fr/souscription-pro/comptes-cartes-services/jeu-releve-en-ligne-pro" style="margin-left:20px;">Accéder au tirage au sort</a>'), 1000);
                }
            }, 500);
        }
    })();

    /* temp remplacement souscription carte bnp net */
    (function() {
        if (window.location.pathname.indexOf('/comptes-et-contrats/mes-cartes/carte-formule-bnp-net') != -1) {
            var bnpnet_msg_interval = setInterval(function() {
                if ($('#mainContent').length > 0) {
                    clearInterval(bnpnet_msg_interval);
                    $('#id_balise_div').addClass('hidden');
                    $('.show-bnpnet').click(function(e) {
                        e.preventDefault();
                        //if ( ENVIRONNEMENT == "PREVIEW" || ENVIRONNEMENT == "MACHINE" ) {
                        $('#wcm-l-bnpnet-dispatch').find('header').addClass('hidden');
                        $('#dispatch-bloc').addClass('hidden');
                        $('#id_balise_div').removeClass('hidden');
                        $('body.bpf #id_balise_div .row-footer button').remove();
                        /*}
                        else {
                            $('#dispatch-bloc').addClass('hidden');
                            $('#bnpnet-block').removeClass('hidden');
                        }*/

                    });
                }
            }, 500);
        }
    })();


    (function() {
        // mode webview bpf : masquage premier bloc
        if (window.location.pathname.indexOf('services-bancaires-au-quotidien') != -1 && $('body').hasClass('webview')) {
            $('.fpbpf_decouverte li').first().remove();
        }
    })();

    //  (function() {
    //     // ajout message erreur pour arbitrage
    //     var mefav_arbitrage = $(document).getUrlParam('redir');
    //     var temp_msg = '<div class="details form-info"><i class="icon icon-info violet pull-left"></i><p class="violet">Nous vous confirmons que vous bénéficiez de frais d\'arbitrage réduits à 0,50 % dans le cadre de l\'Offre du moment. Suite à une anomalie le message ci-dessus "frais d\'arbitrage à 0%" est erroné.</p></div>';
    //     if (mefav_arbitrage == "arbitrage") {
    //         var add_message_arbitrage_interval = setInterval( function() {
    //             if ( $('.investissement-arbitrage').length > 0 && $('.row.details.end').length > 0 ) {
    //                 $('.investissement-arbitrage > .whiteBG > .details.end').before(temp_msg);
    //                 clearInterval(add_message_arbitrage_interval);
    //             }
    //         }, 500);
    //     }
    // })();

    (function() {
        var mouvement_interval = setInterval(function() {
            if ($('.qa-fam4-mouvements').length > 0) {
                $('.qa-fam4-mouvements').off('click');
                clearInterval(mouvement_interval);
                $('.qa-fam4-mouvements').on('click', function() {
                    if ($('body').hasClass('part')) {
                        window.location = '/fr/connexion/portefeuille-et-bourse/mouvements';
                    }
                    if ($('body').hasClass('bpf')) {
                        window.location = '/fr/espace-prive/portefeuille-et-bourse/mouvements';
                    }
                    if ($('body').hasClass('pro')) {
                        window.location = '/fr/espace-pro/portefeuille-et-bourse/mouvements';
                    }
                    return false;
                });
            }
        }, 500);
    })();
    (function() {
        var pagination = '<div class="onglet-pagination unselectable" style="right: 0;"><span class="onglet-prev pointer disabled"></span><span class="onglet-next pointer"></span></div>';
        var mrh_interval = setInterval(function() {
            if ($('#ia-mrh .onglet').length > 0) {
                clearInterval(mrh_interval)
                if ($('.onglet-pagination').length == 0) {
                    $('#ia-mrh').find('.onglet').after(pagination);
                }
                if ($('.onglet-nav').length == 0) {
                    $(".onglet,.onglet-pagination").wrapAll("<div class='onglet-nav' />")
                }
                var offre_global_interval = setInterval(function() {
                    if ($('[code="2"] a').length > 0) {
                        clearInterval(offre_global_interval);
                        $(' [code="2"] a').click();
                    }
                }, 200);
                setTimeout(function() {
                        GlobalSite.slideOnglet();
                    }, 2000)
                    // clearInterval(mrh_interval);
            }
        }, 1000);
    })();

    (function() {
        // // Envoie checkstatus sur synthèse patrimoniale
        if ($('.onglet-nav').attr('data-checkstatus') == 'checkAutreCompte' && window.location.href.indexOf('synthese-patrimoniale') > 0) {
            checkStatus();
            $('#synthese-patrimoniale').addClass('active');
        }
    })();

    (function() {
        var current_url = document.URL,
            module = current_url.substr(current_url.lastIndexOf('/') + 1);

        if (module == '') {
            var current_url_parts = current_url.split('/');
            module = current_url_parts[current_url_parts.length - 2];
        }

        function redirectVirement() {
            // Virement aiguillage
            var virement_permanent_url = '/aiguillage-wspl/redirect/creer-virement-permanent',
                ajouter_beneficiaire_url = '/aiguillage-wspl/redirect/ajouter-beneficiaire',
                virement_unitaire_url = '/aiguillage-wspl/redirect/virement';

            // TEST SUR VIREMENT UNITAIRE
            if (module.indexOf('virements') !== -1) {
                var cpt_id_permanent = setInterval(function() {
                    if ($('#goto-virement-permanent').length > 0) {
                        $('body').on('click', '#goto-virement-permanent', function() {
                            window.location.href = virement_permanent_url;
                            return false;
                        });
                        clearInterval(cpt_id_permanent);
                    }
                }, 200);

                var cpt_id_beneficiaire = setInterval(function() {
                    if ($('#goto-virement-beneficiaire').length > 0) {
                        $('body').on('click', '#goto-virement-beneficiaire', function() {
                            window.location.href = ajouter_beneficiaire_url;
                            return false;
                        });
                        clearInterval(cpt_id_beneficiaire);
                    }
                }, 200);
                return;
            }

            // TEST SUR HISTORIQUE
            if (module.indexOf('historique') !== -1) {
                var cpt_id_unitaire = setInterval(function() {
                    if ($('#goto-virement-unitaire').length > 0) {
                        $('body').on('click', '#goto-virement-unitaire', function() {
                            window.location.href = virement_unitaire_url;
                            return false;
                        });
                        clearInterval(cpt_id_unitaire);
                    }
                }, 200);

                return;
            }
        }

        redirectVirement();

        /**
         * Désactive les liens sur assurance vie / epargne retraite / titre / capitalisation
         * sur la vue liste de la udc
         */
        function disableLinkListe() {
            if (module.indexOf('comptes-et-contrats') !== -1) {
                var rustineHTML = '<div class="rustine-udc-noclick"></div>';
                // if ( ENVIRONNEMENT == 'PROD' || ENVIRONNEMENT == 'MACHINE') {
                //     var cpt_id_udctitres = setInterval(function() {
                //         if ( $('.udc-titre').length > 0 ) {
                //             $('.udc-titre li').prepend(rustineHTML);
                //             clearInterval(cpt_id_udctitres);
                //         }
                //     }, 200);
                // }

                // var cpt_id_udcassurancevie = setInterval(function() {
                //     if ( $('.udc-assurance-vie').length > 0 ) {
                //         $('.udc-assurance-vie li').prepend(rustineHTML);
                //         clearInterval(cpt_id_udcassurancevie);
                //     }
                // }, 200);

                // var cpt_id_udccapitalisation = setInterval(function() {
                //     if ( $('.udc-capitalisation').length > 0 ) {
                //         $('.udc-capitalisation li').prepend(rustineHTML);
                //         clearInterval(cpt_id_udccapitalisation);
                //     }
                // }, 200);

                // var cpt_id_udcepargneretraite = setInterval(function() {
                //     if ( $('.udc-epargne-retraite').length > 0 ) {
                //         $('.udc-epargne-retraite li').prepend(rustineHTML);
                //         clearInterval(cpt_id_udcepargneretraite);
                //     }
                // }, 200);

                $('body').on('click', '.rustine-udc-noclick', function() {
                    $('#tooltip-not-available').remove();
                    if ($(this).parent('.has-popup-opened').length > 0) {
                        $(this).parent('.has-popup-opened').removeClass('has-popup-opened');
                    }
                    var html = '<span id="tooltip-not-available" class="not-available help-text-popup top"><span class="close pull-right">&#10005;</span><span class="popover-content">Ce relevé d\'opérations n\'est pas encore accessible sur le nouveau site.</span><span class="row fleche"></span></span>';

                    $(this).parent('li').addClass('has-popup-opened').append(html);
                    $('#tooltip-not-available .close').on('click', function() {
                        $('#tooltip-not-available').remove();
                        $('.has-popup-opened').removeClass('has-popup-opened');
                        return false;
                    });
                    return false;
                });
            }
        }
        /**
         * Désactive les liens sur assurance vie / epargne retraite / titre / capitalisation
         * sur la vue mosaique de la udc
         */
        function disableLinkMosaique() {
            if (module.indexOf('comptes-et-contrats') !== -1) {
                var rustineHTML = '<div class="rustine-udc-mosaique-noclick"></div>';
                // if ( ENVIRONNEMENT == 'PROD' || ENVIRONNEMENT == 'MACHINE') {
                // var cpt_id_udctitres = setInterval(function() {
                //     if ( $('.udc-titre').length > 0 ) {
                //         $('.udc-titre').prepend(rustineHTML);
                //         $('.rustine-udc-mosaique-noclick').css({
                //             position: absolute,
                //             height: $('.list-vue1.udc-titre').height(),
                //             width: "100%"
                //         })
                //         clearInterval(cpt_id_udctitres);
                //     }
                // }, 200);
                // }

                // var cpt_id_udcassurancevie = setInterval(function() {
                //     if ( $('.udc-assurance-vie').length > 0 ) {
                //         $('.udc-assurance-vie').prepend(rustineHTML);
                //         clearInterval(cpt_id_udcassurancevie);
                //     }
                // }, 200);

                // var cpt_id_udccapitalisation = setInterval(function() {
                //     if ( $('.udc-capitalisation').length > 0 ) {
                //         $('.udc-capitalisation').prepend(rustineHTML);
                //         clearInterval(cpt_id_udccapitalisation);
                //     }
                // }, 200);

                // var cpt_id_udcepargneretraite = setInterval(function() {
                //     if ( $('.udc-epargne-retraite').length > 0 ) {
                //         $('.udc-epargne-retraite').prepend(rustineHTML);
                //         clearInterval(cpt_id_udcepargneretraite);
                //     }
                // }, 200);

                $('body').on('click', '.rustine-udc-mosaique-noclick', function() {
                    $('#tooltip-not-available').remove();
                    if ($(this).parent('.has-popup-opened').length > 0) {
                        $(this).parent('.has-popup-opened').removeClass('has-popup-opened');
                    }
                    var html = '<span id="tooltip-not-available" class="not-available help-text-popup top"><span class="close pull-right">&#10005;</span><span class="popover-content">Ce relevé d\'opérations n\'est pas encore accessible sur le nouveau site.<br></span><span class="row fleche"></span></span>';

                    $(this).parent('li').addClass('has-popup-opened').append(html);
                    $('#tooltip-not-available .close').on('click', function() {
                        $('#tooltip-not-available').remove();
                        $('.has-popup-opened').removeClass('has-popup-opened');
                        return false;
                    });
                    return false;
                });
            }
        }

        /**
         * Corrige l'aiguillage du bouton retour de la page mes-outils/profil/numero-de-mobile
         * l'aiguillage correct est mes-outils/profil/
         */
        function fixProfilBtn() {
            if (module.indexOf('numero-de-mobile') !== -1) {

                var univers = 'connexion';
                if (document.URL.indexOf('espace-prive') !== -1) {
                    univers = 'espace-prive';
                }

                var routine = setInterval(function() {
                    if ($('#btn-retour-profil').length > 0) {
                        var nextEl = $('#btn-retour-profil').next();
                        $('#btn-retour-profil').unbind().remove();
                        nextEl.before('<a href="/fr/' + univers + '/mes-outils/profil/" class="btn-primary pull-right" >Retour</a>');

                        clearInterval(routine);
                    }
                }, 100);
            }
        }

        fixProfilBtn();

        // Désactive les liens sur vue liste
        disableLinkListe();

        $('body').on('click', '.active-mosaique', function() {
            disableLinkMosaique();
        });
        $('body').on('click', '.active-liste', function() {
            disableLinkListe();
        });


        // Erreur technique, affichage des paramètres pour MOE
        // if ( module.indexOf('erreur-technique') != -1 ) {
        //     var id = $(document).getUrlParam('ID');
        //     var eq = $(document).getUrlParam('eq');
        //     $('#mainContent').append('<div id="tech-error-log" class="hidden">ID: '+ id +' eq: '+ eq +'</p></div>');
        // }
    })();
    (function() {
        var cpCookies = {
            getItem: function(sKey) {
                if (!sKey) {
                    return null;
                }
                return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*" + encodeURIComponent(sKey).replace(/[\-\.\+\*]/g, "\\$&") + "\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1")) || null;
            },
            setItem: function(sKey, sValue, vEnd, sPath, sDomain, bSecure) {
                if (!sKey || /^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)) {
                    return false;
                }
                var sExpires = "";
                if (vEnd) {
                    switch (vEnd.constructor) {
                        case Number:
                            sExpires = vEnd === Infinity ? "; expires=Fri, 31 Dec 9999 23:59:59 GMT" : "; max-age=" + vEnd;
                            break;
                        case String:
                            sExpires = "; expires=" + vEnd;
                            break;
                        case Date:
                            sExpires = "; expires=" + vEnd.toUTCString();
                            break;
                    }
                }
                document.cookie = encodeURIComponent(sKey) + "=" + encodeURIComponent(sValue) + sExpires + (sDomain ? "; domain=" + sDomain : "") + (sPath ? "; path=" + sPath : "") + (bSecure ? "; secure" : "");
                return true;
            },
            removeItem: function(sKey, sPath, sDomain) {
                if (!this.hasItem(sKey)) {
                    return false;
                }
                document.cookie = encodeURIComponent(sKey) + "=; expires=Thu, 01 Jan 1970 00:00:00 GMT" + (sDomain ? "; domain=" + sDomain : "") + (sPath ? "; path=" + sPath : "");
                return true;
            },
            hasItem: function(sKey) {
                if (!sKey) {
                    return false;
                }
                return (new RegExp("(?:^|;\\s*)" + encodeURIComponent(sKey).replace(/[\-\.\+\*]/g, "\\$&") + "\\s*\\=")).test(document.cookie);
            },
            keys: function() {
                var aKeys = document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g, "").split(/\s*(?:\=[^;]*)?;\s*/);
                for (var nLen = aKeys.length, nIdx = 0; nIdx < nLen; nIdx++) {
                    aKeys[nIdx] = decodeURIComponent(aKeys[nIdx]);
                }
                return aKeys;
            }
        };
        //
        function removeCpCookie() {
            if (cpCookies.getItem('cp.old') != '' || cpCookies.getItem('cp.rnd') != '' || cpCookies.getItem('cp.sign') != '' || cpCookies.getItem('cp.sta') != '' || cpCookies.getItem('cp.uid') != '' || cpCookies.getItem('cp.echonet') != '' || cpCookies.getItem('cp.new') != '' || cpCookies.getItem('cp.pref') != '') {
                cpCookies.removeItem('cp.old', '/', '.bnpparibas.net');
                cpCookies.removeItem('cp.rnd', '/', '.bnpparibas.net');
                cpCookies.removeItem('cp.sign', '/', '.bnpparibas.net');
                cpCookies.removeItem('cp.sta', '/', '.bnpparibas.net');
                cpCookies.removeItem('cp.uid', '/', '.bnpparibas.net');
                cpCookies.removeItem('cp.echonet', '/', '.bnpparibas.net');
                cpCookies.removeItem('cp.new', '/', '.bnpparibas.net');
                cpCookies.removeItem('cp.pref', '/', '.bnpparibas.net');
            }
        }
        removeCpCookie();
    })();

    (function() {
        var espritlibre_interval = setInterval(function() {
            if ($('#ia-espritlibre .esprit-libre').length > 0) {
                $('#ia-espritlibre a:contains("Découvrir les formules Esprit Libre")').attr('href', '/fr/notre-offre/comptes-cartes-et-services/comptes-et-formules')
                clearInterval(espritlibre_interval);
            }
        }, 500)
    })();

    (function() {
        $('#accueil_particuliers #accueil-btn a').on('click', function(e) {
            e.preventDefault();

            var videoURL = "https://www.youtube.com/embed/id51dtplcDA?rel=0&amp;autoplay=1";

            if ($(this).parents('.pro').length > 0) {
                videoURL = "https://www.youtube.com/embed/cvDW-cHdp3s?rel=0&amp;autoplay=1";
            }

            $('body').append('<div class="popin-cache"></div>');
            $('body').append('<div class="topMiddle popin popin-fixed" id="popinvideo"><a class="close popin-close">✕</a><iframe width="853" height="480" src="' + videoURL + '" frameborder="0" allowfullscreen></iframe></div>');
            $('#popinvideo').css({
                'width': '853px',
                'height': '480px',
                'z-index': 999
            }).find('.popin-close').css({
                'position': 'absolute',
                'top': '-30px',
                'right': 0
            });
            $('.popin-cache').css({
                'z-index': 998
            });
            $('#popinvideo .popin-close').add($('.popin-cache')).on('click', function() {
                $('#popinvideo').add($('.popin-cache')).remove();
            });
            $('#popinvideo iframe').css({
                'min-height': '1px',
                'margin': 0,
                'padding': 0
            });

            $('#popinvideo').add($('.popin-cache')).fadeIn(200);
        });
    })();

    (function() {
        if (window.location.href.indexOf('nos-solutions-dediees') != -1) {
            if (window.location.href.indexOf('?rc=webview') != -1) {
                localStorage.nos_solutions_dediees = "acceptConnection";
            } else if (localStorage.nos_solutions_dediees === "acceptConnection") {
                $('body').addClass('webview');
            }
        }
        // if($('body').hasClass('bpf') && $('.bouton-espace-client').css('display')==='block'){
        //     $('.bouton-devenir-client').removeClass('part-only');
        //     $('.bouton-devenir-client').addClass('bpf-only');
        //     $('.bouton-devenir-client').attr('href','/fr/banque-contact/nous-contacter');
        // }
        var block_inline = $('body').hasClass('bpf') && $('.bouton-espace-client').css('display');
        if ((block_inline === 'block') || (block_inline === 'inline')) {
            $('.bouton-devenir-client').removeClass('part-only');
            $('.bouton-devenir-client').addClass('bpf-only');
            $('.bouton-devenir-client').attr('href', '/fr/banque-contact/nous-contacter');
        }
    })();

    (function() {
        $('.ex-video').on('click', function(e) {
            e.preventDefault();

            //$('body').append('<div class="topMiddle popin popin-fixed" id="popinvideo"><a class="close popin-close">✕</a><iframe width="853" height="480" src="https://www.youtube.com/embed/LmsbHQQLfgs?rel=0&amp;autoplay=1" frameborder="0" allowfullscreen></iframe></div>');
            //$('body').append('<div class="topMiddle popin popin-fixed" id="popinvideo"><a class="close popin-close">✕</a><iframe width="853" height="480" src="https://www.youtube.com/embed/6Ctv22kd13M?rel=0&amp;autoplay=1" frameborder="0" allowfullscreen></iframe></div>');
            //$('body').append('<div class="topMiddle popin popin-fixed" id="popinvideo"><a class="close popin-close">✕</a><iframe width="853" height="480" src="https://www.youtube.com/embed/N08FCGwmmQg?rel=0&amp;autoplay=1" frameborder="0" allowfullscreen></iframe></div>');
            //$('body').append('<div class="topMiddle popin popin-fixed" id="popinvideo"><a class="close popin-close">✕</a><iframe width="560" height="315" src="https://www.youtube.com/embed/vkRljbvMfxs"; frameborder="0" allowfullscreen></iframe></div>');
            //$('body').append('<div class="topMiddle popin popin-fixed" id="popinvideo"><a class="close popin-close">✕</a><iframe width="560" height="315" src="https://www.youtube.com/embed/tSIEA-1NkiE"; frameborder="0" allowfullscreen></iframe></div>');
            //$('body').append('<div class="topMiddle popin popin-fixed" id="popinvideo"><a class="close popin-close">✕</a><iframe width="560" height="315" src="https://www.youtube.com//embed/BdT95HTsU2k"; frameborder="0" allowfullscreen></iframe></div>');
            //$('body').append('<div class="topMiddle popin popin-fixed" id="popinvideo"><a class="close popin-close">✕</a><iframe width="560" height="315" src="https://www.youtube.com/embed/lVpdXFV3ZoI"; frameborder="0" allowfullscreen></iframe></div>');
            $('body').append('<div class="topMiddle popin popin-fixed" id="popinvideo"><a class="close popin-close">✕</a><iframe width="560" height="315" src="https://www.youtube.com/embed/5AC0iJibdHw"; frameborder="0" allowfullscreen></iframe></div>');
            $('#popinvideo').css({
                'width': '853px',
                'height': '480px',
                'z-index': 999
            }).find('.popin-close').css({
                'position': 'absolute',
                'top': '-30px',
                'right': 0
            });
            $('.popin-cache').css({
                'z-index': 998
            });
            $('#popinvideo .popin-close').add($('.popin-cache')).on('click', function() {
                $('#popinvideo').add($('.popin-cache')).remove();
            });
            $('#popinvideo iframe').css({
                'min-height': '1px',
                'margin': 0,
                'padding': 0
            });

            $('#popinvideo').add($('.popin-cache')).fadeIn(200);
        });
    })();

    // delete sub-titles of home bpf mobile version
    (function() {
        if ($(window).width() < 800) {
            $('#wapper-home-bpf .xml-section .level4').not('.bpf-home-actus').find('a').parent().prev().addClass('hidden');
        } else {
            $('#wapper-home-bpf .xml-section .level4').not('.bpf-home-actus').find('a').parent().prev().removeClass('hidden');
        }
    })();

    (function() {

        if (DeviceSize.getDeviceState() == "mobile") {
            return;
        }

        /* *********************************************************************** */
        /* *********** Valeur du pourcentage du chart de l'accueil *************** */
        /* *********************************************************************** */

        var pourcentagesCharts = {

            "part": {
                "actif": 0,
                "valeur": 0
            },
            "pro": {
                "actif": 0,
                "valeur": 75
            },
            "bpf": {
                "actif": 0,
                "valeur": 85
            }
        };


        /* *********************************************************************** */
        /* *********************************************************************** */
        /* *********************************************************************** */

        if ($('#accueil_particuliers #content_accueil_part #accueil-btn').length > 0 && document.URL.match(/Accueil-part-fr|a-la-une-pro|a-la-une-bpf/)) {

            if ($('body').hasClass('part') && pourcentagesCharts.part.actif == 0) {
                return;
            }
            if ($('body').hasClass('pro') && pourcentagesCharts.pro.actif == 0) {
                return;
            }
            if ($('body').hasClass('bpf') && pourcentagesCharts.bpf.actif == 0) {
                return;
            }


            var accueilDiv = $('#content_accueil_part'),
                accueilChartPourc = (document.URL.match(/Accueil-part-fr/)) ? pourcentagesCharts.part.valeur : ((document.URL.match(/a-la-une-pro/)) ? pourcentagesCharts.pro.valeur : ((document.URL.match(/a-la-une-bpf/)) ? pourcentagesCharts.bpf.valeur : null));

            accueilDiv.addClass('graph');
            var pCode = accueilDiv.children('p:not(#accueil-btn)').html();
            accueilDiv.children('p:not(#accueil-btn)').remove();
            accueilDiv.children('#accueil-btn').before('<div><canvas width="150" height="150"></canvas><div class="popover"><p>Votre site s\'enrichit jour après jour.<br><br>Nous sommes actuellement à <span>' + accueilChartPourc + '%</span> des fonctionnalités du futur site.</p></div><p>' + pCode + '</p></div>');

            waitForFontLoaded('bnpp_sans_condensed_light', function() {

                if (DeviceSize.getDeviceState() == "mobile") {
                    var $canvas = accueilDiv.find('canvas'),
                        canvasW = Math.round($canvas.attr('width') * 2 / 3),
                        canvasH = Math.round($canvas.attr('height') * 2 / 3);

                    $canvas.css({
                        'width': canvasW + 'px',
                        'height': canvasH + 'px'
                    }).attr('width', canvasW).attr('height', canvasH);
                }

                try {
                    accueilChart = new Chart(accueilDiv.find('canvas').get(0).getContext("2d")).accueilCircle({
                        pourc: accueilChartPourc
                    });

                    var popover = accueilDiv.find('.popover');
                    accueilDiv.on('mouseenter', 'canvas', function() {
                        if (!popover.is(':visible')) {
                            // popover.stop().fadeIn(200);
                            popover.stop().show();
                        }
                    }).on('mouseout', function() {
                        if (popover.is(':visible')) {
                            // popover.stop().fadeOut(100);
                            popover.stop().hide();
                        }
                    });
                } catch (e) {
                    trace(e);
                }

            });
        } else if ($('#wapper-home-bpf .level3.bpf-home-header').length > 0 && document.URL.match(/a-la-une-bpf/)) {
            // if( $('body').hasClass('bpf') && pourcentagesCharts.bpf.actif == 0 ){ return; }
            var targetDiv = $('#wapper-home-bpf .level3.bpf-home-header'),
                accueilChartPourc = pourcentagesCharts.bpf.valeur,
                code = '<div id="pourcDiv"><h2>Votre site change<br> progressivement</h2><div class="row"><div class="popover" style="display: none;"><p>Votre site s\'enrichit jour après jour.<br><br>Nous sommes actuellement à <span>' + accueilChartPourc + '%</span> des fonctionnalités du futur site.</p></div></div><p id="accueil-btn"><a href="http://toutsurmabanqueprivee.bnpparibas.net"><span class="pointer btn-primary">Tout savoir sur le nouveau site</span></a></p></div>';

            targetDiv.after(code);
            var pourcDiv = targetDiv.next();

            waitForFontLoaded('bnpp_sans_condensed_light', function() {

                if (DeviceSize.getDeviceState() == "mobile") {
                    var $canvas = pourcDiv.find('canvas'),
                        canvasW = Math.round($canvas.attr('width') * 2 / 3),
                        canvasH = Math.round($canvas.attr('height') * 2 / 3);

                    $canvas.css({
                        'width': canvasW + 'px',
                        'height': canvasH + 'px'
                    }).attr('width', canvasW).attr('height', canvasH);
                }

                try {
                    accueilChart = new Chart(pourcDiv.find('canvas').get(0).getContext("2d")).accueilCircle({
                        pourc: accueilChartPourc,
                        color: "#b2965d"
                    });

                    var popover = pourcDiv.find('.popover');
                    pourcDiv.on('mouseenter', 'canvas', function() {
                        if (!popover.is(':visible')) {
                            popover.stop().fadeIn(200);
                        }
                    }).on('mouseout', function() {
                        if (popover.is(':visible')) {
                            popover.stop().fadeOut(100);
                        }
                    });
                } catch (e) {
                    trace(e);
                }

            });

        }
    })();

    //Redéfinit la taille de l'iframe de la page /banque-contacts/pourquoi-changer et /banque-contacts/en-pratique
    (function() {
        return; //Annulé
        var iframeToutSurMaBanque = $('[id*="pourquoi-changer"] iframe[id="iframe-toutsurmabanque-pc"]');
        if (iframeToutSurMaBanque.length > 0) {
            if (DeviceSize.getDeviceState() == "mobile") {
                resizeEl(iframeToutSurMaBanque, 300, "100%");
            }
            $(window).resize(function() {
                if (DeviceSize.getDeviceState() == "mobile") {
                    resizeEl(iframeToutSurMaBanque, 300, "100%");
                } else {
                    resizeEl(iframeToutSurMaBanque, 650, "100%");
                }
            });
        }

        var iframeEnPratique = $('[id*="en-pratique"] iframe[id="iframe-toutsurmabanque-ep"]');
        if (iframeEnPratique.length > 0) {
            iframeEnPratique.on('load', function() {
                iframeEnPratiqueResize();
            });
            iframeEnPratiqueResize();
            $(window).resize(function() {
                iframeEnPratiqueResize();
            });
        }

        function iframeEnPratiqueResize() {
            var iframeEnPratiqueContents = iframeEnPratique.contents();
            resizeEl(iframeEnPratique, iframeEnPratiqueContents.find('#root').outerHeight(true), "100%");
        }

        function resizeEl(el, h, w) {
            el.attr('height', h).attr('width', w).css({
                height: h + 'px',
                width: w + 'px',
                'min-height': '1px',
                'min-width': '1px'
            });
        }
    })();

    (function() {

        ////////////////////////////////////////////////// ancien code ////////////////////////////////////////////
        if ($('#nav_bpf').length == 0) {
            return;
        }

        var url = '/';
        if (document.referrer != '' && document.referrer.indexOf(window.location.host) != -1) {
            url = document.referrer;
        }

        if ((typeClientPourMultilingue == 'bpf' && (window.sessionStorage.getItem('info_client') == null || window.sessionStorage.getItem('info_client') == 'null')) ||
            (typeClientPourMultilingue == 'bpf' && window.sessionStorage.getItem('info_client') != null && window.location.pathname.startsWith("/fr/nos-solutions-dediees/services-bancaires-au-quotidien/cle-digitale"))
        ) {

            var back_button = '<div class="onglet-back"><a href="' + url + '">Retour</a></div>';
            $('.onglet-nav').addClass('has-back').prepend(back_button);
            GlobalSite.slideOnglet();

            var chg_url = setInterval(function() {

                var pathname = window.location.pathname;
                var pathname_split = pathname.split('/');

                if (pathname_split.length > 3) {

                    if (pathname.match(/decouvrir-la-banque-privee/) != null && pathname.match(/actualites-et-presse/) != null) {
                        var url = '/fr/decouvrir-la-banque-privee/actualites-et-presse';
                        returnToHub(url);
                    } else {
                        pathname_split.splice(-1, pathname_split.length - 1);
                        var hub_url = pathname_split.join('/');
                        var url = hub_url;

                        returnToHub(url);
                    }
                }

                function returnToHub(url) {
                    $(".onglet-back").find('a').attr('href', url);
                }

                // Clear setInterval
                if ($('.onglet-back').length > 0) {
                    clearInterval(chg_url);
                }

            }, 500);
        }

        ////////////////////////////////////////////////// END ancien code ////////////////////////////////////////////

    })();

    (function() {
        if (window.location.pathname.indexOf('comptes-et-contrats/releve-operations') !== -1 || (window.location.pathname == '/fr/connexion/comptes-et-contrats' && (ENVIRONNEMENT == 'PREVIEW' || ENVIRONNEMENT == 'MACHINE'))) {
            $('body').addClass('print');
        }
    })();

    /* fix hide grille en prod */
    (function() {
        var grille_opacity = setInterval(function() {
            if ($('#ia-identification').length > 0 && $('.field-password').length > 0) {
                $('form[name="logincanalnetbis"]').addClass('off');
                $("#client-nbr").on('propertychange change click keyup input paste', function() {
                    if ($(this).val() != "") {
                        $('form[name="logincanalnetbis"]').removeClass('off');
                    } else {
                        $('form[name="logincanalnetbis"]').addClass('off');
                    }
                });
                $('#initClient').click(function() {
                    $('form[name="logincanalnetbis"]').addClass('off');
                })
                clearInterval(grille_opacity);
            }
        }, 500);
    })();

    /* fix hide grille pour preview */
    (function() {
        var grille_opacity = setInterval(function() {
            if ($('#ia-identification').length > 0 && $('.field-password').length > 0) {
                $('.field-password').addClass('off');
                $("#client-nbr").on('propertychange change click keyup input paste', function() {
                    if ($(this).val() != "") {
                        $('.field-password').removeClass('off');
                    } else {
                        $('.field-password').addClass('off');
                    }
                });
                $('#initClient').click(function() {
                    $('.field-password').addClass('off');
                })
                clearInterval(grille_opacity);
            }
        }, 500);
    })();


    (function() {
        /* Ajout code projet sur pages prets-persos
        // 101 = Auto
        // 111 = Auto écolo
        // 102 = Appareils Numériques
        // 155 = Mariage
        // 151 = Travaux
        // 105 = Divers
        */
        if (window.location.pathname.indexOf('credits/credits-a-la-consommation/prets-personnels/pret-auto-ecologique') !== -1) {
            var _href = $('a.toSimu').attr('href');
            $('a.toSimu').attr('href', _href + "?rc=111");
            return;
        }
        if (window.location.pathname.indexOf('credits/credits-a-la-consommation/prets-personnels/pret-auto') !== -1) {
            var _href = $('a.toSimu').attr('href');
            $('a.toSimu').attr('href', _href + "?rc=101");
            return;
        }
        if (window.location.pathname.indexOf('credits/credits-a-la-consommation/prets-personnels/pret-divers') !== -1) {
            var _href = $('a.toSimu').attr('href');
            $('a.toSimu').attr('href', _href + "?rc=105");
            return;
        }
        if (window.location.pathname.indexOf('credits/credits-a-la-consommation/prets-personnels/pret-mariage') !== -1) {
            var _href = $('a.toSimu').attr('href');
            $('a.toSimu').attr('href', _href + "?rc=155");
            return;
        }
        if (window.location.pathname.indexOf('credits/credits-a-la-consommation/prets-personnels/pret-digital') !== -1) {
            var _href = $('a.toSimu').attr('href');
            $('a.toSimu').attr('href', _href + "?rc=102");
            return;
        }
        if (window.location.pathname.indexOf('credits/credits-a-la-consommation/prets-personnels/pret-travaux') !== -1) {
            var _href = $('a.toSimu').attr('href');
            $('a.toSimu').attr('href', _href + "?rc=151");
            return;
        }
    })();

    (function() {
        /* Selection auto projet pour prets perso page simu/souscription
        // 101 = Auto
        // 111 = Auto écolo
        // 102 = Appareils Numériques
        // 155 = Mariage
        // 151 = Travaux
        // 105 = Divers
        */
        // var selectPPI = setInterval(function() {
        //     if ($("#simulateur-credit-ppi-wrapper").length > 0 && $('#codeProjet').length > 0) {
        //         var projectType = $(document).getUrlParam('rc');
        //         var authorizedTypes = [101, 111, 102, 155, 151, 105];
        //         $.each(authorizedTypes, function(i, v) {
        //             if (v == projectType) {
        //                 trace(v);
        //                 $('#codeProjet').val(projectType).trigger('change');
        //             }
        //         })
        //         clearInterval(selectPPI);
        //     }
        // }, 500);
    })();

    (function() {
        if (window.location.pathname.indexOf('/fr/souscription/credits/pret-personnel-individuel') !== -1) {
            var capriInterval = setInterval(function() {
                // if ( $('#ia-capri').length && $('[name=form-demande-pret-etape-1]').length >0 && $('#btn-demande-pret-etape-1').length > 0 && $('#accepteCGU').length < 2 && ENVIRONNEMENT=="PREVIEW") {
                //     var cg_ppi = '<div class="inline-label"><input type="checkbox" required="" id="accepteCGU" value="0" name="accepteCGU"><label for="accepteCGU" class="ml">En cochant cette case, je certifie avoir pris connaissance de la <a href="#">note d’informations précontractuelles</a> relative à la vente à distance et au démarchage.</label></div>';
                //     if (!$('#accepteCGU').length) {
                //       $('#btn-demande-pret-etape-1').attr('disabled', true);
                //       $('#infosCompte').after(cg_ppi);
                //     }
                //     $('#accepteCGU').click(function(){
                //         if ($(this).is(':checked')) {
                //             $('#btn-demande-pret-etape-1').attr('disabled', false);
                //         }
                //         else {
                //             $('#btn-demande-pret-etape-1').attr('disabled', true);
                //         }
                //     })
                // }
                if ($('#ia-capri').length && $('[name=form-demande-pret-etape-2]').length) {
                    clearInterval(capriInterval);
                    var _setRequiredFields = function(fieldId) {
                        trace($(fieldId).length)
                        if ($(fieldId).length) {
                            $(fieldId).attr('required', true);
                            trace($(fieldId));
                        }
                    }

                    _setRequiredFields('#date-entree-emprunteur');
                    _setRequiredFields('#date-entree-coemprunteur');
                    _setRequiredFields('#date-sortie-emprunteur');
                    _setRequiredFields('#date-sortie-coemprunteur');

                    $('#date-entree-coemprunteur').attr('name', 'date_entree2');
                    $('[id=input-salaire]').eq(1).attr('name', 'salaire2');
                    $('[name=periode]').eq(1).attr('name', 'periode2');
                }
            }, 500);
        }
    })();

    /* fonctions de redirection HBC */
    if ($('#id_hbc_div').length > 0 && window.location.pathname != '/fr/espace-prive/portefeuille-et-bourse/vos-operations/espace-opcvm' && window.location.pathname.indexOf('/les-marches-en-direct/') == -1) {
        var _hostname = window.location.hostname;
        var clock = setInterval(function() {
            trace('cherche iframe...');
            var iframeContent = jQuery('iframe').contents().find('body').children(),
                iframeHeight = jQuery('iframe').contents().height();

            if (iframeContent.length > 0) {
                jQuery('iframe').height(iframeHeight + 40);
                clearInterval(clock);
                trace('iframe trouvée');

                iframeContent.find('iframe').each(function(i) {
                    trace('iframe found');
                    $(this).attr({
                        width: '100%',
                        height: '1500'
                    });
                });

                iframeContent.find('a').each(function(index) {

                    trace('traitement du lien ' + index);

                    if (!$(this).attr('href')) {
                        trace('Pas de href');
                        // var lienVide =  $( this ).attr('href');
                        // $( this ).attr('href',lienVide.replace('','/aiguillage-wspl/redirect/accueil?types=181-189-185'));
                    } else if ($(this).attr('href').match(/javascript.*VRF_TITRE/)) {
                        trace('remplacement du lien Atos ' + $(this).attr('href'));
                        $(this).attr('href', "/fr/espace-client/ProxyATOS/proxyAtos-depeches");
                    }

                    // else if( $( this ).attr('href').match(/javascript.*palmares/) ){
                    // trace('remplacement du lien '+$( this ).attr('href'));
                    // $( this ).attr('href',"./mapage2.html");
                    // }
                    else if ($(this).attr('href').match(/Fiche_Outils_OST/)) {
                        trace('remplacement du lien OST ' + $(this).attr('href'));
                        var lienOST = $(this).attr('href');
                        $(this).attr('href', lienOST.replace('proxy-banking/banque/portail/particulier/Fiche?type=fiche&identifiant=Fiche_Outils_OST_20120229024030', 'fr/connexion/portefeuille-et-bourse/ost?provenance=2'));
                    } else if ($(this).attr('href').match(/identifiant=VAG_/)) {
                        trace('remplacement du lien VAG ' + $(this).attr('href'));
                        var lienVAG = $(this).attr('href');
                        $(this).attr('href', lienVAG.replace('proxy-banking/banque/portail/particulier/Fiche?type=fiche&identifiant=VAG_20130821035347&', 'fr/connexion/portefeuille-et-bourse/vote-ag?'));
                    } else if ($(this).attr('href').match(/NSFR\?Action=DSP_HISTOCPT/)) {
                        trace('remplacement du lien rop ' + $(this).attr('href'));

                        $(this).attr('href', "/aiguillage-wspl/redirect/accueil?types=181-189-185");
                    } else if ($(this).attr('href').match(/NSFR\?Action=DSP_ET/)) {
                        trace('remplacement du lien rop ' + $(this).attr('href'));

                        $(this).attr('href', "/aiguillage-wspl/redirect/accueil?types=181-189-185");
                    } else if ($(this).attr('href').match(/BOUPSDCTX2\?Action=DSP_HISTOCPT/)) {
                        trace('remplacement du lien rop ' + $(this).attr('href'));

                        $(this).attr('href', "/aiguillage-wspl/redirect/accueil?types=181-189-185");
                    } else if ($(this).attr('href').match(/BOUPSDCTX2\?Action=DSP_ET/)) {
                        trace('remplacement du lien rop ' + $(this).attr('href'));

                        $(this).attr('href', "/aiguillage-wspl/redirect/accueil?types=181-189-185");
                    } else if ($(this).attr('href').match(/BOUPSDCTX2\?Action=DSP_DPF/)) {
                        trace('remplacement du lien rop ' + $(this).attr('href'));

                        $(this).attr('href', "/aiguillage-wspl/redirect/accueil?types=181-189-185");
                    } else if ($(this).attr('href').match(/javascript.*popupFicheValeur.jsp/)) {
                        trace('remplacement du lien fiche popupFicheValeur ' + $(this).attr('href'));
                        var lienATOS = $(this).attr('href');
                        $(this).attr('href', lienATOS.replace('https://bourses.bnpparibas.net/details/popupFicheValeur.jsp?', 'https://' + _hostname + '/proxyatos-wspl/rpc/atos?referencePage=fiche_valeur&'));
                    } else if ($(this).attr('href').match(/javascript.*popupDetail.jsp/)) {
                        trace('remplacement du lien popupDetail ' + $(this).attr('href'));
                        var lienATOS = $(this).attr('href');
                        $(this).attr('href', lienATOS.replace('https://bourses.bnpparibas.net/details/popupFicheValeur.jsp?', 'https://' + _hostname + '/proxyatos-wspl/rpc/atos?referencePage=fiche_valeur&'));
                    }
                    /*
                                        else if( $( this ).attr('href').match(/www\.secure\.bnpparibas\.net/)){
                                            trace('remplacement du lien OPCVM '+$( this ).attr('href'));
                                            var lienOPCVM =  $( this ).attr('href');
                                            $( this ).attr('href',lienOPCVM.replace('https://www.secure.bnpparibas.net/NSFR','https://'+_hostname+'/proxy-banking/NSFR?'));
                                        }*/
                    else if ($(this).attr('href').match(/NSFR\?Action=OPGNS/)) {
                        trace('remplacement du lien OPCVM ' + $(this).attr('href'));
                        var lienOPCVM = $(this).attr('href');
                        $(this).attr('href', lienOPCVM.replace('https://www.secure.bnpparibas.net/NSFR', 'https://mabanque.bnpparibas/proxy-banking/NSFR?'));
                    } else if ($(this).attr('href').match(/NSFR\?Action=OPGNR/)) {
                        trace('remplacement du lien OPCVM ' + $(this).attr('href'));
                        var lienOPCVM = $(this).attr('href');
                        $(this).attr('href', lienOPCVM.replace('https://www.secure.bnpparibas.net/NSFR', 'https://mabanque.bnpparibas/proxy-banking/NSFR?'));
                    }

                });

                trace('traitement terminé');
                //iframe.bind('load', function() {
                //trace('dans bind');
                //});

            }

        }, 1000);
    }

    // Taille messagerie
    if (window.location.pathname.indexOf('messagerie') != -1) {
        if (ENVIRONNEMENT == 'PROD' || ENVIRONNEMENT == 'PREVIEW') {
            var textareaMessagerie = setInterval(function() {
                if ($('#textarea-nouveau-message').length > 0) {
                    $('#textarea-nouveau-message').one('keyup paste', function() {
                        if ($(this).val().indexOf('%') > 0) {
                            var content = $(this).val().replace('%', ' pourcent');
                            $(this).val(content);
                        }
                    });
                }
                if ($('#textarea-repondre').length > 0) {
                    $('#textarea-repondre').one('keyup paste', function() {
                        if ($(this).val().indexOf('%') > 0) {
                            var content = $(this).val().replace('%', ' pourcent');
                            $(this).val(content);
                        }
                    });
                }
            }, 500);
        }

        $('.nb-messages .round-img.deux').addClass('hidden');
        var nb_message_non_lu_interval = setInterval(function() {
            if ($('.js-number-unread-msg-recu-header').length > 0 && $('.js-number-unread-msg-recu-header').text().length > 0) {
                if ($('.js-number-unread-msg-recu-header').text() > 0) {
                    $('.nb-messages .round-img.deux').text($('.js-number-unread-msg-recu-header').text());
                    $('.nb-messages .round-img.deux').removeClass('hidden');
                } else {
                    $('.nb-messages .round-img.deux').addClass('hidden');
                }
                if (sessionStorage.getItem('info_client')) {
                    var info_client = JSON.parse(sessionStorage.getItem('info_client'));
                    try {
                        info_client.data.abonnement.nombreMessageBMMNonLus = $('.js-number-unread-msg-recu-header').text();
                        sessionStorage.setItem('info_client', JSON.stringify(info_client));
                    } catch (e) {}
                }
                // clearInterval(nb_message_non_lu_interval);
            }
        }, 500);
        var template_messagerie_interval = setInterval(function() {
            if ($('#template-liste-messagerie-placeholder').length > 0 && $('#template-liste-messagerie-placeholder').find('h3').length > 0) {
                clearInterval(template_messagerie_interval);
                var $template = $('#template-liste-messagerie-placeholder');
                var resetSize = function() {
                    setTimeout(function() {
                        var height = $('#template-liste-messagerie-placeholder').height();
                        var zonePubliableHeight = $('#zonePubliableHautMessageriePart').outerHeight();
                        $('#template-liste-messagerie-placeholder').height(height - zonePubliableHeight);
                    }, 200);
                }
                $('body').on('click', function() {
                    resetSize();
                });
                resetSize();
            }
        }, 1000);

        /* Message entete messagerie*/
        var messagerie_msg_interval = setInterval(function() {
            if ($('#zonePubliableHautMessageriePart').length > 0 || $('#zonePubliableHautMessagerieBPF').length > 0) {
                clearInterval(messagerie_msg_interval);
                $.get('/rsc/contrib/html/espaceclient/messagerie/info.html', function(data) {
                    $('#zone-publiable-haute').html(data);

                    (function() {
                        var btnChevron = $('.icon-carret-down');
                        var msgDetails = $('.msg-details');

                        var isVisible = false;
                        msgDetails.hide();

                        btnChevron.on("click", function() {
                            if (isVisible) {
                                btnChevron.removeClass('icon-carret-up').addClass('icon-carret-down');
                            } else {
                                btnChevron.removeClass('icon-carret-down').addClass('icon-carret-up');
                            }
                            msgDetails.toggle();

                            isVisible = !isVisible;
                        });
                    })();
                });
            }
        }, 500);

        /* fermeture teaser ocnet le mag */
        var teaserLemag_msg_interval = setInterval(function() {
            if ($('wrapper-ocnet-le-mag').length > 0) {
                $('#popinLemag').find('button').click(function() {
                    $('.wrapper-teaser').addClass('hidden');
                    $('.wrapper-ocnet-le-mag').removeClass('hidden');
                })
            }
        }, 500);
        /* message temporaire PJ KO messagerie */
    }
});

/* fonction affichage montant CAPRO */
function chargerDonneesPokap(montant) {
    var html = '<div>Montant de votre crédit personnalisé : ' + montant + '</div>';
    $('#pubpokap').append(html);
}

$(function() {
    $('.link-disable a, a.link-disable').click(function(event) {
        event.preventDefault();
    });
});


// Temporaire : fix taille slider home
$(function() {
    if ($('.slider').length > 0) {
        if (document.URL.match(/Accueil-part-fr/) || document.URL.match(/programme-priority-actualites/) || document.URL.match(/a-la-une-pro/)) {
            var lastResize = 0,
                debounceTime = 50,
                slider = $('.slider'),
                carTop = slider.find('.js-build-carousel.carousel.slide.top');

            if (carTop.length > 0) {

                $(window).resize(function() {
                    var d = new Date(),
                        newResize = d.getTime();
                    if (newResize - lastResize > debounceTime) {
                        lastResize = newResize;

                        var img = carTop.find('.active img');
                        carTop.css('height', img.height());
                    }
                });

                var img = carTop.find('.active img');
                carTop.css('height', img.height());
            }
        }
    }
});


// Temporaire : ajout type d'objectif pour mode gestion BPF
$(function() {
    if (document.URL.match(/espace-prive\/gestion\/modegestion/)) {
        $.ajax({
            url: "/modegestion-wspl/rpc/listerContrats",
            success: function(data) {
                if (typeof(data.message) != "undefined" && data.message == "OK") {
                    var typeObjectif = data.data.listeGestionMandat[0].profilGestion.libelle;
                    trace("typeObjectif récupéré : " + typeObjectif);
                    var objectifClock = setInterval(function() {
                        var sectionCible = $('section#gestion-contrat');
                        if (sectionCible.length > 0) {
                            clearInterval(objectifClock);
                            sectionCible.find('.contrat li span:last-child').html(typeObjectif);
                        }
                    }, 200);
                }
            }
        });
    }
});
// Fix pour classe souscription présente sur des pages de modification
$(function() {
    setInterval(function() {
        if ($('.header-page').length > 0) {
            $('body').removeClass('alt-breadcrumb souscription');
        }
    }, 500);
});


//Pacth bourse 05.06.205 demandé par Chérif pour la communication avec les iframe Atos
//@A.Lematre

$(function() {
    // if(ENVIRONNEMENT == "PROD"){ return; }

    addCookieToGarbage('makeAtosCall'); //Pour que ce cookie soit détruit à la déconnexion de l'utilisateur

    if (GlobalSite.docCookies.getItem('makeAtosCall') == true) {
        console.log('makeAtosCall deja existant');
        return;
    }

    var urlBourse = [
        'liste-des-portefeuilles',
        /*'carnet-ordres',*/
        'achat-euronext',
        'mouvements-titres'
    ];

    var prefix = document.URL.match(/\/(fr|en|de)\/[^\/]*\//);
    for (var i = 0; i < urlBourse.length; i++) {
        var pattern = new RegExp('\\/' + urlBourse[i] + '\\/?$', 'gi');
        if (document.location.pathname.match(pattern)) {
            makeAtosCall();
            break;
        }
    }

    // function makeAtosCall() {
    //     $('body').append('<div id="hiddenIframe" style="position:fixed; top:-200%; left:-200%; opacity:0;"><iframe src="' + (prefix[0] + 'portefeuille-et-bourse/les-marches-en-direct/synthese-des-marches') + '"></iframe>');
    //     GlobalSite.docCookies.setItem('makeAtosCall', 'true', Infinity, '/', document.domain);
    // }

    // (function() {
    //     if (typeClientPourMultilingue == "bpf") {
    //         $("#fp_endetail").click(function() {
    //             $("#fp_plus_details .wcm-image").empty().append("<img src='/rsc/contrib/image/bpf/produits/fp-popupBPF.jpg' alt='Image popup'>");
    //         });
    //     }
    // })();

    // Remove cercle wealth item from lateral nav
    (function() {
        if ($("body").hasClass('bpf'))
        {
            var remove_cercle_wealth_item = setInterval(function() {
                if ($("body").hasClass('client') == true && $("body").hasClass('bpf') == true) {
                    $("#nav14-le-cercle-wealth").hide();
                }

                if ($("#nav14-le-cercle-wealth").is(":hidden")) {
                    clearInterval(remove_cercle_wealth_item);
                }
            }, 100);
        }
    })();

    // Remove le returHome button
    (function() {
        var remove_returnHome = setInterval(function() {

            var url = window.location.href;
            var leCercleWealth = (url.match(/le-cercle-wealth/) != null);
            var magazine = (url.match(/magazine/) != null);
            var hasMaganzineBody = ($('.magazine-body').length > 0);

            if (leCercleWealth && hasMaganzineBody) {
                $("#returnHome").addClass('hidden');

                $(".logoBNP-container").find("a:first-child").removeClass('part-only').attr('href', '/fr/a-la-une-bpf');
                $(".logoBNP-container").find("p").addClass('hidden');
            }

            if (magazine && hasMaganzineBody) {
                $("#returnHome").addClass('hidden');
            }

            if ($("#returnHome").hasClass('hidden') || (!leCercleWealth && !magazine)) {
                clearInterval(remove_returnHome);
            }
        }, 100);
    })();

    // Remove client class in body in PROD and add cercleWealth item in Nav
    (function() {
        var url = window.location.href;
        if ((typeClientPourMultilingue == "bpf") && (ENVIRONNEMENT == 'PROD')) {
            var getSession = sessionStorage.getItem('info_client');
            var remove_client_class = setInterval(function() {
                if (url.match(/le-cercle-wealth/) != null && $('body').hasClass('client') && getSession == null) {
                    $("body").removeClass("client");
                    $('#nav13-solutions').after("<li id='nav14-le-cercle-wealth' class=' selected'><a class='selected' href='/fr/le-cercle-wealth'><span>E-MAGAZINE CERCLE WEALTH</span></a></li>");

                    clearInterval(remove_client_class);
                }
            }, 100);
        }
    })();

    (function() {
        $(document).scroll(function() {
            var url = window.location.href;
            if (url.match(/le-cercle-wealth/) != null) {
                var topBar = $('.top-header').css('top');

                if (topBar == '0px') {
                    $('.bottom-header').css('top', '40px');
                }
            }
        });
    })();


    // fit iframe height
    (function() {
        // var wbservice = setInterval(function() {
        //     $.ajax({
        //         type: "GET",
        //         url: "https://prev-m-wev1s1-apv1s1.canalnet-bpf.bnpparibas.net/demat-wspl/rest/initialisationDemat",
        //         contentType: "application/json; charset=utf-8",
        //         dataType: "json",
        //         success: function(data) {
        //             if (data.codeRetour == 0) {
        //                 $('.header-page').append(data.message); $('#footer').append(data.message);
        //                 clearInterval(wbservice);
        //             } else {
        //                 $('.header-page').append('loading...'); $('#footer').append('loading...');
        //             }
        //         }
        //     });
        // }, 100);
    })();

    (function() {
        var cartes_pg = setInterval(function() {
            if (typeClientPourMultilingue == "bpf") {
                var hub_cartes = "/fr/nos-solutions-dediees/services-bancaires-au-quotidien/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/";
                var carte_pages = ['carte-visa-infinite', 'carte-visa-premier', 'carte-cirrus', 'carte-american-express-platinum', 'carte-gold-american-express', 'carte-bnp-net'];
                var current_page = window.location.pathname;
                if ($('.colonne-contact:eq(1)').length > 0) {
                    for (var i = 0; i < carte_pages.length; i++) {
                        if (current_page == hub_cartes + carte_pages[i]) {
                            $('.colonne-contact:eq(1)').hide();
                        }
                    }
                    clearInterval(cartes_pg);
                }
            }
        }, 500);
    })();

    (function() {
        if (typeClientPourMultilingue == "bpf") {
            var url = window.location.href;
            var fd_strat_privee = setInterval(function() {
                    if ((url.match(/placements-financiers/) != null) && (url.match(/Strategie-privee/) != null)) {
                        $('#contactContainerColonne').css('display', 'none');
                        $('.xml-section.level1.fpbpf_avantages').css('width', '100%');
                        $('#schema-strat-privee img').css({
                            'width': '600px',
                            'height': '221px',
                            'margin': '29px auto 0'
                        });

                        clearInterval(fd_strat_privee);
                    }
            }, 150);
        }
    })();

    (function() {
        if ((typeClientPourMultilingue == "bpf")) {
            var udc_hdr = setInterval(function() {
                if (window.location.href.match(/espace-prive/) != null && window.location.href.match(/comptes-et-contrats/) != null) {
                    if ($('.header-page.header-udc.header-select div:nth-child(2)').length > 0) {

                        $('.header-page.header-udc.header-select div:nth-child(2)').removeClass('row').addClass('col-50');
                        $('.header-page.header-udc.header-select div:nth-child(3)').removeClass('row').addClass('col-50');
                        $('.header-page.header-udc.header-select div:nth-child(3) > div').removeClass('col-2').addClass('col-50');
                        clearInterval(udc_hdr);
                    }
                }
            }, 150);
        }
    })();

    // fixTop 70px in MainNav
    (function() {
        if ((typeClientPourMultilingue == "bpf")) {
            var getSession = sessionStorage.getItem('info_client');
            var fixTop = setInterval(function() {
                if (getSession !== null) {
                    if ($('#mainMenu nav ul').length > 0) {
                        $("#mainMenu nav ul").css({ 'top': '69px;' });
                        clearInterval(fixTop);
                    }
                }
            }, 150);
        }
    })();

    (function() {

        var url = window.location.href;

        if (typeClientPourMultilingue == "bpf") {

            if (url.match(/votre-reaction/) != null) {
                $("iframe").css('height', '970px');
            } else if (url.match(/donnez-votre-avis/) != null) {
                $("iframe").css('height', '940px');
            } else if ((url.match(/en-pratique/) != null) || (url.match(/besoin-d-aide/))) {
                $("iframe").css('height', '1400px');
            } else if (url.match(/pourquoi-changer/) != null) {
                $("iframe").css('height', '740px');
            }

            addRemoveMarginTopToIframe();
            $(window).resize(function() {
                addRemoveMarginTopToIframe();
            });
        }

    })();

    // Add souscription and alt-breadcrmb class in bpf body tag
    (function() {
        var url = window.location.href;
        if (typeClientPourMultilingue == "bpf") {

            if (url.match(/virements-services/) != null && url.match(/paylib/) != null) {
                $('body').addClass('souscription alt-breadcrumb');
            }
        }
    })();

    //Display #msg-arbitrage in PROD
    (function() {
        var url = window.location.href;
        if ((typeClientPourMultilingue == "bpf") && (ENVIRONNEMENT == 'PROD')) {
            $("#msg-arbitrage").hide();
        } else {
            if (url.match(/analyses-recommandations-financieres/) != null) {
                $(".arbitrages.bloc-pad").hide();
            }
        }
    })();

    //Hide Meteo
    (function() {

        var url = window.location.href;
        if ((typeClientPourMultilingue == "bpf") && (ENVIRONNEMENT == 'PREVIEW') && (url.match(/profil/) != null)) {
            var searchMeteo = setInterval(function() {
                if ($(".meteo-box").length) {
                    // $(".meteo-box").hide();
                    // $("label[for='activ-meteo']").parent().hide();
                    // $(".dropdown-selected").parent().parent().parent().attr('class','row');
                    $("#profil-meteo").hide();
                    clearInterval(searchMeteo);
                }
            }, 150);
        }

    })();

    // Add and Remove marginTop
    function addRemoveMarginTopToIframe() {

        if (($(".onglet-nav").length != 0) && (document.location.href.match(/decouvrir-nouveau-site/) != null)) {

            if (document.body.clientWidth < 800) {
                $('iframe').css('marginTop', '0')
            } else {
                $('iframe').css('marginTop', '60px')
            }
        }
    }

    //Make webCallBack float over
    (function() {
        if (!$('body').hasClass('bpf')) {
            return;
        }
        var col_webcallback = setInterval(function() {
            if (($(".fpbpf_header").length > 0) && ($(".colonne-contact").length > 0)) {

                clearInterval(col_webcallback);

                var header = $('header.bottom-header');
                var nav = $("#nav_bpf");
                var fpbpf_header = $(".fpbpf_header");
                var middle_Col = $("#decouvrir_les_avantages");
                var col_right = $(".colonne-contact.v3");
                var pageHeight = $(window).outerHeight();
                var pageWidth = $(window).outerWidth();

                var col_right_top = header.outerHeight() + nav.outerHeight();
                //var header_scrolled = fpbpf_header.outerHeight();
                var header_scrolled = $('.xml-section.level1.fpbpf_avantages').offset().top - (header.outerHeight() + nav.outerHeight());
                //var reach_footer = header_scrolled + middle_Col.outerHeight() - col_right.outerHeight();
                if (window.location.pathname.match('/actualites-et-presse/focus/') == null ){
                    var reach_footer = $('.xml-section.level1.fpbpf_complement').offset().top - $('.colonne-contact.v3').outerHeight() + header.outerHeight() + nav.outerHeight();
                }
                //var new_top      = $('.xml-section.level1.fpbpf_complement').offset().top - $('.colonne-contact.v3').outerHeight() - nav.outerHeight();


                $(window).scroll(function() {
                    if (pageWidth > 1024) {

                        getScroll = $(this).scrollTop();

                        if (header_scrolled < getScroll) {
                            col_right.css({
                                position: 'fixed',
                                top: col_right_top,
                                width: '278px'
                            });
                        } else {
                            col_right.removeAttr('style');
                        }
/*                        if (ENVIRONNEMENT == "PROD") {
                            if (reach_footer < getScroll) {
                                col_right.css({
                                    position: 'fixed',
                                    top: reach_footer - getScroll - $('.colonne-contact.v3').outerHeight() + 'px'
                                });
                            }
                        }*/
                        if (reach_footer < (getScroll + $('.colonne-contact.v3').innerHeight())) {
                            col_right.css({
                                position: 'fixed',
                                top: reach_footer - getScroll - $('.colonne-contact.v3').outerHeight() + 'px'
                            });
                        }

                    }
                });

                $(window).resize(function() {
                    pageWidth = $(this).outerWidth();
                    if (pageWidth < 1024) {
                        col_right.removeAttr('style');
                    }
                });

            }

        }, 500);

    })();

    // vertical trophée banner only on OPC
    /*function tropheeBanner(){
        var banner = "<div class='responsive-banner trophee'><div class='banner-header trophee'></div><div class=' banner-body trophee'><div class='text-block'><p class='big-banner-text-green'>GRAND TROPHÉE D\'OR* </p><p class='medium-banner-text-green'>DE LA PERFORMANCE GLOBALE SUR 3 ANS</p><p class='banner-text-black'>*dans la catégorie &laquo; banques à réseaux &raquo; </p></div><div class='text-block'><p class='big-banner-text-green'>MEILLEURE GAMME DE FONDS* </p><p class='medium-banner-text-green'>OBLIGATIONS EURO SUR 3 ANS</p><p class='banner-text-black'>*dans la catégorie &laquo; banques à réseaux &raquo; </p></div><div class='text-block'><p class='big-banner-text-green'>MEILLEUR FONDS ACTIONS INTERNATIONALES</p></div><div class='text-block '><p class='big-banner-text-green banner-image-control-margin'>MEILLEUR FONDS DIVERSIFIÉ</p></div></div><div class='banner-footer trophee'><div class='text-block'><p class='banner-text-black'>Les fonds sont exposés notamment aux risques suivants : taux, crédit, contrepartie, liquidité, change, actions. <br> Les investissements réalisés dans les fonds sont soumis aux _ uctuations du marché et aux risques inhérents aux investissements en valeurs mobilières. La valeur des investissements et les revenus qu\'ils génèrent peuvent enregistrer des hausses comme des baisses et il se peut que les investisseurs ne récupèrent pas l\'intégralité de leur placement. Les fonds présentent un risque de perte en capital. Pour une dé_ nition et une description plus complète des risques, merci de vous reporter au prospectus et DICI des fonds. Avant de souscrire, vous devez lire la version la plus récente du prospectus et DICI disponibles gratuitement sur notre site. Les performances passées ne préjugent pas des performances à venir.<br> Le présent document a été rédigé et est publié par BNP Paribas Asset Management S.A.S. (BNPP AM)*, un membre de BNP Paribas Investment Partners (BNPP IP)**. Ce contenu vous est communiqué à titre purement informatif et ne constitue : 1. ni une offre de vente, ni une sollicitation d\'achat, et ne doit en aucun cas servir de base ou être pris en compte pour quelque contrat ou engagement que ce soit ; 2. ni un conseil d\'investissement.<br> * BNPP AM est une société de gestion de portefeuille agréée par l\'Autorité des Marchés Financiers en France (numéro d\'enregistrement 96002), constituée sous forme de société par actions simpli_ ée, au capital de 67 373 920 euros, ayant son siège social au 1, boulevard Haussmann 75009 Paris, France, RCS Paris 319 378 832. www.bnpparibas-ip.com.<br> ** &laquo; BNP Paribas Investment Partners &raquo; est la marque globale des services de gestion d\'actifs du groupe BNP Paribas. Les entités de gestion d\'actifs faisant partie de BNP Paribas Investment Partners et éventuellement citées dans le présent document le sont uniquement à titre d\'information et n\'exercent pas nécessairement d\'activités dans votre pays. Pour tout complément d’information, veuillez contacter votre partenaire local agréé ou distributeur local BNPP IP désigné, le cas échéant.</p></div></div></div>";
        return banner;
    }*/

    // Add colonne if #colonneContactContainer && #fp_hero are present
    (function() {

        if (typeClientPourMultilingue == "bpf") {
            var url = window.location.href;
            var col_webcallback = setInterval(function() {

                if (($("#colonneContactContainer").length > 0) && ($("#fp_hero").length > 0) || ($(".header-page").length > 0)) {
                    var blockRdv = $('<section class="colonne-contact v3"><section class="wrapper_chat global js-container-chat">' + '<div class="content_chat">' + '<h3>Une question ?</h3>' + '<p>Nos banquiers privés sont disponibles pour y répondre</p>' + '<div class="mobile-contact"></div>' + '<div id="nextoutils_webcallback_callback"></div>' + '<a id="nextcallback_BPF" class="btn-primary forceColor" href="#">Être rappelé immédiatement</a>' + '<a class="btn-primary forceColor" href="/fr/banque-contact/prendre-rendez-vous">Prendre rendez-vous</a>' + '</div><div class="close">X</div>' + '</section> ' + '</section>');

                    $("#colonneContactContainer").prepend(blockRdv);

                    var url = window.location.href;
                    var linkObject = {
                        "compte-epargne": "/fr/souscrire/epargne-bourse/compte-sur-livret/csl-souscription?codeProduit=PRO-0000000000155&codeOffre=OFF-0000000000172&redir=cslfinet",
                        "compte-epargne-maison": "/fr/souscrire/epargne-bourse/compte-sur-livret/csl-souscription?codeProduit=PRO-0000000000155&codeOffre=OFF-0000000000174&redir=cslfinet",
                        "compte-epargne-vacances": "/fr/souscrire/epargne-bourse/compte-sur-livret/csl-souscription?codeProduit=PRO-0000000000155&codeOffre=OFF-0000000000175&redir=cslfinet"
                    }

                    if (url.match(/compte-epargne/) != null) {
                        $("#colonneContactContainer .colonne-contact .btn-primary.forceColor:nth-child(1)").attr('href', linkObject['compte-epargne'])
                    }

                    if (url.match(/compte-epargne-maison/) != null) {
                        $("#colonneContactContainer .colonne-contact .btn-primary.forceColor:nth-child(1)").attr('href', linkObject['compte-epargne-maison'])
                    }

                    if (url.match(/compte-epargne-vacances/) != null) {
                        $("#colonneContactContainer .colonne-contact .btn-primary.forceColor:nth-child(1)").attr('href', linkObject['compte-epargne-vacances'])
                    }

                    if (url.match(/adresser-une-reclamation/) != null) {
                        $("#colonneContactContainer").remove();
                    }

                    if (url.match(/cartes-et-moyens-de-paiement/) != null && url.match(/comparateur-cartes/) != null) {
                        $(".colonne-contact .content_chat").append('<a class="btn-primary forceColor" href="#">Souscrire en ligne</a>');

                        $("#colonneContactContainer").css({
                            "margin-top": "0px",
                            "background-color": "#fff"
                        });
                    }
                }

                /*if(url.match('/placements-financiers/') != null && url.match(/opc/) != null){
                    $('body').after(tropheeBanner());
                }*/

                if ($('.content_chat').length > 0) {
                    clearInterval(col_webcallback);
                }

            }, 150);
        }

    })();

    // Move dymanicly rigth_col to top
    (function() {
        var pathname = window.location.pathname;
        var ht_total = 0;
        var move_right_top = setInterval(function() {
            if (pathname.match(/decouvrir-la-banque-privee/) != null && pathname.match(/actualites-et-presse/) != null) {

                if ($("#bpf_actu_right_col_0216").length > 0 && $("#fp-rightCol").length > 0) {

                    if ($('.xml-section.level1.fpbpf_avantages').length > 1) {
                        var ht = [];
                        $('.xml-section.level1.fpbpf_avantages').each(function(i) {
                            ht[i] = $(this).outerHeight();
                        });

                        var ht_total = ht.reduce(function(total, val) {
                            return total + val;
                        });
                    } else {
                        var ht_total = $('.xml-section.level1.fpbpf_avantages').outerHeight();
                    }
                    /*if (ENVIRONNEMENT == 'PROD') {
                        $("#fp-rightCol").css({ "position": "relative", "top": "-" + ht_total + "px", "padding": "7px 0 0" });
                    }*/
                    if ((ENVIRONNEMENT == 'PREVIEW') || (ENVIRONNEMENT == 'PROD')) {
                        if ( DeviceSize.getDeviceState() == 'dektop'  ){
                            $("#fp-rightCol").css({ "position": "relative", "top": "-" + ht_total + "px", "padding": "7px 0 0" });
                        }
                    }
                    clearInterval(move_right_top);
                }
            }
        }, 500);
    })();


    (function() {
        if (typeClientPourMultilingue == "bpf") {
            var url = window.location.href;
            if (url.match(/cartes-et-moyens-de-paiement/) != null && url.match(/comparateur-cartes/) != null) {
                var col_webcallback = setInterval(function() {
                    if (($('#colonneContactContainer').length > 0) && ($('.header-page').length > 0)) {

                        $('#colonneContactContainer').empty();

                        $('#colonneContactContainer').prepend('<section class="colonne-contact v3"><section class="wrapper_chat global js-container-chat">' + '<div class="content_chat">' + '<h3>Une question ?</h3>' + '<p>Nos banquiers privés sont disponibles pour y répondre</p>' + '<div class="mobile-contact"></div>' + '<div id="nextoutils_webcallback_callback"></div>' + '<a id="nextcallback_BPF" class="btn-primary forceColor" href="#">Être rappelé immédiatement</a>' + '<a class="btn-primary forceColor" href="/fr/banque-contact/prendre-rendez-vous">Prendre rendez-vous</a>' + '</div><div class="close">X</div>' + '</section> ' + '</section>');
                        $('.colonne-contact .content_chat').append('<a class="btn-primary forceColor" href="#">Souscrire en ligne</a>');
                        $('#colonneContactContainer .wrapper_chat .close').hide();
                        $("#colonneContactContainer").css({
                            "margin-top": "0px",
                            "background-color": "#fff"
                        });

                        clearInterval(col_webcallback);
                    }
                }, 150);
            }
        }
    })();


    (function() {
        if (typeClientPourMultilingue == "bpf") {
            var url = window.location.href;
            if (url.match(/charte-et-rapport-de-la-mediation-bancaire-bnp-paribas/) != null && url.match(/banque-en-ligne-les-bonnes-pratiques/) != null) {
                var col_webcallback = setInterval(function() {
                    if (($('#colonneContactContainer').length > 0) && ($('.header-page').length > 0)) {

                        $('#colonneContactContainer').empty();

                        $('#colonneContactContainer').prepend('<section class="colonne-contact v3"><section class="wrapper_chat global js-container-chat">' + '<div class="content_chat">' + '<h3>Une question ?</h3>' + '<p>Nos banquiers privés sont disponibles pour y répondre</p>' + '<div class="mobile-contact"></div>' + '<div id="nextoutils_webcallback_callback"></div>' + '<a id="nextcallback_BPF" class="btn-primary forceColor" href="#">Être rappelé immédiatement</a>' + '<a class="btn-primary forceColor" href="/fr/banque-contact/prendre-rendez-vous">Prendre rendez-vous</a>' + '</div><div class="close">X</div>' + '</section> ' + '</section>');
                        $('.colonne-contact .content_chat').append('<a class="btn-primary forceColor" href="#">Souscrire en ligne</a>');
                        $('#colonneContactContainer .wrapper_chat .close').hide();
                        $("#colonneContactContainer").css({
                            "margin-top": "0px",
                            "background-color": "#fff"
                        });

                        clearInterval(col_webcallback);
                    }
                }, 150);
            }
        }
    })();


    (function() {
        if ((typeClientPourMultilingue == "bpf") && (document.location.href.match(/assurance-vie/) != null)) {
            var getSession = sessionStorage.getItem('info_client');

            var bloc1 = $('.xml-section.level2.fpbpf_avantages').eq(3).find('p:nth(1)').find('em:nth(1)');
            var bloc2 = $('.xml-section.level2.fpbpf_avantages').eq(4).find('p:nth(1)').find('em');
            var bloc3 = $('.fpbpf_complement h3:eq(0) span:eq(2)');
            var pdf_file1 = 'fds-en-euros-cardif-assurance-vie-12-2016.pdf';
            var pdf_file2 = 'POL4206-reporting-eurocroissance-BPF_BD_v6.pdf';
            var pdf_file3 = 'POL4515-reporting-eurocroissance-BPF.pdf'

            if (getSession !== null) {
                bloc1.after(tpl(pdf_file1));
                bloc2.after(tpl(pdf_file2));
                bloc3.after(tpl2(pdf_file3));
            }

           /*  $(function(){
                if (!$('body').hasClass('client')){console.log('fait');
                  $('.xml-section.level3.table-cell h3:first').hide();
                  $('.xml-section.level3.table-cell h3:eq(1) span:eq(0)').text('2');
                }
            });*/
            if(!$('body').hasClass('client')){
               $('div.level1.fpbpf_complement div.level3').css({
                            "width": "auto",
                            "border": "none"
                        });
            }


        }

        function tpl(pdf_file) {
            return "<div style='margin-top:10px'><a target='_blank' href='/rsc/contrib/document/BPF/" + pdf_file + "' style='display: block;height: 40px;'><span class='icon icon-pdf' style='font-size:35px; display: block; float:left;'></span><span style='display: block;height: 35px;margin: 0px 41px;line-height: 54px;float: left;'>Voir la composition du fonds euros et les commentaires du gérant</span></a></div>";
        }
        function tpl2(pdf_file) {
            return "<div style='margin-top:10px'><a target='_blank' href='/rsc/contrib/document/BPF/" + pdf_file + "' style='display: block;height: 40px;'><span class='icon icon-pdf' style='font-size:35px; display: block; float:left;'></span><span style='display: block;height: 35px;margin: 0px 41px;line-height: 54px;float: left;'><i class='first-letter'>V</i>oir la composition du fonds <i class='first-letter'>E</i>urocroissance et les commentaires du gérant</span></a></div>";
        }
    })();

    (function() {
        if ((typeClientPourMultilingue == "bpf") && (document.location.href.match(/tarifs-et-conditions/) != null)) {
            var getSession = sessionStorage.getItem('info_client');

            var bloc1 = $('#presinfosleg div:nth-child(1)');
            var bloc2 = $('#presinfosleg div:nth-child(2)');

            bloc1.find('a').attr('target', '_blank');
            bloc2.find('a').attr('target', '_blank');

            bloc2.hide();

            if (getSession !== null) {
                bloc2.show();
            }
        }
    })();

    // Add ancre
    (function() {
        if ((typeClientPourMultilingue == "bpf")) {
            if (window.location.href.match(/actualites-et-presse/) != null && window.location.href.match(/focus/) != null && $('#actualites-focus').length > 0) {

                var hashTag = window.location.hash;
                //var h = $("#nav_bpf").offset().top + $("#nav_bpf").height() + 20;
                var h = $('header.bottom-header').outerHeight() + $("#nav_bpf").outerHeight() + 20;

                $('.level2.fpbpf_avantages a').each(function(i) {
                    $(this).attr('href', '#ancre' + (i + 1));
                });

                $(".level2.fpbpf_avantages a").click(function(e) {

                    var id = $(this).attr('href');
                    $(document).scrollTop($(id).offset().top - h);
                    e.preventDefault();
                });

                //$(document).scrollTop($(hashTag).offset().top - h);

                if (hashTag) {
                    //$(document).scrollTop($(hashTag).offset().top - h);
                    setTimeout(function() {
                        $(window).scrollTop($(window.location.hash).offset().top - 90)
                    }, 500)
                }
            }
        }

    })();

    //Esprit libre remove button
    (function() {

        var redirect_espLib = setInterval(function() {

            var compt_contrat = window.location.href.match(/comptes-et-contrats/);
            var mes_cartes = window.location.href.match(/mes-cartes/);
            var esprit_libre = window.location.href.match(/esprit-libre/);

            if (compt_contrat != null && mes_cartes != null && esprit_libre != null) {

                if ($('#ia-espritlibre a.btn-primary').length > 0) {
                    $('#ia-espritlibre a.btn-primary').attr('href', 'https://mabanque.bnpparibas/fr/notre-offre/comptes-cartes-et-services/comptes-et-formules/decouvrir-les-formules-esprit-libre');
                    clearInterval(redirect_espLib);
                }
            }
        }, 500);
    })();

    (function() {
        if (typeClientPourMultilingue == "bpf") {
            if (document.location.href.match(/modegestion/) != null) {
                $(".canvasLoader").hide();
            }
        }
    })();
    // End code

    (function() {
        setInterval(function() {
            if ($('.container-mes-documents .blue.pointer.parameters').length > 0) {
                $('.container-mes-documents .blue.pointer.parameters').find('p').text( _get('next.fix.demat.libelle', 'Rechercher et pointer ses opérations' ));
                $('.container-mes-documents .blue.pointer.parameters').on('click', function() {
                    if ($('body').hasClass('part')) {
                        window.location.href = '/fr/connexion/mes-outils/dematerialisation?redir=dematRop';
                    }
                    if ($('body').hasClass('bpf')) {
                        window.location.href = '/fr/espace-prive/mes-outils/dematerialisation?redir=dematRop';
                    }
                    if ($('body').hasClass('pro')) {
                        window.location.href = '/fr/espace-pro/mes-outils/dematerialisation?redir=dematRop';
                    }
                });
            }
            if ($('#ia-demat').length > 0 && $('.rechecheAvancee').find('.link').length > 0) {
                if ($('.rechecheAvancee').find('.link').text() == "") {
                    $('.rechecheAvancee').find('.link').text("Rechercher d'autres relevés");
                }
            }
        }, 500);

        var click_pro_interval = setInterval(function() {
            if (window.location.pathname == '/fr/espace-pro/mes-outils/dematerialisation' && window.location.search == '?redir=dematRop') {
                if ($('[data-vue="pro"]').length) {
                    $('[data-vue="pro"]').click();
                    clearInterval(click_pro_interval);
                }
            }
        }, 500);

        var zpHaute_interval = setInterval(function() {
            if (window.location.pathname.indexOf('mes-outils/dematerialisation') != -1) {
                if ($('#zone-publiable-haute-HomeMesDoc').length && $('#zone-publiable-haute-HomeMesDoc').html() != "") {
                    var zpHaute_toCopy = $('#zone-publiable-haute-HomeMesDoc').html();
                    $('.wrapper-mes-documents').prepend(zpHaute_toCopy);
                    clearInterval(zpHaute_interval);
                }
            }
        }, 500);

    })();

    // => PDC - 06-03-2017
    (function patchMenuContact() { // Correction en Prod du lien contactez-nous/Nous contacter BPF en conflit avec le lien contact Part
        var menuBpfIntervalId = setInterval(function () {
            var $item_menu_contact;

            if ($('body').hasClass('bpf') && ($item_menu_contact = $("#nav8-contact .sous-menu-visible a[href*='nous-contacter']")).length > 0) {
                clearInterval(menuBpfIntervalId);
                $item_menu_contact.attr('href', '/fr/banque-contact/nous-contacter');
            }

           if ($('body').hasClass('bpf') && ($item_menu_contact = $("#nav8-contact-child-li0 a[href*='nous-contacter']")).length > 0) {
                clearInterval(menuBpfIntervalId);
                $item_menu_contact.attr('href', '/fr/banque-contact/nous-contacter');
            }

        }, 500);
    })();
    // <= PDC - 06-03-2017

    (function() {
        if (typeof($.cookie) == "undefined") {
            return;
        }
        var appinstance = $.cookie('APinstance'),
            lsinstance = $.cookie('LSinstance'),
            host = window.location.host;

        $('#wtsite span').text(host);
        $('#wtz_appserver span').text(appinstance);
        $('#wtz_livesite span').text(lsinstance);
    })();


    (function() {
        if (window.location.pathname.indexOf('mes-outils/dematerialisation') != -1 && window.location.search == "?redir=dematRop") {
            var inserted = false,
                pro = '';
            if ($('body').hasClass('pro')) {
                pro = 'Pro';
            }
            var interval_demat = setInterval(function() {
                if ($('#zone-publiable-eligibilite').length > 0 && $('#zone-publiable-eligibilite').html() != '') {
                    var eligibilite = '<section class="wrap demat"><div class="confirmation"> <i class="icon-form-info"></i><p class="violet"><span class="big">Vous ne disposez pas du service "Rechercher et pointer ses opérations".</span></p> <p>Ce service est réservé exclusivement aux titulaires de l\'offre Situation ' + pro + ' ayant souscrit aux relevés en ligne.</p><p>Avec l\'offre Situation ' + pro + ', vous bénéficiez d\'une vision globale et précise de vos comptes.<br> Vous pouvez notamment trier, pointer et commenter vos opérations facilement. </p> </div> <div class="row row-footer"><!--<button class="btn btn-primary pull-right">Prendre rendez-vous</button><a href="" class="btn btn-secondary pull-right">En savoir plus</a>--></div></section>';
                    $('#zone-publiable-eligibilite').html(eligibilite);
                    $('.wrapper-mes-documents-demat').css('padding-left', 0);
                    // clearInterval(interval_demat);
                }
            }, 500);
        }
    })();
});
var wtCookies = {
    wrongDomain: location.hostname.toLowerCase(),
    rightDomain: location.hostname.toLowerCase().match(/[^\.]+\.(.+)/)[1], // strip initial "www." or other subdomain
    cookieName: 'WT_FPC', // default is WT_FPC
    cookieLifetime: 63113851500, // default is 63113851500ms (1.99 years)
    metaTagFix: 'WT.z_cookieFix', // for possible reporting purposes
    metaTagFixFail: 'WT.z_cookieFixFail', // for possible reporting purposes
    setMetaTags: true, //decide whether or not to set meata tags for reporting
    debug: false // enables console output
};

// Read the Webtrends cookie(s) and set in an array
wtCookies.readCookies = function(cookieName) {
    if (this.debug) {
        console.log('readCookies(' + cookieName.toString() + ')');
    }
    var re = new RegExp(cookieName + '=[^;]*', 'gi');
    var result = document.cookie.match(re);

    if (result) {
        // If we got a result array, just strip out the cookie name from the results.
        for (var i = 0; i < result.length; i++) {
            result[i] = result[i].replace(cookieName + '=', '');
        }
    } else {
        // If we didn't get a result, set an empty array rather than a null value
        result = [];
    }
    return result;
};

// Split the Webtrends cookie into its constituent parts as an array of objects
wtCookies.splitCookies = function(cookieArray) {
    if (this.debug) {
        console.log('splitCookies(' + cookieArray.toString() + ')');
    }
    var cookieObjs = [];
    var temp = [];
    // loop through multiple cookies
    for (var i = 0; i < cookieArray.length; i++) {
        // split on both : and = chars
        temp = cookieArray[i].split(/[:=]/);
        // new cookie object
        cookieObjs[i] = {};
        // set the object with the various parts (name, value, name, value...)
        for (var j = 0; j < temp.length; j = j + 2) {
            cookieObjs[i][temp[j]] = temp[j + 1];
        }
    }
    return cookieObjs;
};

// Set a Webtrends cookie
wtCookies.setCookie = function(cookieName, cookieValue, domain, lifetime) {
    if (this.debug) {
        console.log('setCookie(' + cookieName.toString() + ', ' + cookieValue.toString() + ', ' + domain.toString() + ', ' + lifetime.toString() + ')');
    }
    // Calculate expiry date based on lifetime period
    var d = new Date();
    d.setTime(d.getTime() + lifetime);

    // Set cookie
    var temp = cookieName + '=' + cookieValue + '; expires=' + d.toUTCString() + '; domain=.' + domain + '; path=/;';
    if (this.debug) {
        console.log('Cookie: ' + temp);
    }
    document.cookie = temp;
};

// Delete a Webtrends cookie
wtCookies.deleteCookie = function(cookieName, domain) {
    if (this.debug) {
        console.log('deleteCookie(' + cookieName.toString() + ', ' + domain.toString() + ')');
    }
    // Set a cookie with a negative lifetime
    this.setCookie(cookieName, '', domain, -999999999999);
};

// Set meta tag to indicate fix applied, or not, should be picked up by WT tag
wtCookies.setMeta = function(metaName, metaValue) {
    if (this.debug) {
        console.log('setMeta(' + metaName.toString() + ', ' + metaValue.toString() + ')');
    }
    var meta = document.createElement('meta');
    meta.name = metaName;
    meta.content = metaValue;
    document.getElementsByTagName('head')[0].appendChild(meta);
};

// This is the main logic
wtCookies.run = function() {
    if (this.debug) {
        console.log('run()');
    }
    // Read in the cookie(s)
    var cookies = this.readCookies(this.cookieName);

    // Only proceed if we got any cookies back
    if (cookies.length === 0) {
        if (this.debug) {
            console.log('no cookies');
        }
        return;
    }

    // If we only have one cookie, we just want to make sure it's set on the right domain
    if (cookies.length == 1) {
        if (this.debug) {
            console.log('1 cookie');
        }
        // Set on right domain.  This may overwrite existing, or set a new one, depending on what already exists
        this.setCookie(this.cookieName, cookies[0], this.rightDomain, this.cookieLifetime);
        //re-check in case this has created an additional cookie
        cookies = this.readCookies(this.cookieName);
        if (cookies.length == 1) {
            //this means it was overwritten without change, so we can just leave
            return;
        }
    }

    // From this point on, we have some work to do to attempt a fix

    // If we have two cookies
    if (cookies.length == 2) {
        if (this.debug) {
            console.log('2 cookies');
        }
        // Compare the two cookies
        if (cookies[0] == cookies[1]) {
            if (this.debug) {
                console.log('cookies identical');
            }
            // If exactly the same values, then just delete from wrong domain
            this.deleteCookie(this.cookieName, this.wrongDomain);
        } else {
            if (this.debug) {
                console.log('cookies different');
            }
            // If different values, then split out into crumbs
            var cookieCrumbs = this.splitCookies(cookies);

            // Check IDs
            if (cookieCrumbs[0].id == cookieCrumbs[1].id) {
                if (this.debug) {
                    console.log('IDs identical');
                }
                //  If IDs match, find most recent values of ss, lv from the two cookies.
                // (We don't want to do this if IDs don't match because we don't know which should take priority)
                var id = cookieCrumbs[0].id;
                var ss = Math.max(cookieCrumbs[0].ss, cookieCrumbs[1].ss);
                var lv = Math.max(cookieCrumbs[0].lv, cookieCrumbs[1].lv);
                // Set on the correct domain with most recent values
                this.setCookie(this.cookieName, 'id=' + id + ':lv=' + lv + ':ss=' + ss, this.rightDomain, this.cookieLifetime);
            }
            // Delete wrong domain cookie (this will happen whether or not IDs match).
            this.deleteCookie(this.cookieName, this.wrongDomain);
        }
    }

    if (cookies.length > 2) {
        if (this.debug) {
            console.log('3+ cookies');
        }
        // This should never happen, but if it does the best we can do is to delete the wrong domain cookie.
        this.deleteCookie(this.cookieName, this.wrongDomain);
    }

    // By this point, if everything is OK, we should just have one cookie.
    // If meta tag reporting is enabled, let's check.
    if (this.setMetaTags) {
        // Re-read the cookies
        cookies = this.readCookies(this.cookieName);
        if (this.debug) {
            console.log('cookies left: ' + cookies.length.toString());
        }
        if (cookies.length == 1) {
            // Yes, it's all good!
            this.setMeta(this.metaTagFix, "1");
        } else {
            // Oh dear, something didn't work
            this.setMeta(this.metaTagFixFail, "1");
        }
    }
};

// Execute the script
try {
    wtCookies.run();
} catch (e) {
    if (wtCookies.debug) {
        console.log(e);
    }
}





/*--------------------------------------------------------------------------------*/
/*                Barre galactique -- mouvement au scroll                         */
/*--------------------------------------------------------------------------------*/

window.galacticBarParams = {};

function initGalacticBarPosition() {

    if ($('#wcm-l-bottom-header-connected').length > 0) {
        return;
    }

    window.galacticBarParams.galacticBar = $('header.top-header');
    if (window.galacticBarParams.galacticBar.length < 1) {
        return;
    }

    var initialScrollTop = $(document).scrollTop();
    $(document).scrollTop(0);

    window.galacticBarParams.bottomHeader = $('header.bottom-header,header.bottom-header-connected '),
        window.galacticBarParams.leftNav = $('#mainMenu nav>ul'),
        window.galacticBarParams.ongletNav = $('.onglet-nav'),
        window.galacticBarParams.galacticBarHeight = window.galacticBarParams.galacticBar.outerHeight(true),
        window.galacticBarParams.initialGalacticBarTop = window.galacticBarParams.galacticBar.css('top').replace("px", ""),
        window.galacticBarParams.initialBottomHeaderTop = (window.galacticBarParams.bottomHeader.length > 0) ? window.galacticBarParams.bottomHeader.css('top').replace("px", "") : 0,
        window.galacticBarParams.initialLeftNavTop = (window.galacticBarParams.leftNav.length > 0) ? window.galacticBarParams.leftNav.css('top').replace("px", "") : 0,
        window.galacticBarParams.initialOngletNavTop = (window.galacticBarParams.ongletNav.length > 0) ? window.galacticBarParams.ongletNav.css('top').replace("px", "") : 0,
        window.galacticBarParams.initialOngletNavTop = 110;

    // if ( window.galacticBarParams.ongletNav.length == 0 ) {
    //     var interval_ongletnav = setInterval(function() {
    //         if ( $('.onglet-nav').length > 0 ) {
    //             clearInterval(interval_ongletnav);
    //             window.galacticBarParams.ongletNav = $('.onglet-nav');
    //             window.galacticBarParams.initialOngletNacvTop = ( window.galacticBarParams.ongletNav.length > 0 )? window.galacticBarParams.ongletNav.css('top').replace("px", "") : 0;
    //         }
    //     },500);
    // }

    $(document).scroll(function() {
        updateGalacticBarPosition();
    });

    if (initialScrollTop > 0) {
        $(document).scrollTop(initialScrollTop);
    }
}

function updateGalacticBarPosition() {

    var wScrollTop = $(document).scrollTop();

    if (wScrollTop < window.galacticBarParams.galacticBarHeight) {
        //On est dans la partie où la barre doit être au moins en partie visible
        var galacticBarTempTop = (window.galacticBarParams.initialGalacticBarTop == "auto") ? 0 : window.galacticBarParams.initialGalacticBarTop;
        window.galacticBarParams.galacticBar.removeClass('retracted').css({
            "top": String(galacticBarTempTop - wScrollTop) + "px"
        });


        if (window.galacticBarParams.bottomHeader.length > 0) {
            var bottomHeaderTempTop = (window.galacticBarParams.initialBottomHeaderTop == "auto") ? 0 : window.galacticBarParams.initialBottomHeaderTop;
            window.galacticBarParams.bottomHeader.css({
                "top": String(bottomHeaderTempTop - wScrollTop) + "px",
                "position": "fixed"
            });
            //console.log ('position galactic bar :', bottomHeaderTempTop - wScrollTop);
        }




        // if (window.galacticBarParams.leftNav.length > 0) {
        //     var leftNavTempTop = (window.galacticBarParams.initialLeftNavTop == "auto") ? 0 : window.galacticBarParams.initialLeftNavTop;
        //     console.log( wScrollTop );
        //     window.galacticBarParams.leftNav.css({
        //         "top": 110 - wScrollTop + "px"
        //     });
        // }


        if (window.galacticBarParams.ongletNav.length > 0) {
            var ongletNavTempTop = (window.galacticBarParams.initialOngletNavTop == "auto") ? 0 : window.galacticBarParams.initialOngletNavTop;
            //console.log(ongletNavTempTop, wScrollTop);
/*            if (ENVIRONNEMENT == "PROD") {
                window.galacticBarParams.ongletNav.css({
                    "top": String(ongletNavTempTop - wScrollTop) + "px"
                });
            }*/
            if ((ENVIRONNEMENT == "PREVIEW") || (ENVIRONNEMENT == "PROD") ){
                window.galacticBarParams.ongletNav.css({
                    "top": String(ongletNavTempTop + wScrollTop) + "px",
                    "position" : "fixed"
                });
                /*console.log ('position nav bt retour :', ongletNavTempTop - wScrollTop);*/
            }
            if (window.location.pathname.endsWith('/nos-solutions-dediees/services-bancaires-au-quotidien/cle-digitale') &&
                  $('body').hasClass('mob') ){
                    console.log('clé digitale');
                $('.level2.header-page.has-onglet').css('margin-top','48px');
                $('.xml-section.level2 ').css('width','100%');
            }
            if ( ENVIRONNEMENT == "PREVIEW" &&
                  window.location.pathname.endsWith('/cartes-et-moyens-de-paiement/faire-opposition-a-sa-carte-bancaire') &&
                  $('body').hasClass('mob') ){
                    console.log('faire opposition à sa carte');
                $('.level2.header-page.has-onglet').css('margin-top','48px');
                $('.xml-section.level2 ').css('width','100%');
            }
        }

    } else if (!window.galacticBarParams.galacticBar.hasClass('retracted')) {
        var galacticBarTempTop = (window.galacticBarParams.initialGalacticBarTop == "auto") ? -window.galacticBarParams.galacticBar.outerHeight(true) : window.galacticBarParams.initialGalacticBarTop - window.galacticBarParams.galacticBar.outerHeight(true);
        window.galacticBarParams.galacticBar.addClass('retracted').css({
            "top": String(galacticBarTempTop) + "px"
        });


        /*if (ENVIRONNEMENT == "PROD") {
            if (window.galacticBarParams.bottomHeader.length > 0) {
                var bottomHeaderTempTop = (window.galacticBarParams.initialBottomHeaderTop == "auto") ? -window.galacticBarParams.galacticBar.outerHeight(true) : window.galacticBarParams.initialBottomHeaderTop - window.galacticBarParams.galacticBar.outerHeight(true);
                window.galacticBarParams.bottomHeader.css({
                    "top": String(bottomHeaderTempTop) + "px"
                });
            }
        }*/

        if ( (ENVIRONNEMENT == "PREVIEW") || (ENVIRONNEMENT == "PROD") ){
            if (window.galacticBarParams.bottomHeader.length > 0) {
                var bottomHeaderTempTop = (window.galacticBarParams.initialBottomHeaderTop == "auto") ? -window.galacticBarParams.galacticBar.outerHeight(true) : window.galacticBarParams.initialBottomHeaderTop - window.galacticBarParams.galacticBar.outerHeight(true);
                 if( (window.location.pathname.indexOf('espace-prive') != -1) || (window.location.pathname.indexOf('connexion') != -1)     ){
                    window.galacticBarParams.bottomHeader.css({
                        "top": "0px"
                    });
                }else{
                     window.galacticBarParams.bottomHeader.css({
                        "top": String(bottomHeaderTempTop) + "px"
                    });
                }
            }
        }


        // if (window.galacticBarParams.leftNav.length > 0) {
        //     var leftNavTempTop = (window.galacticBarParams.initialLeftNavTop == "auto") ? -window.galacticBarParams.galacticBar.outerHeight(true) : window.galacticBarParams.initialLeftNavTop - window.galacticBarParams.galacticBar.outerHeight(true);
        //     window.galacticBarParams.leftNav.css({
        //         "top": String(leftNavTempTop) + "px"
        //     });
        // }


        if (window.galacticBarParams.ongletNav.length > 0) {
            var ongletNavTempTop = (window.galacticBarParams.initialOngletNavTop == "auto") ? -window.galacticBarParams.galacticBar.outerHeight(true) : window.galacticBarParams.initialOngletNavTop - window.galacticBarParams.galacticBar.outerHeight(true);
            window.galacticBarParams.ongletNav.css({
                "top": String(ongletNavTempTop) + "px"
            });
        }
    }

    /*if( wScrollTop > 0 ){
        if( window.galacticBarParams.galacticBar.hasClass('retracted') ){ return; }

        var galacticBarTempTop = ( window.galacticBarParams.initialGalacticBarTop == "auto" )? -window.galacticBarParams.galacticBar.outerHeight(true) : window.galacticBarParams.initialGalacticBarTop - window.galacticBarParams.galacticBar.outerHeight(true);
        window.galacticBarParams.galacticBar.addClass('retracted').stop(true).animate({
            "top" : String( galacticBarTempTop ) + "px"
        }, 500);

        var bottomHeaderTempTop = ( window.galacticBarParams.initialBottomHeaderTop == "auto" )? -window.galacticBarParams.galacticBar.outerHeight(true) : window.galacticBarParams.initialBottomHeaderTop - window.galacticBarParams.galacticBar.outerHeight(true);
        if( window.galacticBarParams.bottomHeader.length > 0 ){
            window.galacticBarParams.bottomHeader.stop(true).animate({
                "top" : String( bottomHeaderTempTop ) + "px"
            }, 500);
        }

        var leftNavTempTop = ( window.galacticBarParams.initialLeftNavTop == "auto" )? -window.galacticBarParams.galacticBar.outerHeight(true) : window.galacticBarParams.initialLeftNavTop - window.galacticBarParams.galacticBar.outerHeight(true);
        if( window.galacticBarParams.leftNav.length > 0 ){
            window.galacticBarParams.leftNav.stop(true).animate({
                "top" : String( leftNavTempTop ) + "px"
            }, 500);
        }

        var ongletNavTempTop = ( window.galacticBarParams.initialOngletNavTop == "auto" )? -window.galacticBarParams.galacticBar.outerHeight(true) : window.galacticBarParams.initialOngletNavTop - window.galacticBarParams.galacticBar.outerHeight(true);
        if( window.galacticBarParams.ongletNav.length > 0 ){
            window.galacticBarParams.ongletNav.stop(true).animate({
                "top" : String( ongletNavTempTop ) + "px"
            }, 500);
        }

    }else{

        var galacticBarTempTop = ( window.galacticBarParams.initialGalacticBarTop == "auto" )? "auto" : String( window.galacticBarParams.initialGalacticBarTop)+"px";
        window.galacticBarParams.galacticBar.removeClass('retracted').stop(true).css({
            "top" : galacticBarTempTop
        });

        var bottomHeaderTempTop = ( window.galacticBarParams.initialBottomHeaderTop == "auto" )? "auto" : String( window.galacticBarParams.initialBottomHeaderTop )+"px";
        if( window.galacticBarParams.bottomHeader.length > 0 ){
            window.galacticBarParams.bottomHeader.stop(true).css({
                "top" : bottomHeaderTempTop
            });
        }

        var leftNavTempTop = ( window.galacticBarParams.initialLeftNavTop == "auto" )? "auto" : String( window.galacticBarParams.initialLeftNavTop ) + "px";
        if( window.galacticBarParams.leftNav.length > 0 ){
            window.galacticBarParams.leftNav.stop(true).css({
                "top" : leftNavTempTop
            });
        }

        var ongletNavTempTop = ( window.galacticBarParams.initialOngletNavTop =="auto" )? "auto" : String( window.galacticBarParams.initialOngletNavTop ) +"px";
        if( window.galacticBarParams.ongletNav.length > 0 ){
            window.galacticBarParams.ongletNav.stop(true).css({
                "top" : ongletNavTempTop
            });
        }
    }*/
}

$(document).ready(function() {
    initGalacticBarPosition();

    /* correctif liens contact */
    if ($('body').hasClass('part')) {
        $('nav').find('li').each(function() {
            if ($(this).find('span').text() == "Urgences") {
                $(this).find('a').attr('href', '/fr/nous-contacter/nous-contacter#ct-urgence')
            }
            if ($(this).find('span').text() == "Nous contacter") {
                $(this).find('a').attr('href', '/fr/nous-contacter/nous-contacter')
            }
        })
    }

    if (GlobalSite.docCookies.getItem('APinstance')) {
        var apinstance = GlobalSite.docCookies.getItem('APinstance');
        if (apinstance.indexOf('a1') !== -1 || apinstance.indexOf('a2') !== -1) {
            $('body').addClass('marne');
        } else {
            $('body').addClass('vaudreuil');
        }
    }

});

/*--------------------------------------------------------------------------------*/
/*--------------------------------------------------------------------------------*/
/*--------------------------------------------------------------------------------*/

var interval_type_vcd = setInterval(function() {
    if ($('.assurances .row.main .libelle').length > 0) {
        clearInterval(interval_type_vcd);
        $('.assurances .row.main .libelle').each(function() {
            var str = $.trim($(this).text());
            str = str.substr(3);
            str = str.replace(/[0-9]/g, '');
            if (str) {
                $(this).parents('li').addClass('type-' + str);
            }
        });
    }
}, 500);

$(function() {
    (function() {
        var interval_pdf_interval = setInterval(function() {
            if ($('#step4a-web-mise-en-garde').length > 0) {
                clearInterval(interval_pdf_interval);
                $('#step4a-web-mise-en-garde').find('.icon-pdf, .btn-.small, .link').on('click', function() {
                    window.open('/rsc/contrib/document/Mefav/FichemiseengardeMefav.pdf')
                });
            }
        }, 500)
    })();
});

/*
$(function() {
    // modification temporaire libelle offre bourse mode connecté
    $('#nav6-bourse').find('span').eq(0).text('Notre offre bourse');
});
*/


/* notes stratégiques BPF */
$(function() {
    setTimeout(function() {
        //$('#iframe-toutsurmabanque-dva').height(940);
    }, 20);
});

$(function() {
    if ($('#iframe-toutsurmabanque-dva').length > 0) {
        $('#iframe-toutsurmabanque-dva').load(function() {
            var iframe_nis = $('#iframe-toutsurmabanque-dva').contents().get(0);
            $(iframe_nis).on('click', 'body', function() {
                var max_height = $('iframe').contents().find('.menu-content:visible').height() + 500;
                $('#iframe-toutsurmabanque-dva').height(max_height);
            });
        });
    }
});

/* formulaire ouvrir compte lna */
$(function() {
    if (window.location.pathname.indexOf('agence-en-ligne') != -1) {
        if (ENVIRONNEMENT == "PREVIEW") {
            var url_ouvrir_compte = "https://lnabnpp2.mosaic.fr/ouvrir-un-compte/?next=1";
            var url_ouvrir_compte_m = "https://lnabnpp2.mosaic.fr/ouvrir-un-compte/?device=mobile&next=1";
            var lna_transfert = "https://lnabnpp2.mosaic.fr/ouvrir-un-compte/transfert/?next=1";
            var iframe_lna_insead = "https://lnabnpp2.mosaic.fr/ouvrir-un-compte/insead/?next=1";
        } else if (ENVIRONNEMENT == "PROD") {
            var url_ouvrir_compte = "https://lna.bnpparibas.net/ouvrir-un-compte/?next=1";
            var url_ouvrir_compte_m = "https://lna.bnpparibas.net/ouvrir-un-compte/?device=mobile&next=1";
            var lna_transfert = "https://lna.bnpparibas.net/ouvrir-un-compte/transfert/?next=1";
            var iframe_lna_insead = "https://lna.bnpparibas.net/ouvrir-un-compte/insead/?next=1";
        }

        /* Ajoute tous les paramètres sauf requiredDAC*/
        var objOption = decodeURIComponent(window.location.search.slice(1)).split('&').reduce(function _reduce( /*Object*/ a, /*String*/ b) {
            b = b.split('=');
            a[b[0]] = b[1];
            return a;
        }, {});
        var strParam = "";
        for (var key in objOption) {
            if (key != "requiredDAC")
                strParam += (strParam ? "&" : "") + key + "=" + objOption[key];
        }
        url_ouvrir_compte += "&" + strParam;
        url_ouvrir_compte_m += "&" + strParam;
        lna_transfert += "&" + strParam;
        iframe_lna_insead += "&" + strParam;


        if ($('#lna-ouvrir-compte').length > 0) {
            if (DeviceSize.getDeviceState() == "desktop") {
                var lna_iframe = '<iframe width="100%" height="2850" style="height: 2850px;" src="' + url_ouvrir_compte + '" id="iframe-lna-ouvrircompte" scrolling="no"></iframe>';
                $('#lna-ouvrir-compte').html(lna_iframe);
            } else {
                var lna_iframe = '<iframe width="100%" height="1900" style="height: 1900px;" src="' + url_ouvrir_compte_m + '" id="iframe-lna-ouvrircompte" scrolling="no"></iframe>';
                $('#lna-ouvrir-compte').html(lna_iframe);
            }
        }
        if ($('#lna-transfert').length > 0) {
            if (DeviceSize.getDeviceState() == "desktop") {
                var lna_iframe = '<iframe width="100%" height="1600" style="height: 1600px;" src="' + lna_transfert + '" id="iframe-lna-transfert" scrolling="no"></iframe>';
                $('#lna-transfert').html(lna_iframe);
            } else {
                var lna_iframe = '<iframe width="100%" height="1020" style="height: 1020px;" src="' + lna_transfert + '" id="iframe-lna-transfert" scrolling="no"></iframe>';
                $('#lna-transfert').html(lna_iframe);
            }
        }

        if ($('#lna-insead').length > 0) {
            if (DeviceSize.getDeviceState() == "desktop") {
                var lna_iframe = '<iframe width="100%" height="1585" style="height: 1585px;" src="' + iframe_lna_insead + '" id="iframe-lna-insead" scrolling="no"></iframe>';
                $('#lna-insead').html(lna_iframe);
            } else {
                var lna_iframe = '<iframe width="100%" height="1585" style="height: 1585px;" src="' + iframe_lna_insead + '" id="iframe-lna-insead" scrolling="no"></iframe>';
                $('#lna-insead').html(lna_iframe);
            }
        }
    }
});

/* fonction ajout iframe EER pour agence en ligne */
$(function() {
    if (window.location.pathname.indexOf('suivi-de-dossier') != -1) {
        if (ENVIRONNEMENT == "PREVIEW") {
            var url_eer = "https://eermb.mosaic.fr/ouvrir-un-compte/suivi_dossier/";
        } else if (ENVIRONNEMENT == "PROD") {
            var url_eer = "https://eer.bnpparibas/ouvrir-un-compte/suivi_dossier/";
        }

        if ($('#lna-eer').length > 0) {
            var lna_eer_iframe = '<iframe id="iframe-lna-eer" width="100%" height="2000" scrolling="no" src="' + url_eer + '" style="height: 2000px;">';
            $('#lna-eer').html(lna_eer_iframe);
        }
    }
});

/* modification message confirmation erreur RDVNET */
$(function() {
    if (window.location.pathname.indexOf('mes-outils/rdv-net') != -1) {
        var numTel = '0820 820 001';
        if ($('body').hasClass('pro')) {
            numTel = '0820 820 007';
        }
        var newMsg = 'Nous vous invitons à contacter le centre de relation client en téléphonant au '+numTel+'<br /><br />ou en cliquant sur le bouton "Être rappelé"';
        var rdvnetMsgReplace_interval = setInterval(function() {
            if ($('.rdv_bloc.confirmation').length > 0 && $('.rdv_bloc.confirmation').find('p.big').text().indexOf('scope de déploiement') > 0) {
                $('.rdv_bloc.confirmation').find('p.big').html(newMsg);
                clearInterval(rdvnetMsgReplace_interval);
            }
        }, 500);
    }
});


$(function() {
    if ($(document).getUrlParam('redir')) {
        $('body').addClass($(document).getUrlParam('redir'));
    }
});

$(function() {
    if (window.location.pathname == '/fr/connexion') {
        $.get('/serviceinfosclient-wspl/rpc/InfosClient?modeAppel=0', function(info_client) {
            if (info_client.message == 'OK') {
                window.location.href = '/fr/connexion/comptes-et-contrats';
            }
        });
    }
    if (window.location.pathname == '/fr/espace-prive') {
        $.get('/serviceinfosclient-wspl/rpc/InfosClient?modeAppel=0', function(info_client) {
            if (info_client.message == 'OK') {
                window.location.href = '/fr/espace-prive/comptes-et-contrats';
            }
        });
    }
    if (window.location.pathname == '/fr/espace-pro') {
        $.get('/serviceinfosclient-wspl/rpc/InfosClient?modeAppel=0', function(info_client) {
            if (info_client.message == 'OK') {
                window.location.href = '/fr/espace-pro/comptes-et-contrats';
            }
        });
    }
});

// Dans la messagerie activation des liens video dans les ocnet
$(function() {

    if ($('.ec-messagerie').length > 0) {

        setInterval(function() {

            if ($('a[href^="#launcherVideo"]').length > 0) {

                //GlobalSite.playerVideo();--> pour l'instant main.js est ecrasé par le script des sous-traitant
                // du coup en attendant on remet toute la fonction


                var players = $('[id^="playerVideo"]');
                var launchers = $('[id^="launcherVideo"]');
                var launchersMessagerie = $('a[href^="#launcherVideo"]');
                var ocnetLink = false;

                if (players.length == 0 && launchers.length == 0 && launchersMessagerie.length == 0) {
                    // trace("pas de video");
                    return;

                }

                // cas particulier pour les OCnet on il n'est pas possible de renseigner les parametres via un ID,
                // il sont passé via l'attribut href du lien.
                if (launchersMessagerie.length > 0) {
                    launchers = launchersMessagerie;
                    ocnetLink = true;
                    // trace("lien video " +  ocnetLink);
                }

                function createPlayerKewego(idVideo, hauteur, largeur, player_key_keywego) {

                    var playervideo = '<object data="https://sssl.kewego.com/swf/fp.swf" height="' + hauteur + '"" width="' + largeur + '" id="' + idVideo + '" name="' + idVideo + '" type="application/x-shockwave-flash">';
                    playervideo += '<param name="flashVars" value="picto=009966&amp;border=cccccc&amp;btn=000000&amp;cbar=000000&amp;width=' + largeur + '&amp;height=' + hauteur + '&amp;sig=' + idVideo + '&amp;playerkey=' + player_key_keywego + '&amp;autostart=false&amp;suffix=">';
                    playervideo += '<param name="movie" value="https://sassl.kewego.com/swf/fp.swf">';
                    playervideo += '<param name="allowFullScreen" value="true"><param name="allowscriptaccess" value="always">';
                    playervideo += '<param name="bgcolor" value="000000">';
                    playervideo += '<video controls="controls" height="' + hauteur + '" poster="https://apissl.kewego.com/video/getHTML5Thumbnail/?playerKey=' + player_key_keywego + '&amp;sig=' + idVideo + '" preload="none" width="' + largeur + '">';
                    playervideo += '<script src="https://sssl.kewego.com/embed/assets/kplayer-standalone.js"></script>';
                    playervideo += '<source  src="http://apissl.kewego.com/video/getHTML5Stream/?playerKey=' + player_key_keywego + '&sig=' + idVideo + '" type="video/mp4"  width=' + largeur + ' height="' + hauteur + '"  />';
                    //playervideo +='<script defer>kitd.html5loader("flash_fastplayer_'+idVideo+'");</script> ';
                    playervideo += '</object>';
                    return (playervideo);
                }


                function createPlayerYoutube(idVideo, hauteur, largeur) {
                    var playervideo = '<iframe style="width:' + largeur + 'px" width="' + largeur + '" height="' + hauteur + '" src="https://www.youtube.com/embed/' + idVideo + ' "frameborder="0" allowfullscreen  ></iframe>'
                    return (playervideo);
                }


                function createPlayerBrightCove(idVideo, hauteur, largeur) {

                    var playervideo = '<script language="JavaScript" src="https://sadmin.brightcove.com/js/BrightcoveExperiences.js" type="text/javascript"></script>';
                    playervideo += '<object class="BrightcoveExperience" id="myExperience4296695403001">';
                    playervideo += '<param name="bgcolor" value="#FFFFFF">';
                    playervideo += '<param name="width" value="' + largeur + '">';
                    playervideo += '<param name="height" value="' + hauteur + '"> ';
                    playervideo += '<param name="playerID" value="' + idVideo + '">';
                    playervideo += '<param name="playerKey" value="AQ~~,AAABuCBi49E~,jZN_jMtu6O5UcaBjAS51YPOuxnzvHrVZ">';
                    playervideo += '<param name="isVid" value="true">';
                    playervideo += '<param name="isUI" value="true">';
                    playervideo += '<param name="dynamicStreaming" value="true">';
                    playervideo += '<param name="@videoPlayer" value="4296695403001">';
                    playervideo += '<param name="secureConnections" value="true">';
                    playervideo += '<param name="secureHTMLConnections" value="true">';
                    playervideo += '<param name="wmode" value="opaque">';
                    playervideo += '</object><script type="text/javascript">brightcove.createExperiences();</script>';

                    return (playervideo);
                }


                // liens déclenchant des vidéos
                $(launchers).click(

                    function(e) {
                        trace("ocnet click");
                        e.preventDefault();

                        if (ocnetLink) {
                            var video_id = this.getAttribute('href');
                        } else {
                            var video_id = this.getAttribute('id');
                        }

                        //trace("video " + video_id);
                        var res = video_id.split("_");
                        // trace(res);

                        var PopinVideo = '<div class="popin-cache"></div><div class="topMiddle popin popin-fixed" id="popinvideo" style="width: 853px; height: 480px; z-index: 999;"><a class="close popin-close" style="position: absolute; top: -30px; right: 0px;">✕</a></div>';
                        var playervideo = '';

                        switch (res[1]) {

                            case "kewego":
                                var player_key_keywego = '587e2f97270b';
                                if (res[3] !== undefined) {
                                    player_key_keywego = res[3];
                                }
                                playervideo = createPlayerKewego(res[2], 480, 600, player_key_keywego);
                                break;

                            case "youtube":

                                playervideo = createPlayerYoutube(res[2], 480, 853);

                                break;

                            case "brightcove":
                                playervideo = createPlayerBrightCove(res[2], 480, 853);

                                break;
                        };

                        $('body').append('<div class="popin-cache"></div><div class="topMiddle popin" id="videopopin"><a class="close popin-close">✕</a>' + playervideo + '</div>');

                        $('#videopopin').css({
                            'width': '853px',
                            'height': '480px',
                            'z-index': 999
                        }).find('.popin-close').css({
                            'position': 'absolute',
                            'top': '-30px',
                            'right': 0
                        });
                        $('.popin-cache').css({
                            'z-index': 998
                        });

                        //arret de la popin
                        $('#videopopin .popin-close').add($('.popin-cache')).on('click', function() {

                            $('#videopopin').add($('.popin-cache')).remove();

                        });
                    });

            }
        }, 500);

    }
});

$(function() {
    var intervalClientNbr = setInterval(function() {
        if ($('#client-nbr').length > 0) {
            clearInterval(intervalClientNbr);
            $('#client-nbr').focus();
        }
    }, 500);
});


$(function() {
    if (sessionStorage.getItem('info_client')) {
        var info_client = JSON.parse(sessionStorage.getItem('info_client'));
        if (info_client) {
            var cc = 0,
                type = 'part';
            if (info_client.data.abonnement.codeMotifOrigineClient == 87) {
                cc = 1;
            }
            if (info_client.data.indicateurs.indicTypeBPF) {
                type = 'bpf';
            }
            if (info_client.data.abonnement.codeProduitAbonnement == "00006") {
                type = 'pro';
            }

            var src = $('iframe[src*=donnez-votre-avis]').attr('src');
            $('iframe[src*=donnez-votre-avis]').attr('src', src + "&type=" + type + "&cc=" + cc);

        }
    }
});

$(function() {
    if (window.location.pathname.indexOf('/fr/connexion/comptes-et-contrats/suivre-mon-budget') != -1) {
        var budgetInterval = setInterval(function() {
            if ($('#ia-gbudget').find('.transparent-btn').length > 0) {
                $('#ia-gbudget').find('a.transparent-btn').click(function(e) {
                    e.preventDefault();
                });
                clearInterval(budgetInterval);
            }
        }, 500);
    }
});

$(function() {
    if (window.location.pathname == '/fr/banque-contact/demande-code-secret' || window.location.pathname == '/fr/banque-contacts/demande-code-secret' || window.location.pathname == '/fr/banque-contacts-pro/demande-de-code-secret') {
        subscribeToCheckStatus(function() {
            $('#bouton-espace-client').off('click');
        });
    }
});

$(function() {
    if ($('.bottom-header').length) {
        setInterval(function() {
            if ($('.top-header').hasClass('retracted')) {
                if ($('#mainMenu nav>ul').css('position') == 'fixed') {
                    $('#mainMenu nav>ul').css('top', '70px')
                }
            } else {
                $('#mainMenu nav>ul').css('top', '110px')
            }
        }, 100);
    }
});

/* patch oc net */
//(function() {
//   var url = window.location.href;
//    if((url.match(/mes-outils/) != null) && (url.match(/messagerie/) != null)){
//        var ocnetPatch = setInterval(function() {

//        var blockToHide1 = $('#wrapper-ocnet-fonctionnalites').find('a .btn-primary').parent().parent().next();
//        var blockToHide2 = $('#wrapper-ocnet-fonctionnalites').find('a .btn-primary').parent().parent().next().next();

//        if((blockToHide1.text() == "Pour votre information, l’adresse postale dont nous avons connaissance semble erronée. Nous vous invitons à contacter votre conseiller notamment pour la vérifier.") && ($('#wrapper-ocnet-fonctionnalites').find('a .btn-primary').parent().parent().next().next().text().trim() == "Contacter votre conseiller")){
//              $('#wrapper-ocnet-fonctionnalites').find('a .btn-primary').parent().parent().next().hide();
//              $('#wrapper-ocnet-fonctionnalites').find('a .btn-primary').parent().parent().next().next().hide();
//clearInterval(ocnetPatch);
//        }
//        }, 500);
//        console.log('oc - net --');
//    }
//})();




/* fonction ouverture CIF/PEA/PEAPME */
/* paramètres redir possibles : onglet-CIF, onglet-PEA, onglet-PEA-PME*/
$(function() {
    if (window.location.pathname.indexOf('/fr/souscription/epargne-bourse/cif-pea') != -1) {
        var onglet = $(document).getUrlParam('redir');
        var clientHB_interval = setInterval(function() {
            if ($('#peacif').find('iframe').length > 0 && clientHB) {
                window.location = '/fr/souscription/epargne-bourse/cif-pea/message-info';
                clearInterval(cifpea_interval);
            }
        }, 500);
        var cifpea_interval = setInterval(function() {
            if ($(document).getUrlParam('redir') && $('#peacif').find('iframe').length > 0) {
                //var onglet = $(document).getUrlParam('redir');
                clearInterval(cifpea_interval);
                $('#' + onglet).click();
            }
        }, 500);
        var messagerie_link_interval = setInterval(function() {
            if ($('#btn-messagerie').length > 0) {
                $('#btn-messagerie').parent('a').attr({ href: "/fr/" + clientSite + "/mes-outils/messagerie", target: "_self" });
                clearInterval(messagerie_link_interval);
            }
        }, 500);

        if ($('#resa-cif').length > 0) {
            $('.' + onglet).removeClass('hidden');
            $('#resa-cif').find('button').click(function() {
                window.location = '/fr/souscription/epargne-bourse/cif-pea' + '?redir=' + onglet;
            })
        }

    }
});


/* ajout QA temp pour demat actions rapides ROP */
$(function() {
    if (window.location.pathname.indexOf('comptes-et-contrats/releve-operations') != -1 || window.location.pathname.indexOf('accounts-and-contracts/transaction-statement') != -1) {
        // Ajout du téléchargement de relevé dans la barre de recherche
        var telecharger_releve_interval = setInterval(function() {
            if ($('.rop-wrapper .barre-recherche').length > 0 && $('#downloadReleveRop').length == 0) {
                var html = '<div id="downloadReleveRop" class="col-10 pointer" title="' + _get('next.fix.rop.export', 'Exporter mes opérations') + '"><i class="icon icon-download-alt"></i></div>';
                $('.filtre-tri').after(html);
                $('#downloadReleveRop').on('click', function() {
                    $('.action-releve').trigger('click');
                    return false;
                });
                // clearInterval(telecharger_releve_interval);
            }
        }, 500);


        var qa_demat = '<li class="col-6 degrade-hover white-box action-releve"><i class="icon-telecharger-releve"></i><div class="bas"><h3>Consulter mes relevés en ligne</h3></div></li>';
        var qa_demat_interval = setInterval(function() {
            if ($('#ActionsRapides').length > 0 && $('.action-demat').length == 0) {
                //$('#ActionsRapides').find('li.action-releve').removeClass('action-releve').addClass('action-demat');
                $('#ActionsRapides').find('li.action-releve').clone().insertAfter('li.action-releve').removeClass('action-releve').addClass('action-demat');
                $('#ActionsRapides').find('li.action-releve').hide();
                $('.action-demat').on('click', function() {
                    window.location.href = '/aiguillage-wspl/redirect/releve';
                })
            }
        }, 500);
    }
});

/* Col droite flexilia */
(function() {
    if (window.location.pathname.indexOf('/fr/notre-offre-pro/credits/financement-court-terme-et-affacturage/flexilia') != -1) {
        var flexilia_msg_interval = setInterval(function() {
            if ($('#colonneContactContainer').length > 0) {
                clearInterval(flexilia_msg_interval);
                $.get('/rsc/contrib/html/pro/souscrire/coldroite-flexilia.html', function(data) {
                    $('#colonneContactContainer').html(data);
                });
            }
        }, 500);
    }
})();

/* message sur passer-un-ordre */
(function() {
    if (window.location.pathname.indexOf('portefeuille-et-bourse/passer-un-ordre/etape-2') != -1 || window.location.pathname.indexOf('portefeuille-et-bourse/passer-un-ordre/fond-etape-2') != -1) {
        var passageOrdre_msg = '<div class="wrap form-info" style="padding:1rem; background-color:#fff; padding-left:35px"> <i class="icon icon-info violet pull-left"></i> <p class="violet" style="margin-left: 3rem; margin-top:-10px">BON À SAVOIR : le champ "quantité" est désormais positionné avant le champ "montant".<br>Assurez-vous de saisir correctement les champs souhaités avant de valider votre ordre.</p> </div>';
        var passageOrdre_msg_interval = setInterval(function() {
            if ($('#div-headerordermaskstep2').length > 0) {
                clearInterval(passageOrdre_msg_interval);
                $('#mainContent').prepend(passageOrdre_msg);
            }
        }, 500);
    }
})();


/* Patch pour lien pdf step3 cifpea */
(function($) {
    'use strict';

    if (window.location.pathname.match('cif-pea') !== null) {
        $(document).on('click', '#goControler', function() {
            console.log('clicked');
            var searchForPDFLink = setInterval(function() {
                var link = $('a');
                console.log('searching broken link');
                link.each(function() {
                    var jThis = $(this);

                    if (jThis.attr('href') === '/rsc/contrib/document/CIFPEA/PDF_CIF_Particulier_20051122140002.pdf' ||
                        jThis.attr('href') === '/templatedata/other-contents/download-document/data/CIFPEA/Tarifs_Particuliers.xml') {
                        console.log('founded');
                        jThis.attr('href', '/rsc/contrib/document/CIFPEA/Tarifs_Particuliers.pdf');
                        clearInterval(searchForPDFLink);
                    }
                });
            }, 140);
        });
    }
})(jQuery);
$(function() {

    var popinModeDemoInterval = setInterval(function() {
        if ($('.ident #zone-publiable-haute').length) {
            clearInterval(popinModeDemoInterval);
            $('.ident #zone-publiable-haute [href="/sitedemo/ident.html"]').on('click', function() {
                if ($('#popin-modedemo').length) {
                    $('#popin-modedemo').removeClass('hidden');
                    $('.popin-cache').removeClass('hidden');
                } else {
                    $.ajax({
                        url: "/rsc/contrib/dev/mode-demo/popin-espace-client" + (lgMgt.isEnglish() ? '-en' : '') + ".html",
                    }).done(function(data) {
                        $('body').append(data);
                        $('#popin-modedemo .popin-close').on('click', function() {
                            $('#popin-modedemo').addClass('hidden');
                            $('.popin-cache').addClass('hidden');
                        });
                    });
                }
                return false;
            });
        }
    }, 500);
});
$(function() {
    if ($('.ec-messagerie').length) {
        var messageJeuneInterval = setInterval(function() {
            if ($('meta[name="WT.z_clienttype5"]').length && $('#dixhuitvingtquatre').length && $('#vingtcinq').length) {
                if ($('meta[name="WT.z_clienttype5"]').attr('content') == '0') {
                    $('#vingtcinq').show();
                    $('#dixhuitvingtquatre').hide();
                } else {
                    $('#vingtcinq').hide();
                    $('#dixhuitvingtquatre').show();
                }
            }
        }, 500)
    }
});

$(function() {
    var assuranceVieAOEI = setInterval(function() {
        if ($('#souscription-content.mefav .progression-alt.etp-4').length > 0) {
            clearInterval(assuranceVieAOEI);
            var html = '<div id="message-aeoi" style="text-align: center"><p>Pour finaliser votre demande d\'adhésion, nous vous prions de remplir l\'auto-certification ci-jointe et de nous la retourner signée à l’adresse ci-dessous :</p>';
            html += '<p>BNP Paribas<br>Autorisation 89372<br>75443 Paris Cedex 09</p>';
            html += '<p><a href="/fr/connexion/comptes-et-contrats/mes-assurances-vie/auto-certification">Accédez à l\'auto-certification </p></div>';
            $('#zone-publiable-basse').append(html);
            $('#zone-publiable-basse').show();
        }
    }, 500);
});

// (function() {
//     "use strict";
//     $(function() {
//         setTimeout(function() {
//             var infoClient = (typeof sessionStorage.info_client !== 'undefined') ? JSON.parse(sessionStorage.info_client) : null;
//             var zonePub;
//             var pageHeader;
//             var searchHeader;

//             if(infoClient !== null) {
//                 if(infoClient.data.abonnement.codeMotifOrigineClient === "87" && $('#id_balise_div').length) {
//                     searchHeader = setInterval(function() {
//                         if($('.header-page').length && $('#zone-publiable-haute-accueil').length) {
//                             pageHeader = $('.header-page');
//                             zonePub = $('#zone-publiable-haute-accueil');
//                             clearInterval(searchHeader);
//                             pageHeader.css('margin-top', 0);
//                             zonePub.html('<img src="/rsc/contrib/image/generique/UDC-mabanque.jpg" alt="" style="width:100%;"/>');
//                             zonePub.css({
//                                 'display': 'block',
//                                 'margin-top': '60px',
//                                 'background-color': '#fff'
//                             });
//                         }
//                     }, 140);
//                 }
//             }
//         }, 4000)
//     });
// })();
/*
if($(document).getUrlParam('simulation') == 'nboon') {
    localStorage.setItem('nboOn', true);
} else if($(document).getUrlParam('simulation') == 'nbooff') {
    localStorage.removeItem('nboOn');
}*/

// if(ENVIRONNEMENT === 'PREVIEW' && localStorage.getItem('nboOn')) {
if (ENVIRONNEMENT === 'PREVIEW') {
    NBOOn = true;
    NBOUrl = '/rsc/contrib/script/nbo/nbo.bnpp.js'; // version non minifié de NBO
} else if (ENVIRONNEMENT === 'PROD' && window.location.hostname === 'mabanque.bnpparibas' || window.location.hostname === 'mabanquepro.bnpparibas' || window.location.hostname === 'mabanqueprivee.bnpparibas') {
    NBOOn = true;
    // NBOUrl = '/rsc/contrib/script/nbo/nbo.bnpp.js'; // version non minifié de NBO
} else if (ENVIRONNEMENT === 'MACHINE') {
    NBOOn = true;
}

(function() {
    if ( window.location.pathname.indexOf('/fr/connexion/comptes-et-contrats') != -1 && !location.href.match(/(\/comptes-et-contrats\/mes-contrats)/) && !location.href.match(/(\/comptes-et-contrats\?types=A-C-R)/)) {
        var zoneNboUDC = setInterval(function() {
            if ( $('#template-udc-vue-liste').length) {
                clearInterval(zoneNboUDC);
                $('#template-udc-vue-liste > section > div:nth-child(1)').after('<div id="zp_udc"></div>');
                $('#template-udc-vue-liste').after('<div id="zp_udc_bottom"></div>');
            }
        },500);
    }
})();
(function() {
    if (window.location.pathname.indexOf('/fr/espace-pro/comptes-et-contrats') != -1 ) {
        var zoneNboUDC = setInterval(function() {
            if ( $('#template-udc-vue-pro').length) {
                clearInterval(zoneNboUDC);
                $('#template-udc-vue-pro > section > div:nth-child(1)').after('<div id="zp_udc"></div>');
            }
        },500);
    }
})();
(function() {
    if (window.location.pathname.indexOf('/fr/espace-prive/comptes-et-contrats') != -1 ) {
        var zoneNboUDC = setInterval(function() {
            if ( $('#template-udc-vue-liste').length) {
                clearInterval(zoneNboUDC);
                $('#template-udc-vue-liste > section > div:nth-child(1)').after('<div id="zp_udc"></div>');
            }
        },500);
    }
})();

(function() {
    "use strict";

    if (NBOOn) {
        var readingNBO = $.ajax({
            url: NBOUrl,
            dataType: 'script',
            complete: function(response) {
                var NBOwatch = setInterval(function() {
                        if (window.NBOready) {
                            console.log('NBO Ready');
                            clearInterval(NBOwatch);
                                  setTimeout(function() {
                                  ShowHideHelper.dataShowHideSectionSlider();
                         }, 750)
                        }
                }, 150);
            }
        });
    }
})();

// $(function() {
//     if ( window.location.pathname.indexOf('/fr/souscription-pro/credits/credit-amortissable-professionnel') != -1 ) {
//         var rdvButtonInterval = setInterval(function() {
//             if ( $('#clientRDVRecapitulatif #form-client-recapitulatif button[rv-html="config.app.capro.bouton.suivant"]').length ) {
//                 clearInterval(rdvButtonInterval);
//                 $('#clientRDVRecapitulatif #form-client-recapitulatif button[rv-html="config.app.capro.bouton.suivant"]').on('click', function() {
//                     var elem = $(this);
//                     $(this).addClass('loader').css('width','109px').removeClass('btn-primary').addClass('btn-');
//                     setTimeout(function() {
//                         elem.attr({
//                             'type': 'button',
//                             'id':'submitRDVClientDemandeDisabled'
//                         });
//                     },200);
//                 });
//             }
//         },500);

//         var demandeCreditButtonInterval = setInterval(function() {
//             if ( $('#caproSimulation #recapitulatif button[rv-html="config.app.capro.bouton.valide.demande.credit"]').length ) {
//                 clearInterval(demandeCreditButtonInterval);
//                 $('#caproSimulation #recapitulatif button[rv-html="config.app.capro.bouton.valide.demande.credit"]').on('click', function() {
//                     $(this).addClass('loader').css('width','109px').removeClass('btn-primary').addClass('btn-');
//                     setTimeout(function() {
//                         elem.attr({
//                             'type': 'button',
//                             'id':'submitDemandeCreditDisabled'
//                         });
//                     },200);
//                 });
//             }
//         },500);
//     }
// });


/* blocage carte infinite MEG */
(function() {
    if (ENVIRONNEMENT == "PREVIEW") {
        if (window.location.pathname.indexOf('comptes-cartes-services/montee-en-gamme-carte') != -1) {
            var infinite_bloc_interval = setInterval(function() {
                if ($('.cap').length > 0) {
                    var inf_msg = '<div style="padding-left:30px"><div class="col-90"><div class="card col-30"><div class="icon-carte ic-big ic-infinite"></div><span class="cap"> Carte Visa Infinite</span></div><p class="carte-details col-40" style="margin: 0px; padding-left: 30px;font-size: 0.9em;">La carte que vous avez choisie n\'est souscriptible que sous certaines conditions.<br>Nous vous invitons à prendre rendez-vous avec votre conseiller.</p></div></div>';
                    $('.cap').each(function(index, value) {
                        /* remove + warning msg
                        if ($(this).text().indexOf('Infinite') != -1 && $('.cap').size() == 1) {
                            $('.cap').parents('.col-2.mob-100.avantages').remove();
                            $('.row.white-box.lb-box').html(inf_msg);
                        }
                        if ($(this).text().indexOf('Infinite') != -1 && $('.cap').size() > 1) {
                          clearInterval(infinite_bloc_interval);
                          $(this).parents('.col-2.mob-100.avantages').remove();
                        }
                        */
                        if ($(this).text().indexOf('Infinite') != -1) {
                            clearInterval(infinite_bloc_interval);
                            $(this).parents('.col-2.mob-100.avantages').html(inf_msg);
                        }
                    });
                }
            }, 500);
        }
    }
})();

//------------------------------------ CCI -----------------------------------//
// Patch UDC CCi redirection vers portefeuille titre
$(function() {
    function cciRedirPortefeuilleTitre(ribStr, url) {
        trace('execution cciRedirPortefeuilleTitre');
        if ((window.location.href.indexOf("part") > 0 || window.location.href.indexOf("mabanque.") != -1) && window.location.href.indexOf("banqueprivee.") == -1 && window.location.href.indexOf("pro.mabanque.") == -1 && window.location.href.indexOf("mabanquepro") == -1) {
            var cciDiscriminantSite = 'connexion';
        } else if (window.location.href.indexOf("bpf") > 0 || window.location.href.indexOf("banqueprivee") != -1) {
            var cciDiscriminantSite = 'espace-prive';
        } else if (window.location.href.indexOf("pro") > 0 || window.location.href.indexOf("pro.mabanque") != -1) {
            var cciDiscriminantSite = 'espace-pro';
        }

        var infoClient = JSON.parse(sessionStorage.getItem('info_client'));
        var bourseTypes = ['181', '189', '189', '185'];
        $.each(infoClient.data.contrat.comptes, function(index, value) {
            /*                trace(value.identifiantProduitCompte,bourseTypes.indexOf(value.identifiantProduitCompte))
                    trace(ribStr, value.ribAnonymise.substr(-4))*/
            if (bourseTypes.indexOf(value.identifiantProduitCompte) != -1 && ribStr == value.ribAnonymise.substr(-4) && value.codeRegroupement == 2) {
                switch (url) {
                    case "releve":
                        Mediator.sendPostData("cci.wcm.orderMask.orderConfirmation.myPortfolioInitiated", {
                            data: { securityAccNumber: value.ribAnonymise },
                            version: "2"
                        }, "/fr/" + cciDiscriminantSite + "/portefeuille-et-bourse/releve");
                        break;
                    case "carnet":
                        Mediator.sendPostData("cci.wcm.orderMask.orderConfirmation.myPortfolioInitiated", {
                            data: { securityAccNumber: value.ribAnonymise },
                            version: "2"
                        }, "/fr/" + cciDiscriminantSite + "/portefeuille-et-bourse/carnet-ordres");
                        break;
                    case "mouvements":
                        Mediator.sendPostData("cci.wcm.orderMask.orderConfirmation.myPortfolioInitiated", {
                            data: { securityAccNumber: value.ribAnonymise },
                            version: "2"
                        }, "/fr/" + cciDiscriminantSite + "/portefeuille-et-bourse/mouvements");
                        break;
                    case "passerOrdre":
                        Mediator.sendPostData("cci.wcm.orderMask.orderConfirmation.myPortfolioInitiated", {
                            data: { securityAccNumber: value.ribAnonymise },
                            version: "2"
                        }, "/fr/" + cciDiscriminantSite + "/portefeuille-et-bourse/passer-un-ordre");
                        break;
                }
            }
        });
        return false;
    }

    var flagCciSecure = 0;
    var UdcTitreInterval = setInterval(function() {
        if ($('.list-vue1.udc-titre').length && flagCciSecure == 0) {
            flagCciSecure = 1;
            clearInterval(UdcTitreInterval);

            "use strict";
            $('.list-vue1.udc-titre .js-editable, .list-vue1.udc-titre .udc-solde').on('click', function(e) {
                if (!$(this).parent().parent().find('p').hasClass('rop-ave') && $(this).text().indexOf('PEA PME E') == -1 && e.target == this) {
                    e.preventDefault();
                    e.stopPropagation();
                    var ribStr = $(this).parent().parent().children('.col-35.infos-compte').text().replace(/(\r\n|\n|\r)/gm, "").trim();
                    var index = ribStr.indexOf('N°');
                    ribStr = ribStr.substr(index + 7);
                    if (flagCciSecure == 1) {
                        cciRedirPortefeuilleTitre(ribStr, "releve");
                        flagCciSecure = 2;
                    }
                }
            });
            $('.list-vue1.udc-titre .compte-favori').on('click', function(e) {
                setTimeout(function() {
                    if ($(this).parent('li.open')) {
                        $('.list-vue1.udc-titre button.qa-fam4-mouvements').on('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            var ribStr = $(this).closest('li').find('.col-35.infos-compte').text().replace(/(\r\n|\n|\r)/gm, "").trim();
                            var index = ribStr.indexOf('N°');
                            ribStr = ribStr.substr(index + 7);
                            if (flagCciSecure == 1) {
                                cciRedirPortefeuilleTitre(ribStr, "mouvements");
                                flagCciSecure = 2;
                            }
                        });
                        $('.list-vue1.udc-titre button.qa-fam4-carnet').on('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            var ribStr = $(this).closest('li').find('.col-35.infos-compte').text().replace(/(\r\n|\n|\r)/gm, "").trim();
                            var index = ribStr.indexOf('N°');
                            ribStr = ribStr.substr(index + 7);
                            if (flagCciSecure == 1) {
                                cciRedirPortefeuilleTitre(ribStr, "carnet");
                                flagCciSecure = 2;
                            }
                        });
                        /*			                $('.list-vue1.udc-titre button.qa-fam4-passation').on('click', function(e) {
                        		                    e.preventDefault();
                        		                    e.stopPropagation();
                        		                    var ribStr = $(this).closest('li').find('.col-35.infos-compte').text().replace(/(\r\n|\n|\r)/gm,"").trim();
                        		                    var index = ribStr.indexOf('N°');
                        		                    ribStr = ribStr.substr(index+7);
                        							if(flagCciSecure == 1){
                        		                    	cciRedirPortefeuilleTitre(ribStr, "passerOrdre");
                        		                    	flagCciSecure = 2;
                        		                    }
                        		                });*/
                    }
                }, 200);
            });
            return false;
        }
    }, 500);
});

// Patch NAV DE GAUCHE synthese de mes titres CCI.
(function() {
    if ($('body').hasClass('client'))
    {
        var NavBourseEtOpc = setInterval(function() {
            if ($('.navigation-connecte li .lienTransac').length && sessionStorage.getItem('info_client')) {
                clearInterval(NavBourseEtOpc);
                var infoClient = JSON.parse(sessionStorage.getItem('info_client'));
                var bourseTypes = ['181', '189'];
                var cciCompteBourse = 0;
                if (infoClient != null) {
                    $.each(infoClient.data.contrat.comptes, function(index, value) {
                        if (bourseTypes.indexOf(value.identifiantProduitCompte) != -1) {
                            cciCompteBourse = 1;
                        }
                    });
                }
                if (cciCompteBourse == 0) {
                    $('.navigation-connecte li .lienTransac').remove();
                }
            }
        }, 500);
    }
})();

//--------------------------------- FIN CCI -----------------------------------//


(function() {
    if (/\/credits-immobiliers/.test(document.location.pathname) && GetURLParameter("perf_origine")) {
        sessionStorage.setItem("perf_origine", GetURLParameter("perf_origine"));
    }
})();

$(function() {
    if (window.location.pathname.indexOf('/fr/espace-prive/gestion/modegestion/synthese-patrimoniale') != -1) {
        $('body').addClass('comptes-contrats');
    }
    /**
     * UDC
     */
    if (
        window.location.pathname == '/fr/connexion/comptes-et-contrats' ||
        window.location.pathname == '/fr/connexion/comptes-et-contrats/' ||
        window.location.pathname == '/en/login/accounts-and-contracts/' ||
        window.location.pathname == '/en/login/accounts-and-contracts' ||
        window.location.pathname == '/fr/espace-prive/comptes-et-contrats' ||
        window.location.pathname == '/fr/espace-prive/comptes-et-contrats/' ||
        (window.location.pathname == '/fr/espace-pro/comptes-et-contrats') ||
        (window.location.pathname == '/fr/espace-pro/comptes-et-contrats/') ||
        window.location.pathname.indexOf('/rsc/contrib/dev/une-des-comptes/demo-une-des-comptes-json.html') != -1) {
        $('body').addClass('comptes-contrats');
        if (DeviceSize.getDeviceState() == 'desktop') {
            var headerIntervalDesktop = setInterval(function() {
                if ($('.header-page.header-udc').length && $(".title-udc").length == 0) {
                    $('.header-page.header-udc').append('<h1 class="title-udc">' + _get('next.fix.udccomptes1', 'Mes comptes') + '</h1>');
                    //clearInterval(headerInterval);
                }
            }, 500);
        }
        if (DeviceSize.getDeviceState() == 'mobile') {
            var headerIntervalMobile = setInterval(function() {
                $('.header-page.header-udc h1').hide();
                if ($('#udc-famille-ancre').length) {
                    $('#udc-famille-ancre').hide();
                    $('.full-cache').hide();
                }
            }, 10);
        }

        var placeholderInterval = setInterval(function() {
            if ($('#input-search-compte').length && window.location.pathname.indexOf('/comptes-et-contrats/mes-cartes') == -1) {
                $('#input-search-compte').attr('placeholder', _get('next.fix.udccomptes2', 'Rechercher un compte'));
                clearInterval(placeholderInterval);
            }
        }, 500);

        var listeUDCInterval = setInterval(function() {
            if ($('.icon-stylo-small').length) {
                $('.icon-stylo-small').on('mouseenter', function() {
                    $('.libelle-stylo').remove();
                    var top = $(this).position().top;
                    var left = $(this).position().left;
                    $(this).after('<div class="help-text-popup libelle-stylo" style="color: #212121; text-transform: none"><div class="arrow" style="left: 13px;"></div><div class="popover-content"><p> ' + _get("next.fix.modifcomptename", "Modifier le nom du compte") + '</p></div></div>');
                    $('.libelle-stylo').css({
                        top: top,
                        left: left
                    });
                }).on('mouseleave', function() {
                    $('.libelle-stylo').remove();
                });
                clearInterval(listeUDCInterval);
            }
        }, 500);

        var boutonVueInterval = setInterval(function() {
            if ($('.active-liste').hasClass('active')) {
                $('.active-liste').hide();
                $('.active-mosaique').show();
            }
            if ($('.active-mosaique').hasClass('active')) {
                $('.active-mosaique').hide();
                $('.active-liste').show();
            }

            $('.a-venir').find('strong:not(.js-avenir-famille)').each(function() {
                    if ($(this).text() == "0,00 €") {
                        $(this).parent('span').css('border-bottom', 'none');
                        $(this).parent('span').next('span').hide();
                        $(this).parent('span').next('span').next('span').hide();
                    };
                })
                //clearInterval(boutonVueInterval);
        }, 500);
    }


});

/*
(function() {
    if ( window.location.pathname.indexOf('messagerie') != -1 ) {
        setInterval(function() {
            if ( $('#upload-fileRepondre').length || $('#upload-fileEcrire').length ) {
                var html = '<div class="row form-info" style="padding: 10px;"><i class="icon icon-info pull-left violet"></i><p class="violet">L\'ajout de pièces jointes peut bloquer l\'envoi de votre message dans certains cas.</p></div>';
                if ( $('#upload-fileRepondre').next('.row.form-info').length == 0 ) {
                    $('#upload-fileRepondre').after(html);
                }
                if ( $('#upload-fileEcrire').next('.row.form-info').length == 0 ) {
                    $('#upload-fileEcrire').after(html);
                }
            }
        },500);
    }
})();
*/
(function fakeObtenirUnNouveauCode() {
    var NUMERO_MOBILE_PATH = '/fr/connexion/mes-outils/profil/numero-de-mobile';
    var interval;

    function isNumeroMobilePage() {
        return window.location.pathname.indexOf(NUMERO_MOBILE_PATH) !== -1;
    }

    function hasNumeroButton() {
        var _$btnNouveauCode = $('#btn-nouveau-code');

        return _$btnNouveauCode.length > 0;
    }

    function toFakeButton() {
        var fakeButtonHtml, $fakeButtonHtml;
        var popinHTML, $popinHTML;
        var $btnNouveauCode;
        var initFakeButton;
        var $popinContinue;


        $btnNouveauCode = $('#btn-nouveau-code');
        $popinContinue = $('#popin-continue');

        fakeButtonHtml = "";
        fakeButtonHtml += "<a id=\"fake-btn-nouveau-code\" class=\"btn-secondary pull-right\" data-show-popin=\"#nouveauCodePopin\">Obtenir un nouveau code<\/a>";

        popinHTML = "";
        popinHTML += "<div id=\"nouveauCodePopin\" class=\"popin popin-alert hidden\">";
        popinHTML += "    <a class=\"close popin-close\">✕<\/a>";
        popinHTML += "    <div class=\"popin-content confirmation\">";
        popinHTML += "      <div class=\"icon-form-info mtn\"><\/div>";
        popinHTML += "      <p class=\"big violet mvn\">";
        popinHTML += "        Vous avez déjà demandé un code que vous avez reçu ou que recevrez prochainement par courrier.";
        popinHTML += "      <\/p>";
        popinHTML += "";
        popinHTML += "      <p>Si vous renouvelez votre demande, le code précédent sera désactivé.";
        popinHTML += "        Souhaitez-vous tout de même poursuivre votre demande de nouveau code ?<\/p>";
        popinHTML += "";
        popinHTML += "      <button type=\"button\" class=\"btn-secondary small popin-close\">Annuler<\/button>";
        popinHTML += "      <a type=\"button\" class=\"btn-primary small popin-close\" id=\"popin-continue\">OK<\/a>";
        popinHTML += "    <\/div>";
        popinHTML += "  <\/div>";

        $fakeButtonHtml = $($.parseHTML(fakeButtonHtml));
        $popinHTML = $($.parseHTML(popinHTML));

        initFakeButton = function initFakeButton() {
            $btnNouveauCode.addClass('hidden');
            $fakeButtonHtml.insertBefore($btnNouveauCode);
            $popinHTML.insertAfter($btnNouveauCode);

            // activate popin
            Popin.init();
            $('body').delegate('#popin-continue', 'click', function() {

                $btnNouveauCode.trigger('click');
            });
            $('#fake-btn-nouveau-code').on('click', function() {
                $popinContinue.removeAttr('disabled');
            });

            initFakeButton = function() {};
        };

        initFakeButton();
    }

    interval = window.setInterval(function detectPageAndButton() {
        var isPage = isNumeroMobilePage();
        var hasButton = hasNumeroButton();

        if (isPage && hasButton) {
            toFakeButton();
            window.clearInterval(interval);
        }
    }, 500);
})();
// GESTION MENU NAV BPF et PART - AJOUTER LA REGLE PART POUR LA PUBLI
$(function() {
    if (window.location.pathname == '/fr/connexion/comptes-et-contrats/mes-contrats' || window.location.pathname == '/en/login/accounts-and-contracts/insurance-policies') {
        var mesAssurancesInterval = setInterval(function() {
            if ($('#id_balise_div').find('ul.onglet').length) {
                clearInterval(mesAssurancesInterval);
                if ($('#id_balise_div').find('ul.onglet').text().trim() == '') {
                    $('#id_balise_div').find('ul.onglet').remove();
                }
            }
        }, 500);
    }
    if (
        window.location.pathname.indexOf('/virements-services/virements') != -1 ||
        window.location.pathname.indexOf('/virements-services/rib') != -1 ||
        window.location.pathname.indexOf('/virements-services/oppositions') != -1 ||
        window.location.pathname.indexOf('/virements-services/commande-chequiers') != -1 ||
        window.location.pathname.indexOf('/virements-services/mobilite-bancaire/facilimouv') != -1 ||
        window.location.pathname.indexOf('/virements-services/mobilite-bancaire') != -1 ||
        window.location.pathname.indexOf('/virements-services/mobilite-bancaire-facilimouv') != -1 ||
        window.location.pathname.indexOf('/virements-services/telechargement-des-operations') != -1 ||
        window.location.pathname.indexOf('/virements-services/autorisation-de-prelevement') != -1 ||
        window.location.pathname.indexOf('/virements-services/autorisation-de-prelevement') != -1 ||
        window.location.pathname.indexOf('/virements-services/paylib') != -1 ||
        window.location.pathname.indexOf('/virements-services/mobilite-bancaire') != -1 ||
        window.location.pathname.indexOf('/comptes-et-contrats/mes-cartes') != -1 ||
        window.location.pathname.indexOf('/comptes-et-contrats/mes-contrats') != -1 ||
        window.location.pathname.indexOf('/comptes-et-contrats/suivre-mon-budget') != -1 ||
        window.location.pathname.indexOf('/virements-services/suivre-mon-budget') != -1 ||

        window.location.pathname.indexOf('/services-transfers/transfers') != -1 ||
        window.location.pathname.indexOf('/services-transfers/bank-account-details') != -1 ||
        window.location.pathname.indexOf('/services-transfers/blocks') != -1 ||
        window.location.pathname.indexOf('/services-transfers/checkbook-order') != -1 ||
        window.location.pathname.indexOf('/services-transfers/download-transaction-details') != -1 ||
        window.location.pathname.indexOf('/services-transfers/direct-debit-authorization') != -1 ||
        window.location.pathname.indexOf('/services-transfers/paylib') != -1 ||
        window.location.pathname.indexOf('/accounts-and-contracts/cards') != -1 ||
        window.location.pathname.indexOf('/accounts-and-contracts/insurance-policies') != -1 ||
        window.location.pathname.indexOf('/accounts-and-contracts/track-your-budget') != -1 ||
        window.location.pathname.indexOf('/services-transfers/track-your-budget') != -1
    ) {
        $('body').addClass('new-nav');
    }
    if (
        window.location.pathname.indexOf('/fr/connexion/comptes-et-contrats/mes-titres') != -1 ||
        window.location.pathname.indexOf('/fr/connexion/portefeuille-et-bourse/') != -1
        ) {
        $('body').addClass('bourse ');
    }
    if (window.location.pathname.indexOf('/fr/connexion/') != -1 || window.location.pathname.indexOf('/en/login') != -1 || window.location.pathname.indexOf('/fr/espace-prive/') != -1 || window.location.pathname.indexOf('/fr/espace-pro/') != -1) {
        setInterval(function() {
            if ($('.onglet.sous-section').length && $('.onglet.sous-section').is(':visible') && !$('.legende-etape').length) {
                $('.header-page').addClass('has-gellules').removeClass('no-gellules');
            } else {
                $('.header-page').addClass('no-gellules').removeClass('has-gellules');
            }
            if ($('.header-page .actions-rapides').length && $('.header-page .actions-rapides').is(':visible')) {
                $('.header-page').addClass('has-quick-access');
            } else {
                $('.header-page').removeClass('has-quick-access');
            }
            if (window.location.pathname.indexOf('virements-services/paylib') != -1 || window.location.pathname.indexOf('services-transfers/paylib') != -1) {
                $('#onglet-paylib').addClass('active');
            }
            if (window.location.pathname.indexOf('virements-services/commande-chequiers') != -1 && $('.row.etapes').length == 0) {
                $('.header-page h2').text('Chéquiers');
            }
            if (window.location.pathname.indexOf('services-transfers/checkbook-order') != -1 && $('.row.etapes').length == 0) {
                $('.header-page h2').text('Checkbook');
            }
            if (window.location.pathname == '/fr/connexion/comptes-et-contrats/mes-contrats' ||
                window.location.pathname == '/fr/connexion/comptes-et-contrats/mes-contrats/' ||
                window.location.pathname == '/en/login/accounts-and-contracts/insurance-policies' ||
                window.location.pathname == '/en/login/accounts-and-contracts/insurance-policies/' ||
                window.location.pathname == '/fr/espace-prive/comptes-et-contrats/mes-contrats' ||
                window.location.pathname == '/fr/espace-prive/comptes-et-contrats/mes-contrats/' ||
                window.location.pathname == '/fr/espace-pro/comptes-et-contrats/mes-contrats' ||
                window.location.pathname == '/fr/espace-pro/comptes-et-contrats/mes-contrats'
            ) {
                $('.header-page h2').text(_get('next.fix.mescontrats', 'Mes assurances'));
            }
            if (window.location.pathname.indexOf('/services-transfers/transfers') != -1 && $('ul.etapes').length == 0) {
                $('.header-page h2').text('Transfers');
            }
            if (window.location.pathname.indexOf('virements-services/virements') != -1 && $('ul.etapes').length == 0) {
                $('.header-page h2').text('Virements');
            }
            if (window.location.pathname.indexOf('virements-services/oppositions/historique-des-oppositions') != -1) {
                $('.header-page h2').text('Oppositions');
            }
            if (window.location.pathname.indexOf('services-transfers/blocks/block-history') != -1) {
                $('.header-page h2').text('Blocks');
            }
        }, 500);
    }
});

// GESTION BPF
$(function() {
    (function() {
        if ($('body').hasClass('bpf')) {

            ///////////////////////////////////////// COLOR VIOLET TEXTES //////////////////////////////////////////////////////////////

            var violetText = setInterval(function() {
                $('p i.icon-info, span i.icon-info').each(function() {
                    if ($(this).hasClass('violet')) {
                        $(this).parent().addClass('info-text-violet');
                    }
                });

            }, 500);

            if ($(".wrap").length > 0) {
                clearInterval(violetText);
            }

            //END/////////////////////////////////////// COLOR VIOLET TEXTES //////////////////////////////////////////////////////////////



            //////////////////////////////////////////// SCROLL TOP //////////////////////////////////////////////////////////////

            $('body.bpf').append('<div class="scroll-to-top-btn"><i class="icon icon-back"></i></div>');


            $(window).scroll(function() {
                if ($(this).scrollTop() > 100) {
                    $('.scroll-to-top-btn').fadeIn();
                } else {
                    $('.scroll-to-top-btn').fadeOut();
                }
            });

            //Click event to scroll to top
            $('.scroll-to-top-btn').click(function() {
                $('html, body').animate({ scrollTop: 0 }, 800);
                return false;
            });


            //////////////////////////////////////////// END SCROLL TOP //////////////////////////////////////////////////////////////


            ////////////////////////////////////////////  SCROLL TO //////////////////////////////////////////////////////////////
            $('.fpbpf_avantages a').click(function() {
                var target = $(this).attr("href");
                console.log(target);
                $(document.body).animate({
                    'scrollTop': $(target).offset().top - 150
                }, 500);

            });

            $(function() {
                if (ENVIRONNEMENT == 'PREVIEW') {

                    $('body').on('click', '[data-anchor]', function() {
                        console.log($('.liste-famille-compte > div').length);

                        var $current = $(this);
                        console.log("$curent", $current);
                        setTimeout(function() {
                            var offset = $('[data-index=' + $current.data('anchor') + ']').offset();
                            console.log("$current.data('anchor')", $current.data('anchor'));
                            console.log("offset", offset);
                            console.log("$('.barre-recherche').height()", $('.barre-recherche').height())
                            offset = offset.top - $('.barre-recherche').height();
                            console.log("offset", offset);
                            if ($('.liste-famille-compte > div').length == 1) {
                                console.log('une seule famille de compte');
                                offset = offset - 80;
                            }
                            $('html, body').animate({ scrollTop: offset }, 200);
                        }, 100)
                    });
                }
            });

            //////////////////////////////////////////// END SCROLL TO //////////////////////////////////////////////////////////////


            //////////////////////////////////////////// FAQ SHOW HIDE & ELEMENT LENGTH ////////////////////////////////////////////////////
            $('ul[id*="fp_faqListe"]').click(function() {
                $(this).toggleClass('opened-question');

            });

            var allQuestionsNumber = $('.faq-listes').length;
            $('#fp_faqListe-el-length').html(allQuestionsNumber);

            function questionnumberbylist() {

                $('#fp_faq section').each(function() {
                    //compare class with id name
                    var nameReference = $(this).attr('id');
                    //calculate elements length
                    var eachSectionQuestionsNumber = $('#' + nameReference).find('ul').length;
                    //insert elements length in html
                    $('.' + nameReference).html(eachSectionQuestionsNumber);
                });
            }
            questionnumberbylist();


            //////////////////////////////////////////// END FAQ SHOW HIDE & ELEMENT LENGTH ////////////////////////////////////////////////



            //////////////////////////////////////////// PLAFONDS DOUBLE HEADER CORRECTION ////////////////////////////////////////////////
            var hideCarteHeader = setInterval(function() {
                if ($("#ia-udcarte").find('.header-page ').length > 0) {
                    $("#wcm-l-nav-udcartes").addClass('hidden');
                    $("#ia-udcarte, .wcm-fil-ariane-header").addClass('modifier-plafonds');
                    clearInterval(hideCarteHeader);
                }
            }, 500);

            //////////////////////////////////////////// END  PLAFONDS DOUBLE HEADER CORRECTION ////////////////////////////////////////////////


            //////////////////////////////////////////// VIDEO HOMEPAGE //////////////////////////////////////////////////////////////



            $('#wapper-home-bpf #hp-video .level2.bpf-home-header .wcm-image').after('<div class="bouton-play"><p>Pour visualiser le nouveau film BNP Paribas Banque Privée, cliquez ici</p><div class="icon-play"></div></div><div class="home-video"><iframe width="1250" height="600" src="https://www.youtube.com/embed/Ly7Xko9ulBI" frameborder="0" allowfullscreen></iframe></div>');
            $('#wapper-home-bpf').before('<div class="close hp-video">X</div>');
            $('.close.hp-video').addClass('hidden');
            $('#wapper-home-bpf .level2.bpf-home-header').click(function() {
                console.log('fix');
                $('.bpf-home-header .bpf-home-header').addClass('hidden');
                $(this).find('.wcm-image').addClass('hidden');
                $(this).find('.bouton-play').addClass('hidden');
                $(this).find('.home-video').addClass('played');
                $('.close.hp-video').removeClass('hidden');
            });

            $('.close.hp-video').click(function() {
                console.log('close passe');
                $('.bpf-home-header .bpf-home-header').removeClass('hidden');
                $('.wcm-image').removeClass('hidden');
                $('.bouton-play').removeClass('hidden');
                $('.home-video').removeClass('played');
                $(this).addClass('hidden');
            });




            //END/////////////////////////////////////// VIDEO HOMEPAGE //////////////////////////////////////////////////////////////
            //
            //////////////////////////////////////////// VIDEO CLE DIGITALE //////////////////////////////////////////////////////////////

            if (window.location.href.match(/cle-digitale/) !== null) {
                var newNavElementActive = setInterval(function() {
                    $('body').addClass('cle-digitale');
                    clearInterval(newNavElementActive);
                }, 500);
            }

            //END/////////////////////////////////////// VIDEO CLE DIGITALE //////////////////////////////////////////////////////////////


            //////////////////////////////////////////// GESTION MENU NAV BPF //////////////////////////////////////////////////////////////
            //pour comptes et contrats
            if (window.location.href.match(/comptes-et-contrats/) !== null || window.location.href.match(/modegestion/) !== null) {
                var newNavElementActive = setInterval(function() {
                    $('#nav2-comptes').addClass('selected');
                    clearInterval(newNavElementActive);
                }, 500);
            }

            //pour virements et services
            if (window.location.href.match(/virements-services/) !== null) {
                var newNavElementActive = setInterval(function() {
                    $('#nav3-virement-services').addClass('selected');
                    clearInterval(newNavElementActive);
                }, 500);
            }

            //pour informations marchés
            if (window.location.href.match(/informations-marches/) !== null || window.location.href.match(/portefeuille-et-bourse/) !== null) {
                var newNavElementActive = setInterval(function() {
                    $('#nav4-infos-marche').addClass('selected');
                    clearInterval(newNavElementActive);
                }, 500);
            }

            //pour analyses et reco
            if (window.location.href.match(/analyses-recommandations/) !== null) {
                var newNavElementActive = setInterval(function() {
                    $('#nav5-analyses-reco').addClass('selected');
                    clearInterval(newNavElementActive);
                }, 500);
            }

            //pour  CERTLE WEALTH
            if (window.location.href.match(/le-cercle-wealth/) !== null) {
                var newNavElementActive = setInterval(function() {
                    $('#nav7-le-cercle-wealth').addClass('selected');
                    clearInterval(newNavElementActive);
                }, 500);
            }

            //pour solution patrimoniales
            if (window.location.href.match(/conseil-patrimonial-et-financier/) !== null || window.location.href.match(/conseil-patrimonial-et-financier/) !== null || window.location.href.match(/nos-solutions-dediees/) !== null || window.location.href.match(/decouvrir-la-banque-privee/) !== null) {
                console.log('preview');
                var newNavElementActive = setInterval(function() {
                    $('#nav6-solutions-pat').addClass('selected');
                    $('.wcm-fil-ariane-header').addClass('fil-ariane-sans-menu');
                    clearInterval(newNavElementActive);
                }, 500);
            }


            //pour contact
            if (window.location.href.match(/banque-contact/) !== null) {
                var newNavElementActive = setInterval(function() {
                    $('#nav8-contact').addClass('selected');
                    clearInterval(newNavElementActive);
                }, 500);
            }

            //pour aide
            if (window.location.href.match(/besoin-d-aide/) !== null || window.location.href.match(/decouvrir-nouveau-site/) !== null) {
                var newNavElementActive = setInterval(function() {
                    $('#nav9-aide').addClass('selected');
                    clearInterval(newNavElementActive);
                }, 500);
            }

            //fix
            //pour paylib

            if (window.location.href.match(/paylib/) !== null) {
                var navElementActive = setInterval(function() {
                    $('.onglet li a[href*="paylib"]').addClass('active');
                }, 500);

                if ($("h2[rv-html='config.app.peps.generic.paylib']").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            //fil d'ariane pour certains pages

            //exception pour experts
            if (window.location.href.match(/portraits-dexperts/) !== null) {
                var navElementActive = setInterval(function() {
                    $('.wcm-fil-ariane-header').addClass('bpf-expert');
                }, 500);

                if ($(".fpbpf_decouverte").length > 0) {
                    clearInterval(navElementActive);
                }
            }
            //pour cle digitale

            if (
                window.location.href.match(/cle-digitale/) !== null ||
                window.location.href.match(/faire-opposition-a-sa-carte-bancaire/) !== null ||
                window.location.href.match(/code-secret-oublie-ou-perdu/) !== null ||
                window.location.href.match(/carte-refusee-ou-avalee-au-distributeur/) !== null ||
                window.location.href.match(/carte-refusee-ou-avalee-chez-un-commercant/) !== null ||
                window.location.href.match(/problemes-de-billets-au-distributeur/) !== null ||
                window.location.href.match(/securite-paiement-internet/) !== null
            ) {
                var navElementActive = setInterval(function() {
                    //$('.wcm-fil-ariane-header').addClass('fil-ariane-sans-menu');
                    $('#colonneContactContainer').addClass('special2');
                }, 500);

                if ($("#colonneContactContainer").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            //pour cle paylib

            if (window.location.pathname.endsWith('/cartes-et-moyens-de-paiement/paylib') || window.location.pathname.endsWith('/cartes-et-moyens-de-paiement/paylib/')) {
                var navElementActive = setInterval(function() {
                    $('#colonneContactContainer .btn-primary.forceColor').click(function() {
                        document.location.href = "https://mabanqueprivee.bnpparibas/fr/espace-prive/virements-services/paylib";
                    });

                    //$('.wcm-fil-ariane-header').addClass('fil-ariane-sans-menu');
                    $('#colonneContactContainer').addClass('special-paylib');
                    $('.colonne-contact').removeClass('disabled');
                }, 500);

                if ($("#colonneContactContainer").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            //pour aide et contact

            if (window.location.href.match(/decouvrir-la-banque-privee/) !== null || window.location.href.match(/charte-et-rapport-de-la-mediation-bancaire-bnp-paribas/) !== null || window.location.href.match(/fonds-de-garantie-des-depots-et-de-resolution/) !== null || window.location.href.match(/politique-de-selection-etablie-par-bnp-paribas/) !== null) {
                var navElementActive = setInterval(function() {
                    $('.wcm-fil-ariane-header').addClass('fil-ariane-sans-menu');
                    $('#colonneContactContainer').addClass('special');
                }, 500);

                if ($(".fpbpf_decouverte").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            /*if ((ENVIRONNEMENT == 'PROD') && (window.location.href.match(/loi-eckert/) !== null)) {
                var navElementActive = setInterval(function() {
                    $('#colonneContactContainer').addClass('special');
                }, 500);

                if ($("#colonneContactContainer").length > 0) {
                    clearInterval(navElementActive);
                }
            }*/

            /*if ((ENVIRONNEMENT == 'PREVIEW') && (window.location.href.match(/loi-eckert/) !== null)) {
                var navElementActive = setInterval(function() {
                    $('.wcm-fil-ariane-header').addClass('fil-ariane-sans-menu');
                }, 500);

                if ($("#colonneContactContainer").length > 0) {
                    clearInterval(navElementActive);
                }
            }
*/
            // pour mes contacts
            if (window.location.href.match(/conseiller/) !== null) {
                $('.onglet-nav , .header-page-contact-bpf').addClass('mes-contacts-nav');

            }

            //exception pour page bonne pratique
            if (window.location.href.match(/banque-en-ligne-les-bonnes-pratiques/) !== null) {
                var navElementActive = setInterval(function() {
                    $('.wcm-fil-ariane-header').addClass('fil-ariane-sans-menu');
                    // rétalissement du bloc prendre rdv
                    //$('#colonneContactContainer').addClass('hidden');
                }, 500);

                if ($(".fpbpf_decouverte").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            //exception pour page site secu
            if (window.location.href.match(/site-securise/) !== null) {
                var navElementActive = setInterval(function() {
                    $('.wcm-fil-ariane-header').addClass('fil-ariane-sans-menu');
                    $('#nav_bpf').addClass('hidden');
                    $('.bottom-header-connected').css('background-color', '#ffffff');
                }, 500);

                if ($(".fpbpf_decouverte").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            //exception pour sinistre
            if (window.location.href.match(/declarer-un-sinistre/) !== null) {
                var navElementActive = setInterval(function() {
                    $('.wcm-fil-ariane-header').addClass('fil-ariane-sans-menu');
                    $('#colonneContactContainer').addClass('special-sinistre');
                }, 500);

                if ($("#colonneContactContainer").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            //exception pour pages bourse mentions legales et aide passage ordre
            if (window.location.href.match(/aide-passation-ordre-sur-bourse-france/) !== null) {
                var navElementActive = setInterval(function() {
                    $('.wcm-fil-ariane-header').addClass('fil-ariane-sans-menu');
                    $('#colonneContactContainer').addClass('special-ordre');
                }, 500);

                if ($("#colonneContactContainer").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            if (window.location.href.match(/mentions-legales/) !== null) {
                var navElementActive = setInterval(function() {
                    $('#colonneContactContainer').addClass('special-legalmention');
                }, 500);

                if ($("#colonneContactContainer").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            /*if ((ENVIRONNEMENT == 'PREVIEW') && (window.location.href.match(/banque-en-ligne-les-bonnes-pratiques/) !== null ) ) {
               var navElementActive = setInterval(function() {
                    $('#w1437495314069').parents('.ls-fxr').children('#fp-mentionsLegales').addClass('hidden');
               },500);

                if($("#colonneContactContainer").length > 0){
                    clearInterval(navElementActive);
                }
            }*/
            if (window.location.href.match(/banque-en-ligne-les-bonnes-pratiques/) !== null) {
                var wfd = GlobalSite.waitForDom.bind(GlobalSite);
                wfd("#w1437495314069", function callback($elt) { // on attend un element ayant la classe 'aa'
                    $elt.parents('.ls-fxr').children('#fp-mentionsLegales').addClass('hidden');

                });
            }

            //exception pour page contact - reglementation


            if ( (window.location.href.match(/reglementation/) !== null) && (window.location.href.match(/loi-eckert/) == null)) {
                var navElementActive = setInterval(function() {
                    $('.header-page').addClass('special');
                }, 500);

                if ($(".has-onglet h1").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            if (window.location.href.match(/donnez-votre-avis/) !== null || window.location.href.match(/votre-reaction/) !== null || window.location.href.match(/pourquoi-changer/) !== null) {
                var navElementActive = setInterval(function() {
                    $('.onglet .js-onglet-current  a.active').removeClass('active');
                }, 500);

                if ($('.navHeader').length > 0 || $('#animationContainer').length > 0) {
                    clearInterval(navElementActive);
                }
            }

            //ajoute une classe .chequiers-block au div #id_balise_div dans la page commande chequiers car le html est trop générique
            if (window.location.href.match(/commande-chequiers/) !== null) {
                var navElementActive = setInterval(function() {
                    $('#id_balise_div').addClass('chequiers-block');
                }, 500);

                if ($(".header-page h2").length > 0) {
                    clearInterval(navElementActive);
                }
            }

            //ajoute une classe .analyses-recommandations au header  dans la page analyses-recommandations-financieres - conflit avec body.preview.bpf  .header-page
            if (window.location.href.match(/analyses-recommandations-financieres/) !== null) {
                var navElementActive = setInterval(function() {
                    $('.header-page').addClass('analyses-recommandations');
                }, 500);

                if ($("#note-orientation").length > 0) {
                    clearInterval(navElementActive);
                }
            }


        }
    })();
});

/* Main menu, active */
$(function() {
    if (ENVIRONNEMENT == 'PREVIEW') {
        // Get url pathname
        var pathname = document.location.pathname.split('/');
        // Remove first empty array
        pathname.shift();
        var i = 0,
            length = pathname.length;
        // For each parts of the pathname, check for particular word
        // if exist add active class to corresponding menu
        for (i; i < length; i++) {
            switch (pathname[i]) {
                case 'comptes-et-contrats':
                    $("#mainMenu li").removeClass('selected');
                    $("#nav2-comptes").addClass('selected');
                    break;
                case 'virements-services':
                    $("#mainMenu li").removeClass('selected');
                    $("#nav3-virement-services").addClass('selected');
                    break;
                case 'suivre-mon-budget':
                    $("#mainMenu li").removeClass('selected');
                    $("#nav4-budget").addClass('selected');
                    break;
                case 'bourse':
                    $("#mainMenu li").removeClass('selected');
                    $("#nav5-portefeuille-bourse").addClass('selected');
                    break;
                case 'notre-offre':
                    $("#mainMenu li").removeClass('selected');
                    $("#nav6-produits").addClass('selected');
                    break;
                case 'vos-besoins':
                    $("#mainMenu li").removeClass('selected');
                    $("#nav7-besoins").addClass('selected');
                    break;
                case 'banque-contacts':
                case 'nous-contacter':
                    $("#mainMenu li").removeClass('selected');
                    $("#nav8-contact").addClass('selected');
                    break;
                case 'bons-plans':
                    $("#mainMenu li").removeClass('selected');
                    $("#nav9-bon-plan").addClass('selected');
                    break;
                case 'ma-banque-et-moi':
                    $("#mainMenu li").removeClass('selected');
                    $("#nav9-mabanque").addClass('selected');
                    break;
            }
        }
    }
});
/* End main menu, active */

/* Resize infos carre FP */
$(function() {
    if (ENVIRONNEMENT == 'PREVIEW') {
        if ($('body').hasClass('fp') && $("#fp_infos_carre").length) {
            var resizeCarreInterval = setInterval(function() {
                if ($("#colonneContactContainer").length > 0) {
                    if ((DeviceSize.getDeviceState() == 'mobile'))
                        resizeInfosCarreFP(true);
                    else
                        resizeInfosCarreFP();
                }
                clearInterval(resizeCarreInterval);
            }, 300);

            $(window).resize(function() {
                if ((DeviceSize.getDeviceState() == 'mobile'))
                    resizeInfosCarreFP(true);
                else
                    resizeInfosCarreFP();
            });
        }

        function resizeInfosCarreFP(mobile) {
            var maxHeight = 0;
            // Reset all heights
            $(".fp-carre-infos.xml-section").height('');
            // If resize on mobile device, stop resize
            if (mobile)
                return false;
            // For each section, get the greatest height
            $(".fp-carre-infos.xml-section").each(function() {
                if ($(this).height() > maxHeight)
                    maxHeight = $(this).height();
            });
            // Set greatest height to each sections
            $(".fp-carre-infos.xml-section").height(maxHeight);
        }
    }
});
/* End resize infos carre FP */

$(function() {
    /* modifications arbitrage mode webview */
    if (window.location.pathname.indexOf('mes-assurances-vie') != -1 && $('body').hasClass('webview')) {
        var bnpnet_msg_interval = setInterval(function() {
            if ($('.back').text() == "Abandonner" || $('.back').text() == "Retour à vos contrats") {
                $('.back').hide();
            }
            $('.details').on('click', '.ajouter-support', function() {
                $('body').scrollTop();
            })
        }, 500);
    }
});

$(function() {
    if (ENVIRONNEMENT == 'PREVIEW') {
        //$('body').addClass('new-nav-mobile');
    }
});

  /*
$(function() {
    if (window.location.pathname.indexOf('/mes-outils/profil/code-secret') != -1) {
        var fixDateNaissance = setInterval(function() {

            if ($('#wcm-l-title-code-secret').length) {
                $.ajax({
                    url: "/rsc/contrib/html/espaceclient/profil/msg-mcs.html"
                }).done(function(data) {
                    clearInterval(fixDateNaissance);
                    $('header.header-page').after(data);
                });
            }


            if ( $('#input-date-naissance').length ) {
              clearInterval(fixDateNaissance);
              $('#input-date-naissance').off('focus');

        }, 500);
    }
});
*/

$(function() {
    if (window.ENVIRONNEMENT && window.ENVIRONNEMENT === "PREVIEW") {
        if (window.location.pathname.indexOf('mes-outils/profil/code-secret') != -1) {
            var isModifSecretInterval = setInterval(function() {
                if ($("#ia-modifiercodesecret").length && $("#secret-nbr-keyboard").length) {
                    var codeSecretInterval = setInterval(function() {
                        $(".moving-grid").stop(true, true);
                        if ($("#secret-actuel").val().length < 6)
                            var top = calculateTopMovingGrid($("#secret-actuel"));
                        else if ($("#secret-modif").val().length < 6)
                            var top = calculateTopMovingGrid($("#secret-modif"));
                        else if ($("#secret-confirm").val().length < 6)
                            var top = calculateTopMovingGrid($("#secret-confirm"));

                        $(".moving-grid").css('top', top);
                    }, 100);
                    clearInterval(isModifSecretInterval);
                }
            }, 100);

            function calculateTopMovingGrid(currentInput) {
                var gridHalfSize = $(".moving-grid").height() / 2;
                var inputHalfSize = currentInput.outerHeight() / 2;
                var inputTopOffset = currentInput[0].getBoundingClientRect().top;
                $(".moving-grid").css('top', 0);
                var movingGridTopOffset = $(".moving-grid")[0].getBoundingClientRect().top;

                var top = inputTopOffset - movingGridTopOffset - (gridHalfSize - inputHalfSize);

                return top;
            }
        }
    }
});

$(function() {
    if (window.location.pathname.indexOf('/comptes-et-contrats/mes-cartes') != -1 && $('body').hasClass('marne')) {
        var mpp_interval = setInterval(function() {
            if ($('.progression').length > 0) {
                $('#wcm-l-nav-udcartes').find('.header-page').addClass('hidden');
                $('.onglet-container').find('li').addClass('hidden');
                $('.abort').removeClass('hidden');
            }
        }, 500);
    }
});

$(function() {
    if (window.location.pathname.indexOf('/comptes-et-contrats/mes-cartes') != -1) {
        var udcartesOpen_interval = setInterval(function() {
            if ($('.list-vue1').length > 0) {
                $('.folder-btn').trigger('click');
                clearInterval(udcartesOpen_interval);
            }
        }, 500);
    }
});

$(function() {
    if ($('#zp_accueil_carousel').length) {
        if (new Date().getTime() >= new Date(2016, 4, 28, 23, 59).getTime()) {
            $('.item.voisins').remove();
            $('.item.hidden').removeClass('hidden');
        }
    }
});

$(function() {
    if ($('body').hasClass('pro') && $('body').hasClass('marne')) {
        $.get('/mefav-wspl/rest/natioViePro', function(mefav_pro, status, request) {
            if (mefav_pro.message == 'OK') {
                var mefav_pro_url = "https://www.clients.assurance-vie.fr/servlets/helios.cinrj.htmlnav.runtime.FrontServlet?app=BNPNET&init=true&multiInit=false&hageGroup=consultationBnpnet";
                $.each(mefav_pro.data.nationVieProInfos.listeP, function(i, item) {
                    mefav_pro_url += "&" + i + "=" + item;
                });
                mefav_pro_url += "&a0=" + mefav_pro.data.nationVieProInfos.a0;
                var mefav_pro_interval = setInterval(function() {
                    if ($('#mesAssurancesVie').length > 0) {
                        $('#mesAssurancesVie').parent().removeClass('hidden');
                        $('#mesAssurancesVie').attr('href', mefav_pro_url);
                        clearInterval(mefav_pro_interval);
                    }
                }, 500);
            }
        });
    }
});

$(function() {
    var isGoodPage;
    var intervalId;
    isGoodPage =
        window.location.pathname.indexOf('/fr/connexion/virements-services/virements') != -1 ||
        window.location.pathname.indexOf('/en/login/services-transfers/transfers') != -1 ||
        window.location.pathname.indexOf('/fr/espace-pro/virements-services/virements') != -1 ||
        window.location.pathname.indexOf('/fr/espace-prive/virements-services/virements') != -1;
    if (!isGoodPage) return;
    intervalId = setInterval(function() {
        var isEltsDispo,
            isColDispo,
            isFormDispo,
            isCibleDispo,
            isParent,
            isElDispo;
        isFormDispo = $('.form-vu').length > 0;
        isColDispo = $('#ia-virement .col-2.display-comptes').length > 0;
        isParent = $('.form-virement.form-vu #virement-unitaire-devise').closest('.custom-select2.join-input2');
        if (isColDispo) {
            isEltsDispo = $('#ia-virement .col-2.display-comptes .selection-compte').length > 0;
            if (isEltsDispo) {
                var $colCompte = $('#ia-virement .col-2.display-comptes');
                var $colCompteDebit = $('#ia-virement .col-2.display-comptes').eq(0);
                var $colCompteCredit = $('#ia-virement .col-2.display-comptes').eq(1);
                if ($('.comptes-debit').length == 0 || $('.comptes-credit').length == 0) {
                    $colCompteDebit.prepend('<div class="comptes-debit row active"><h3>' + _get('next.fix.comptedebit', 'Mon compte à débiter') + '</h3></div>');
                    $colCompteCredit.prepend('<div class="comptes-credit row active"><h3>' + _get('next.fix.comptecredit', 'Compte à créditer') + '</h3></div>');
                }
            }
        }
        if (isFormDispo) {
            isCibleDispo = $('.vir-footer').length > 0;
            isElDispo = $('#message-champs').length > 0;
            if (isElDispo) {
                return;
            }
            if (isCibleDispo) {
                $('.vir-footer').before('<p class="violet" id="message-champs">* ' + _get('next.fix.messagechamps', 'Tous les champs sont obligatoires') + '</p>');
            }
        }
        if ($('.form-virement.form-vu #virement-unitaire-devise option').length == 1 && !isParent.is('.one-devise')) {
            isParent.addClass('one-devise');
        }

        if ($('.js-display-other-currency').length > 0 && DeviceSize.getDeviceState() != "mobile") {
            $('.V2 .form-virement.form-vu fieldset').css('min-height', '310px');
        }

    }, 500);
});

/* ajout mask sur lignes UDcartes pour bloquer le clic */
$(function() {
    if (window.location.pathname.indexOf('/fr/espace-client/cartes') != -1 && ENVIRONNEMENT == "PREVIEW") {
        var udcarte_interval = setInterval(function() {
            if ($('#ia-udcarte').length > 0 && $('.row.main').length > 0) {
                $('.row.main').each(function() {
                    $(this).append('<div class="row-mask-udcartes" style="background-color: transparent;height: 45px;position: relative;width: 95%;z-index: 10000;"></div>');
                });
                $('.row-mask').click(function() {
                    return false;
                })
                clearInterval(udcarte_interval);
            }
        }, 500);
    }
});

/* ajout mask sur lignes UDcartes pour bloquer le clic */
$(function() {
    if (window.location.pathname.indexOf('/fr/connexion/mes-outils/messagerie') != -1 || window.location.pathname.indexOf('/en/login/tools/inbox') != -1) {
        var ocnetLemag_interval = setInterval(function() {
            if ($('#teaser-lemag').length > 0) {
                $('#popinLemag').find('button').click(function() {
                    $('.wrapper-teaser').addClass('hidden');
                    $('.wrapper-ocnet-le-mag').removeClass('hidden');
                })
            }
        }, 500);
    }
});

/* ajout classe dans body pour affichage bouton télécharger PDF */
$(function() {
    if (
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-immobiliers/pret-immobilier-taux-fixe') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-immobiliers/pret-relais-acquisition') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-immobiliers/pret-immobilier-in-fine') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-aides/pret-compte-epargne-logement') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-immobiliers/pret-immobilier-taux-variable') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-immobiliers/pret-relais') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-aides/pret-a-taux-zero') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-aides/eco-pret-a-taux-zero') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-aides/pret-plan-epargne-logement') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre/credits/credits-immobiliers/prets-aides/pret-reglemente-pc-pas') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre-pro/credits/financements-de-tresorerie/flexilia') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre-pro/credits/financements-de-tresorerie/solution-affacturage') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre-pro/credits/financements-de-tresorerie/credit-de-campagne') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre-pro/credits/financements-de-tresorerie/decouvert') != -1 ||
        window.location.pathname.indexOf('/fr/notre-offre-pro/credits/financements-de-tresorerie/escompte') != -1
    ) {
        $('body').addClass('fp-credit')
    }
});

/* ajout QA temp pour demat actions rapides ROP pro */
$(function() {
    if (window.location.pathname.indexOf('espace-pro/comptes-et-contrats/releve-operations') != -1) {
        // Ajout du téléchargement de relevé dans la barre de recherche
        var exportOp_interval = setInterval(function() {
            if ($('.recherche-avancee.hidden').length > 0) {
                $('.barre-recherche').addClass('recherche-rop-avenir')
            };
            if ($('.ia-rop .pro-style .barre-recherche').length > 0 && $('#downloadReleveRop').length == 0) {
                var html = '<div id="downloadReleveRop" class="col-10 pointer" title="Exporter mes opérations"><i class="icon icon-download-alt"></i></div>';
                var domainRopPro = window.location.hostname;
                $('.filtre-tri').after(html);
                $('#downloadReleveRop').on('click', function() {
                    window.location.href = "https://" + domainRopPro + "/rop-wspl/rest/exportExcel?libelleOpe=&ave=false&tri=operation"
                });
            }
        }, 500);
    }
});

/* Correctif prise rdv IE
$(function() {
    if (window.location.pathname.indexOf('/fr/nous-contacter/nous-contacter') != -1 || window.location.pathname.indexOf('banque-contacts-pro/nous-contacter') != -1 || window.location.pathname.indexOf('mes-outils/conseiller') != -1) {
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf("MSIE ");

        var priseRDV_interval = setInterval(function() {
            if ($('.prendreRdv').length > 0) {
                if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
                    $('.prendreRdv').hide();
                    $('.consultRdv').find('span.fr').text('Consulter/Prendre rendez-vous');
                    $('.consultRdv').find('span.en').text('Consult/Make an appointment');
                    clearInterval(priseRDV_interval);
                }
            }
        }, 500);
    }
});*/


//Renvoi de la UDA à déclaration de sinistre mobileo/mobileo2 avec paramètres.
// Code deplacé sur la page "mes contrats"
// A supprimer
// $(function() {
//     if (window.location.pathname.indexOf('/comptes-et-contrats/mes-contrats') != -1 && ENVIRONNEMENT == 'PREVIEW') {
//         function renvoiVersMobileo(mobileo, codeValeur) {
//             console.log(mobileo);
//             console.log(codeValeur);
//             if (mobileo == 2 && $('body').hasClass('pro') == true) {
//                 document.location.href = "/fr/notre-offre-pro/assurances/declarer-sinistre-mobileo-2?codeValeur=" + codeValeur;
//             } else if (mobileo != 2 && $('body').hasClass('pro') == true) {
//                 document.location.href = "/fr/notre-offre-pro/assurances/declarer-sinistre-mobileo?codeValeur=" + codeValeur;
//             } else if (mobileo == 2 && $('body').hasClass('bpf') == true) {
//                 document.location.href = "/fr/espace-prive/comptes-et-contrats/mes-contrats/declarer-sinistre-mobileo-2?codeValeur=" + codeValeur;
//             } else if (mobileo != 2 && $('body').hasClass('bpf') == true) {
//                 document.location.href = "/fr/espace-prive/comptes-et-contrats/mes-contrats/declarer-sinistre-mobileo?codeValeur=" + codeValeur;
//             } else if (mobileo == 2) {
//                 document.location.href = "/fr/notre-offre/assurances/declarer-sinistre-mobileo-2?codeValeur=" + codeValeur;
//             } else {
//                 document.location.href = "/fr/notre-offre/assurances/declarer-sinistre-mobileo?codeValeur=" + codeValeur;
//             }
//         }
//         // Ajout du téléchargement de relevé dans la barre de recherche
//         var testMobileo = setInterval(function() {
//             if ($('.getDetailsContrat').length > 0) {
//                 clearInterval(testMobileo);
//                 var codeValeur;
//                 var dataReturn;
//                 $.get("/vcd-wspl/rest/listerContrats").done(function(dataReturn) {
//                     $.each($('.getDetailsContrat'), function() {
//                         if ($(this).html().replace(/ /g, '').toLowerCase() == "mobileo2") {
//                             $.each(dataReturn.data.listerContrats.listeContrats, function() {
//                                 if (this.libelleContrat.replace(/ /g, '').toLowerCase() == "mobileo2") {
//                                     codeValeur = this.numContrat;
//                                 }
//                             });
//                             $(this).closest('li').find('i.icon-declarer-un-sinistre').parent().click(function(ev) {
//                                 ev.stopPropagation();
//                                 ev.preventDefault();
//                                 renvoiVersMobileo(2, codeValeur);
//                             });
//                             $(this).closest('li').find('i.icon-declarer-un-sinistre').parent().children(".quickacces-vcd").show();
//                         } else if ($(this).html().replace(/ /g, '').toLowerCase() == "mobileo") {
//                             $.each(dataReturn.data.listerContrats.listeContrats, function() {
//                                 if ($(this).libelleContrat.replace(/ /g, '').toLowerCase() == "mobileo") {
//                                     codeValeur = $(this).numContrat;
//                                 }
//                             });
//                             $(this).closest('li').find('i.icon-declarer-un-sinistre').parent().click(function(ev) {
//                                 ev.stopPropagation();
//                                 ev.preventDefault();
//                                 renvoiVersMobileo(0, codeValeur);
//                             });
//                             $(this).closest('li').find('i.icon-declarer-un-sinistre').parent().children(".quickacces-vcd").show();
//                         }
//                     });
//                 });
//             }
//         }, 500);
//     }
// });

// $(function() {
//     if ( window.location.pathname.indexOf('/fr/connexion/mes-outils/messagerie') != -1 || window.location.pathname.indexOf('/fr/espace-prive/mes-outils/messagerie') != -1 ) {
//         var messageTemp_msg_interval = setInterval(function() {
//             var ZpAppDispo = $('#zone-publiable-haute').length > 0;
//             if (ZpAppDispo) {
//                 var messageCurrentDate = new Date();
//                 var messageCurrentHour = messageCurrentDate.getHours();
//                 var messageStartTime = 19;
//                 var messageEndTime = 20;

//                 if (messageCurrentHour >= messageStartTime && messageCurrentHour < messageEndTime) {
//                     if ($('body').hasClass('part')) {
//                       $('#zone-publiable-haute').empty().append("<div class='message-securise ec-messagerie no-mob'><div class='form-info'><div class='col-90'><i class='icon pull-left icon-info violet'></i><p class='violet'>L'envoi de messages avec pièces-jointes est momentanément interrompu. Merci de vous reconnecter ultérieurement.</p></div></div></div>");
//                     }
//                     if ($('body').hasClass('bpf')) {
//                         var ZpElemDispo = $('.message-securise').length > 0;
//                         if(!ZpElemDispo) {
//                           $('#zone-publiable-haute').append("<div class='message-securise ec-messagerie no-mob'><div class='form-info'><div class='col-90'><i class='icon pull-left icon-info violet'></i><p class='violet'>L'envoi de messages avec pièces-jointes est momentanément interrompu. Merci de vous reconnecter ultérieurement.</p></div></div></div>");
//                         }
//                     }
//                     $('#upload-fileEcrire').hide();
//                     $('.form-messagerie.new-msg .form-info p').text("L'envoi de messages avec pièces-jointes est momentanément interrompu. Merci de vous reconnecter ultérieurement.");
//                 }
//                 else {
//                     clearInterval(messageTemp_msg_interval);
//                     return;
//                 }
//             }
//         }, 500);
//     }
// });

// $(function(){
//     if (/fr\/souscription\/epargne-bourse\/plan-epargne-logement/.test(document.location.pathname))
//     {
//         var patchPEL = setInterval(function() {
//             if ($("#pel-wrap form").length>0)
//             {
//                 clearInterval(patchPEL);
//                 $("#pel-wrap form").addClass("hidden");
//                 $("#pel-wrap").after($("<section>").addClass("wrap").append($("<div>").addClass("confirmation").html("<div class='icon-form-alert'></div><p class='big'>Service momentanément indisponible</p><p>Nous nous excusons pour la gêne occasionnée.</p>")));
//             }
//         }, 100);
//     }
//     if (/fr\/notre-offre\/epargne-et-bourse\/epargne-logement\/plan-epargne-logement/.test(document.location.pathname))
//     {
//         $(document).on('click', '#patchPEL .popin-close', function (e) {
//             Popin.hidePopin($('#patchPEL'));
//             $('#patchPEL').remove();
//         });
//         var patchPEL = setInterval(function() {
//             if ($('.btn-primary.forceColor').length>=3)
//             {
//                 clearInterval(patchPEL);
//                 $('.btn-primary.forceColor').each(function(){
//                     $(this).removeProp("href");
//                     $(this).find("a").removeProp("href");
//                     $(this).removeAttr("href");
//                     $(this).find("a").removeAttr("href");
//                 });
//             }
//         }, 100);
//         $(document).on('click', '.btn-primary.forceColor', function (e) {
//             e.preventDefault();
//             e.stopPropagation();
//             e.stopImmediatePropagation();
//             $('body').append('<div class="popin popin-alert popin-open-active popin-webcallback" id="patchPEL"><a class="close popin-close">✕</a><div class="confirmation"><div class="icon-form-alert"></div><p class="big">Service momentanément indisponible</p><p>Nous nous excusons pour la gêne occasionnée.</p></div></div>');
//             FormHelper.placeholderPolyfill();
//             Popin.showPopin($('#patchPEL'));
//             return false;
//         });
//     }
// });

$(function() {
    $.getScript('/rsc/contrib/script/seo/seo.js', function() { onloadSEO(); });
});


$(function() {
    if (window.ENVIRONNEMENT != 'PREVIEW')
        return;
    if (GetURLParameter("mode") && GetURLParameter("mode") == "kameleoon")
        sessionStorage.setItem("kameleoon", true);
    if (sessionStorage.kameleoon) {
        //if ('/fr/connexion' != document.location.pathname && '/fr/espace-prive' != document.location.pathname && '/fr/espace-pro' != document.location.pathname && $('head script[src*=kameleoon]').length == 0)

        if (document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/moyens-de-paiement-toutes-les-reponses-a-vos-questions/acheter-et-vendre-devises" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-visa-infinite" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-visa-premier" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-visa-classic" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-bnp-net" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-bancaire-personnalisee-a-chacun-son-image" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/we-love-cinema" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-american-express-platinum" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-american-express-gold" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-american-express-Green" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-cirrus" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-plus" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-livret-a" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-livret-jeune" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes/carte-mybs" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/paylib" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/options-cartes-et-paiement/carte-bancaire-formule-bnp-net" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/options-cartes-et-paiement/les-cartes-sans-contact" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/options-cartes-et-paiement/terceo" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/vos-questions-cartes-bancaires/faire-opposition-a-sa-carte-bancaire" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/vos-questions-cartes-bancaires/cartes-premier" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/vos-questions-cartes-bancaires/securite-paiement-internet" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/moyens-de-paiement-toutes-les-reponses-a-vos-questions/informations-cheques" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/moyens-de-paiement-toutes-les-reponses-a-vos-questions/informations-prelevements" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/moyens-de-paiement-toutes-les-reponses-a-vos-questions/tout-savoir-sur-le-sepa" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/moyens-de-paiement-toutes-les-reponses-a-vos-questions/acheter-et-vendre-devises" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/decouvrir-toutes-les-cartes" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/options-cartes-et-paiement" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/vos-questions-cartes-bancaires" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/cartes-et-moyens-de-paiement/moyens-de-paiement-toutes-les-reponses-a-vos-questions" ||
            document.location.pathname == "/fr/souscription/comptes-cartes-services/montee-en-gamme-carte" ||
            document.location.pathname == "/fr/connexion/virements-services/paylib" ||
            document.location.pathname == "/fr/souscription/comptes-cartes-services/simulation-cartes" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/comparateur-cartes" ||
            document.location.pathname == "/fr/souscription/comptes-cartes-services/a-chacun-son-image/simulation" ||
            document.location.pathname == "/fr/notre-offre/comptes-cartes-et-services/vente-flash-cartes") {
            $.getScript('//static-bp.kameleoon.com/css/customers/qx8grdsvgh/0/kameleoon.js', function() {});
        }
    }
});


$(function() {
    var flagBannieresTousConnectes = 0;
    var counterBannieresTousConnectes = 200;
    var cptBannieresTousConnectes = null;

    function actionBannieresTousConnectes() {
        clearInterval(cptBannieresTousConnectes);
    }

    function addCookieLink() {
        localStorage.setItem("bnpPremiereConnexion", "true");
        window.location.replace("/fr/jeux-concours/jeu-tous-connectes");
    }

    function changementBannieresTousConnectes() {
        if (localStorage.getItem("bnpPremiereConnexion") == "true") {
            switch (window.location.pathname) {
                case "/fr/tousconnectes":
                    if ($("#nextoutils_tousconnectes #content").length && !localStorage.getItem("bnpJeuTousConnecte")) {
                        $('#nextoutils_tousconnectes #content').prepend('<div class="bannTousConnecte"><a href="#" style="width:100%;float:left;text-align:center; max-height: 272px;"><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN00_JEU_CONCOURS.png" style="width:100%;" onclick="localStorage.setItem(\'bnpPremiereConnexion\', \'true\'); window.location.replace(\'/fr/jeux-concours/jeu-tous-connectes\');" /></a></div>');
                        $('#content > div.ready').css('clear', 'both');
                        $('#content .contest-banners').hide();
                        clearInterval(cptBannieresTousConnectes);
                    }
                    break;
                case "/fr/connexion/comptes-et-contrats":
                    if ($("#mainContent #id_balise_div .liste-famille-compte").length && localStorage.getItem("bnpJeuTousConnecte") == "true") {
                        $('#mainContent #id_balise_div .liste-famille-compte').append('<div class="bannTousConnecte"><a href="/fr/tousconnectes?codeValeur=compte" style="width:100%;float:left;text-align:center"><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN01_CONSULTER_OPERATIONS_COMPTE.png" style="width:100%;" /></a></div>');
                        clearInterval(cptBannieresTousConnectes);
                    } else if ($("#mainContent #id_balise_div .liste-famille-compte").length) {
                        $('#mainContent #id_balise_div .liste-famille-compte').append('<div class="bannTousConnecte"><a href="/fr/jeux-concours/jeu-tous-connectes" style="width:100%;float:left;text-align:center"><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN00_JEU_CONCOURS.png" style="width:100%;" /></a></div>');
                        clearInterval(cptBannieresTousConnectes);
                    }
                    break;
                case "/fr/connexion/virements-services/virements":
                    if ($(".wrapper-virement").length) {
                        $('.wrapper-virement').append('<div class="bannTousConnecte" style="margin-top: 20px;"><a href="/fr/tousconnectes?codeValeur=virement" style="width:100%;float:left;text-align:center"><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN05_EFFECTUER_VIREMENT.png" style="width:100%;" /></a></div>');
                        clearInterval(cptBannieresTousConnectes);
                    }
                    break;
                case "/fr/connexion/virements-services/virements/virement-permanent":
                    if ($(".wrapper-virement").length) {
                        $('.wrapper-virement').append('<div class="bannTousConnecte"><a href="/fr/tousconnectes?codeValeur=virementPerm" style="width:100%;float:left;text-align:center; margin-top:50px;"><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN03_CREER_MODIFIER_VIREMENT_PERMANENT.png" style="width:100%;" /></a></div>');
                        clearInterval(cptBannieresTousConnectes);
                    }
                    break;
                case "/fr/connexion/virements-services/virements/mes-beneficiaires":
                    if ($(".wrapper-virement").length) {
                        $('.wrapper-virement').append('<div class="bannTousConnecte"><a href="/fr/tousconnectes?codeValeur=beneficiares" style="width:100%;float:left;text-align:center; margin-top:50px;"><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN04_AJOUTER_BENEFICIAIRE.png" style="width:100%;" /></a></div>');
                        clearInterval(cptBannieresTousConnectes);
                    } else if ($('#beneficiaire-etape1:contains("Vous n’avez pas de bénéfici")').length) {
                        $('#beneficiaire-etape1:contains("Vous n’avez pas de bénéfici")').after('<div class="bannTousConnecte"><a href="/fr/tousconnectes?codeValeur=chequier" style="width:100%;float:left;text-align:center; margin-top:50px;"><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN07_DEMANDE_CHEQUIER.png" style="width:100%;" /></a></div>');
                        clearInterval(cptBannieresTousConnectes);
                    }
                    break;
                case "/fr/connexion/virements-services/rib":
                    if ($(".container.rib").length) {
                        $('.container.rib').append('<div class="bannTousConnecte"><a href="/fr/tousconnectes?codeValeur=rib" style="width:100%;float:left;text-align:center; margin-top:50px;"><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN06_RIB.png" style="width:100%;" /></a></div>');
                        clearInterval(cptBannieresTousConnectes);
                    }
                    break;
                case "/fr/connexion/virements-services/commande-chequiers":
                    if ($("section.wrapper-commande-chequier").length) {
                        $('section.wrapper-commande-chequier').append('<div class="bannTousConnecte"><a href="/fr/tousconnectes?codeValeur=chequier" style="width:100%;float:left;text-align:center; margin-top:50px;"><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN07_DEMANDE_CHEQUIER.png" style="width:100%;" /></a></div>');
                        clearInterval(cptBannieresTousConnectes);
                    }
                    break;
                default:
                    clearInterval(cptBannieresTousConnectes);
                    break;
            }
        } else if (window.location.pathname == "/fr/tousconnectes") {
            if ($("#nextoutils_tousconnectes #content").length) {
                $('#nextoutils_tousconnectes #content').prepend('<div class="bannTousConnecte"><a href="#" style="width:100%;float:left;text-align:center; max-height: 272px;" ><img src="/rsc/contrib/script/simulateur/tousconnectes/bannieres/BAN00_JEU_CONCOURS.png" style="width:100%;" onclick="localStorage.setItem(\'bnpPremiereConnexion\', \'true\'); window.location.replace(\'/fr/jeux-concours/jeu-tous-connectes\');" /></a></div>');
                $('#content > div.ready').css('clear', 'both');
                $('#content .contest-banners').hide();
                clearInterval(cptBannieresTousConnectes);
            }
        } else {
            clearInterval(cptBannieresTousConnectes);
        }
    }

    function startBannieresTousConnectes() {
        cptBannieresTousConnectes = setInterval(changementBannieresTousConnectes, 1000);
        setTimeout(actionBannieresTousConnectes, counterBannieresTousConnectes * 1000);
    }
    startBannieresTousConnectes();
});


$(function() { // fix virement permanent
    var isGoodPage;
    var intervalId;
    isGoodPage =
        window.location.pathname.indexOf('/fr/connexion/virements-services/virements/virement-permanent') != -1 ||
        window.location.pathname.indexOf('/en/login/services-transfers/transfers/standing-order') != -1 ||
        window.location.pathname.indexOf('/fr/espace-pro/virements-services/virements/virement-permanent') != -1 ||
        window.location.pathname.indexOf('/fr/espace-prive/virements-services/virements/virement-permanent') != -1;

    if (!isGoodPage) return;
    intervalId = setInterval(function() {
        var isColDispo,
            isEtap3,
            isEtap4,
            isEtap5,
            isFormDispo,
            isCibleDispo,
            $colCompteDebit,
            $colCompteCredit,
            isElDispo;
        isFormDispo = $('.form-vp').length > 0;
        isEtap3 = $('#virement-permanent-etape3 .col-2.display-comptes').length > 0;
        isEtap4 = $('#virement-permanent-etape4 .col-2.display-comptes').length > 0;
        isEtap5 = $('#virement-permanent-etape5 .col-2.display-comptes').length > 0;
        isColDispo = $('.col-2.display-comptes .selection-compte').length > 0;
        $colCompteDebit = $('.col-2.display-comptes').eq(0);
        $colCompteCredit = $('.col-2.display-comptes').eq(1);
        if (isEtap3 && isColDispo) {
            var $colCompteDebit = $('.col-2.display-comptes').eq(0);
            if ($('.comptes-debit').length == 0) {
                $colCompteDebit.prepend('<div class="comptes-debit row active"><h3>' + _get('next.fix.comptedebit', 'Mon compte à débiter') + '</h3></div>');
            }
        }
        if ((isEtap4 || isEtap5) && isColDispo) { // contexte
            if ($('.comptes-debit').length == 0 || $('.comptes-credit').length == 0) { // element dispo
                $colCompteDebit.prepend('<div class="comptes-debit row active"><h3>' + _get('next.fix.comptedebit', 'Mon compte à débiter') + '</h3></div>');
                $colCompteCredit.prepend('<div class="comptes-credit row active"><h3>' + _get('next.fix.comptecredit', 'Compte à créditer') + '</h3></div>');
            }
        }

        if (isFormDispo) {
            isCibleDispo = $('.vir-footer').length > 0;
            isElDispo = $('#message-champs').length > 0;
            if (isElDispo) {
                return;
            }
            if (isCibleDispo) {
                $('.vir-footer').before('<p class="violet" id="message-champs">' + _get('next.fix.vpp', 'Fields followed by * are mandatory') + '</p>');
            }
        }
    }, 500);
});

// (function() {
//     if (window.location.pathname.indexOf('comptes-et-contrats') != -1)  {
//         var udc_msg_interval = setInterval(function() {
//             var udc_retraite = $('.list-vue1.udc-assurance-vie');
//             var hasAssVie = udc_retraite.length > 0;
//             var hasRetTxt = (udc_retraite.text() || '').toUpperCase().indexOf('BNP PARIBAS AVENIR RETRAITE') >= 0;

//             if (hasAssVie  && hasRetTxt) {
//                 clearInterval(udc_msg_interval);
//                 if ( $('body').hasClass('bpf')) {
//                    udc_retraite.after('<div class="message-assur-vie no-mob"> <div class="row form-info"> <div class="col-90"> <i class="icon pull-left icon-info violet"></i> <p class="violet">Nous vous informons que vous ne pourrez saisir aucune opération sur votre contrat BNP Paribas Avenir Retraite entre le 17/09/2016 et le 10/10/2016.<br> Votre banquier privé se tient à votre disposition.</p> </div> </div> </div>');
//                 }
//                 else {
//                    udc_retraite.after('<div class="message-assur-vie no-mob"> <div class="row form-info"> <div class="col-90"> <i class="icon pull-left icon-info violet"></i> <p class="violet">Nous vous informons que vous ne pourrez saisir aucune opération sur votre contrat BNP Paribas Avenir Retraite entre le 17/09/2016 et le 10/10/2016.<br> Votre conseiller BNP Paribas se tient à votre disposition.</p> </div> </div> </div>');
//                 }
//             }
//         }, 500);
//     }
// })();

if (typeof subscribeToCheckStatus === "function") {
    subscribeToCheckStatus(function() { // fixe LOA
        //--
        var $form;
        var $submitSimulation;
        var $demandeEnLigne;
        var check$Elt;
        var $btnReset;
        var isGoodUnivers = $('body').hasClass('pro');
        var isGoodEnv = true /*(window.ENVIRONNEMENT === "QUALIF")*/ ;
        var isGoodPage = document.location.pathname.indexOf('/fr/souscription-pro/credits/loa-pro/loa-pro-prive') >= 0 || document.location.pathname.indexOf('/fr/souscription-pro/credits/loa-pro/loa-pro') >= 0;
        var isGoodContext = isGoodEnv && isGoodUnivers && isGoodPage;
        var resetAndEnable;
        var isFormValid;

        if (isGoodContext) {

            check$Elt = function($elt) {
                return typeof $elt !== "undefined" && $elt !== null && $elt.length > 0;
            }

            $form = $("#simulateur form");
            $btnReset = $('#btnReset');
            $submitSimulation = $('#submitSimulation');
            $demandeEnLigne = $('#demandeEnLigne');

            resetAndEnable = function resetForm() { // reset et activation des champs
                var ref;

                if ((ref = $form.get(0)) != null) {
                    ref.reset();
                    $form.find('input, select') // lorsqu'on refais une simulation, on réactive les champs et on reset le formulaire
                        .attr('disabled', false)
                        .removeClass('disabled')
                        .removeClass('valid')
                        .removeClass('error');

                    if ($submitSimulation) {
                        $submitSimulation.attr('disabled', false);
                    }
                }
            };

            isFormValid = function isFormValid(_$form) {
                var result;
                var $listFields;
                var isThereNoError;
                var hasNoEmptyValue;

                if (!check$Elt(_$form)) {
                    result = false;
                }

                $listFields = _$form.find('input, select');
                isThereNoError = !$listFields.hasClass('error');
                hasNoEmptyValue = (function _hasNoEmptyValue($f) {
                    var res = true;
                    var fields = $f.find('input, select');

                    fields.each(function() {
                        var isEmpty = $(this).val() === "";
                        res = res && !isEmpty;
                    });

                    return res
                })(_$form);

                result = isThereNoError && hasNoEmptyValue;

                return !!result;
            };

            if (check$Elt($submitSimulation) && check$Elt($form)) {
                $submitSimulation.on('click', function() { // lorsqu'on lance un simulation, on désactive les champs de formulaire
                    var $self = $(this);
                    if (isFormValid($form)) {
                        $form.find('input, select')
                            .attr('disabled', true)
                            .removeClass('valid')
                            .removeClass('error')
                            .addClass('disabled');

                        window.setTimeout(function() {
                            $self.attr('disabled', true);
                        }, 500);
                    }
                });
            }

            if (check$Elt($btnReset)) {
                $btnReset.on('click', function() {
                    if (check$Elt($form)) {
                        resetAndEnable();
                    }
                });
            }

            if (check$Elt($demandeEnLigne) && check$Elt($form)) {
                $demandeEnLigne.on('click', function() {
                    window.setTimeout(function() {
                        $("#btnSimu").on('click', resetAndEnable);
                    }, 500);
                });
            }
        }
        //--
    });
}

/* cache + remplace message erreur sur Terceo */
$(function() {
    if (window.location.pathname.indexOf('/fr/connexion/comptes-et-contrats/mes-cartes/terceo') != -1) {
        var msg_error = "Problème technique. Veuillez contacter votre conseiller.";
        var terceoError = setInterval(function() {
            if ($('#ia-terceo').length > 0 && $('.terceo_erreur').length > 0) {
                clearInterval(terceoError);
                if ($('.terceo_erreur').find('p').text().indexOf('déclaration de blanchiment') != -1) {
                    $('.terceo_erreur').find('p').text(msg_error);
                    $('.terceo_erreur').show();
                }
            }
        }, 500);
    }
});

/* supprime tel fixe pour loa pro */
$(function() {
    if (window.location.pathname.indexOf('/fr/souscription-pro/credits/loa-pro/loa-pro') != -1) {
        var loapro_interval = setInterval(function() {
            if ($('#input-tel-fixe').length > 0 && $('#ia-loa-pro').length > 0 && $('.progression-alt').hasClass('etp-1')) {
                $('#input-tel-fixe').parent().parent().next().remove();
                $('#input-tel-fixe').parent().parent().remove();
            }
        }, 500);
    }
});

/* redirection vers les homes respectives des sites en/fr */
$(function() {
    $('body').delegate('#select-langues select, #select-langues-connecte select', 'change', function() {
        window.location = $(this).val();
    });
});

(function() {
    $(function() {
        var imgContainer = $('<div/>');
        imgContainer.append($('<img src="/rsc/contrib/image/generique/alert/udc-mabanque.jpg"/>'));
        var currentDate = new Date();
        var endDate = new Date(1477245600000);

        if (currentDate < endDate) {
            var searchUDC = setInterval(function() {
                if ($('.liste-famille-compte > div > header').length &&
                    $('.liste-famille-compte > div > header').hasClass('udc-epargne-dispo')) {
                    clearInterval(searchUDC);
                    var header = $('.liste-famille-compte > div > header.udc-epargne-dispo');
                    header.siblings('#zone-publiable-liste-compte-0').find('li').append(imgContainer);
                    header.siblings('#zone-publiable-liste-compte-0').removeClass('hidden');
                }
            }, 140);
        }
    });
})();

/* Correctif lien nav magazine Wealth jusqu'au lundi 24 */
$(function() {
    if (ENVIRONNEMENT == "PROD") {
        var checkNavLCW_interval = setInterval(function() {
            if ($('#nav7-le-cercle-wealth').is(':visible')) {
                $('#nav7-le-cercle-wealth').find('ul').remove();
                $('#nav7-le-cercle-wealth').find('a').attr('href', 'https://mabanqueprivee.bnpparibas/le-magazine');
                $('#nav7-le-cercle-wealth').find('span').html('E-Magazine Wealth');
                clearInterval(checkNavLCW_interval);
            }
        }, 500);
    }
});
/* Correctif lien securite nav anglais */
$(function() {
    if ($('body').hasClass('en')) {
        var lien = $('#nav10-site-securise').find('a');
        lien.attr('href', '/en/commitments-charters-and-agreements/secure-site');
    }
});
//--
$(function fixEnglishBourse() {
    "use strict";

    var isEnglish;
    var isConnected;
    var isGoodUnivers;
    var isGoodContext;
    var $body;

    $body = $('body');
    isEnglish = lgMgt.isEnglish();
    isConnected = $body.is('.client');
    isGoodUnivers = $body.is('.part');
    isGoodContext = isEnglish && isConnected && isGoodUnivers;

    if (!isGoodContext) return;

    $('#nav5-portefeuille-bourse a').each(function() {
        var href = $(this).attr('href').replace('/en/login', '/fr/connexion');
        $(this).attr('href', href);
    });

    $('#link-emergencies a').each(function() {
        $(this).attr('href', '/en/contact-us/emergencies#ct-urgence');
    });
});
$(function fixEnglishContactEmergencies() {
    "use strict";

    var isEnglish;
    var isGoodUnivers;
    var isGoodContext;
    var $body;

    $body = $('body');
    isEnglish = lgMgt.isEnglish();
    isGoodUnivers = $body.is('.part');
    isGoodContext = isEnglish && isGoodUnivers;

    if (!isGoodContext) return;
    $('#link-emergencies a').each(function() {
        $(this).attr('href', '/en/contact-us/contact-us#ct-urgence');
    });
});

/* Footer bpf */

$(function() {
    "use strict";
    var isGoodContext;
    var $body;
    var isGoodEnv = true;

    $body = $('body');
    isGoodContext = $body.is('.bpf') && isGoodEnv;

    if (!isGoodContext) return;
    $.ajax({
        url: "/rsc/contrib/html/bpf/footer/footer-bpf.html"
    }).done(function(data) {
        $('#footerContent').html(data);
    });
});

/* Message d info telecharger operations */

$(function() {

    var isGoodContext;
    var isGoodPage = (window.location.pathname.indexOf('/virements-services/telechargement-des-operations') != -1);
    var strVar = "";
    var isGoodEnv = true;
    var $elem;
    isGoodContext = isGoodPage && isGoodEnv;

    if (!isGoodContext) return;

    var messageTempTelop = setInterval(function() {
        var $elem = $(".tel-op.tel-op1");
        if ($elem.length > 0) {
            clearInterval(messageTempTelop);
            strVar += "  <div id=\"info-telop\" class=\"info-telop white-box wb-pad\"> ";
            strVar += "    <i class=\"icon-form-info pull-left\"><\/i>";
            strVar += "    <p>A partir du 1 mars 2017, les formats de fichier .qif ne seront plus maintenus. <br> Pour continuer à utiliser vos logiciels de gestion de comptes habituels, choisissez le format .ofx pour télécharger vos opérations.";
            strVar += "    <\/p>";
            strVar += "  <\/div>";

            $elem.prepend(strVar);
        }
    }, 500);
});


/* mise en forme numéro tel pour NCI */
$(function() {
    if (window.location.pathname.indexOf('/fr/souscription/credits/credit-immobilier') != -1) {
        var toReplace = "Le montage de votre dossier nécessitera une analyse plus affinée afin de vous faire le cas échéant une proposition adaptée à votre situation personnelle. A cet égard, et sous réserve d'acceptation finale de votre demande de prêt par notre établissement, la banque pourra vous proposer après le montage du dossier et la fourniture de justificatifs, une offre de prêt appropriée.<br>La présente simulation ne tient pas compte de l'assurance emprunteur exigée pour garantie du crédit soumise à l'acceptation de l'assureur, ni des frais inhérents aux garanties qui seront recueillies par la banque. L'emprunteur a la possibilité d'adhérer à l'assurance groupe souscrite par BNP Paribas, ou de souscrire une assurance extérieure présentant un niveau de garantie équivalent à celui du contrat d'assurance groupe BNP PARIBAS.<br>La convention AERAS favorise l'accès à l'assurance et au crédit pour les personnes présentant un risque aggravé de santé. Pour tout renseignement, vous pouvez contacter le serveur vocal au :<br><div class='telephone second small green'><div class='number arrow-right'><span>0 821 221 021</span></div><div class='texte'><p>Service <span>0,05 € / min</span> + prix appel</p></div></div><br>ou le Centre de Relations Client BNP Paribas au <br><div class='telephone second small purple'><div class='number arrow-right'><span>0 820 820 001</span></div><div class='texte'><p>Service <span>0,12 € / min</span> + prix appel</p></div></div><br>Cette simulation est effectuée pour un prêt immobilier soumis au code de la consommation. Elle ne prend pas en compte les règlementations particulières sur les crédits règlementés auxquelles vous pourriez peut-être prétendre.<br>Pour le financement d'une opération relevant des articles L313-1 et suivants du code la consommation, il est rappelé que  l'emprunteur dispose d'un délai de réflexion de 10 jours avant d'accepter l'offre de prêt immobilier, que la vente immobilière est subordonnée à l'obtention du prêt, et que si celui-ci n'est pas obtenu le vendeur doit rembourser à l'acheteur les sommes versées.";
        var nciFootnote_interval = setInterval(function() {
            if ($('#ia-nci').length > 0 && $('.footnote').length > 0) {
                var $textNodes = $(".footnote").contents().filter(function() {
                    return this.nodeType === Node.TEXT_NODE;
                });
                if ($('.footnote').hasClass('modified')) {
                    return;
                } else {
                    $textNodes.each(function() {
                        $(this).remove();
                    });
                    $('.footnote').find('br').remove();
                    $('.footnote').append(toReplace);
                    $('.footnote').addClass('modified');
                    //clearInterval(nciFootnote_interval);
                }
            }
        }, 500);
    }
});



/* Messagerie mobile */
$(window).on('load', function() {

    var isGoodContext;
    var isGoodPage = (window.location.pathname.indexOf('/fr/connexion/mes-outils/messagerie') != -1);
    var isGoodEnv = (ENVIRONNEMENT === "PREVIEW");
    isGoodContext = isGoodPage && isGoodEnv;
    if (!isGoodContext) {
        return;
    }

    var messagerieInterval1 = setInterval(function() {
        if (DeviceSize.getDeviceState() == 'mobile') {
            var $elem = $("#msg-recu");
            var $toggleElem = $('.toggle-btn');
            var $container = $(".container-list-messages");
            var $header = $(".top-messagerie");
            if ($elem.length > 0 && $toggleElem.length > 0) {
                clearInterval(messagerieInterval1);
                $elem.click();
                $toggleElem.click();
                if ($header.length > 0) {
                    $('.top-messagerie h2').html('Messagerie');
                }
                creatIntervalMessagerie2();
            }
        }
    }, 500);

    function creatIntervalMessagerie2() {
        if (creatIntervalMessagerie2.alreadyRun) {
            return;
        }
        var messagerieInterval2 = setInterval(function() {
            if (DeviceSize.getDeviceState() == 'mobile') {
                var $header = $(".top-messagerie");
                var $filters = $("#filters");
                var $nav = $(".list-tri");
                var $container = $(".container-list-messages");
                var $sendMessage = $('.header-send-msg');
                var $btn = $("#bouton-nouveau-message");
                $('body').on('click', '#msg-recu, #msg-envoye', function clickMsgRecuHandler() {
                    $('#ecrireMessage').empty();
                });
                $('body').on('click', '.list-messages li', function clickItemList() {
                    window.scroll(0, 0);
                });

                if ($container.is(".hidden") && $sendMessage.length === 0) {
                    $nav.css({ display: "none" });
                    $filters.css({ display: "none" });
                    $header.css({ display: "none" });
                    $btn.css({ display: "none" });
                } else {
                    $nav.css({ display: "block" });
                    $filters.css({ display: "block" });
                    $header.css({ display: "block" });
                    $btn.css({ display: "block" });
                }
            } else {
                clearInterval(messagerieInterval2);
            }
        }, 500);

        creatIntervalMessagerie2.alreadyRun = true;
    };

    window.creatIntervalMessagerie2 = creatIntervalMessagerie2;

});

false && (document.location.pathname.includes("/comptes-et-contrats/releve-operations")) && (function() { // fix du tri du rop
    window.ROP_SORT_INT_ID = window.setInterval(function callback() {
        var f = function() {
            var $body = $("body");
            var isGoodUnivers = $body.is('.part') || $body.is('.bpf');
            if (!isGoodUnivers) {
                return;
            }
            var groups = $('.list-rop.tri-date li.row').has('.date-operation').closest("div > h4 + ul.list-rop.tri-date").closest('div');
            var groupsArray = groups.toArray();
            var sortedGroupArray;
            var $rootContainer = (function() {
                var $fixRopTriContainer = $("#fix-rop-tri-container");
                var $templateListeRop = $("#template-liste-rop .js-main-container-list");

                if ($fixRopTriContainer.length === 0) {
                    $templateListeRop.append("<div id='fix-rop-tri-container'></div>");
                }

                return $("#fix-rop-tri-container");
            })();

            // sorting groups
            sortedGroupArray = groupsArray.sort(function(a, b) {
                var $a = $(a);
                var $b = $(b);
                var txta;
                var txtb;
                var montha;
                var monthb;
                var daya;
                var dayb;
                var splita;
                var splitb;
                var res = 0;

                try {
                    txta = $a.find('.date-operation').eq(0).text();
                    txtb = $b.find('.date-operation').eq(0).text();
                    splita = txta.split('/');
                    splitb = txtb.split('/');
                    montha = parseInt(splita[1], 10);
                    monthb = parseInt(splitb[1], 10);
                    daya = parseInt(splita[0], 10);
                    dayb = parseInt(splitb[0], 10);
                    res = (function() {
                        if (montha !== monthb) {
                            return (montha - monthb);
                        } else {
                            return (daya - dayb);
                        }
                    })();
                } catch (e) {
                    // DO NOTHING
                }

                return res;
            });

            // traitement de janvier 2017
            var noJanuary = [];
            var January = [];

            $.each(sortedGroupArray, function callBack(index, value) {
                var txt = $(value).find('.date-operation').eq(0).text();
                var splitted = txt.split("/");
                var month = parseInt(splitted[1], 10);

                if (month === 1 || month === 2) {
                    January.push(value);
                } else {
                    noJanuary.push(value);
                }
            });


            $rootContainer
                .prepend($(noJanuary.reverse()))
                .prepend($(January.reverse()));
        };

        window.setTimeout(f, 1000);
    }, 500);
})();

$(function() {

    var isGoodContext;
    var isGoodPage = (window.location.pathname.indexOf('/fr/vos-besoins/client-international/frontalier/') != -1) ||
        (window.location.pathname.indexOf('/fr/vos-besoins/client-international/expatrie/') != -1) ||
        (window.location.pathname.indexOf('/fr/vos-besoins/client-international/non-resident/') != -1) ||
        (window.location.pathname.indexOf('/fr/vos-besoins/votre-situation/jeune-actif/') != -1) ||
        (window.location.pathname.indexOf('/fr/vos-besoins/votre-situation/en-famille/') != -1) ||
        (window.location.pathname.indexOf('/fr/notre-offre/epargne-et-bourse/epargne-logement/') != -1) ||
        (window.location.pathname.indexOf('/fr/vos-besoins/votre-situation/senior/') != -1);
    var strVar = "";
    var isGoodEnv = (ENVIRONNEMENT == "PREVIEW");
    var $elem;
    isGoodContext = isGoodPage && isGoodEnv;

    if (!isGoodContext) return;

    var $elem = $("#hubBesoins-nosProduits, #wrapper-hub-offre-col100");
    if ($elem.length > 0) {
        strVar += "<div class=\"row top\">";
        strVar += "         <h2>Nos outils<\/h2>";
        strVar += "         <div class=\"col-3 mob-100\"><a href=\"\/fr\/notre-offre\/credits\/financements-et-formules-locatives-auto\/autodiagnostic\" id=\"btn-comprendre\"><div class=\"haut\"><\/div><h3>Réaliser son diagnostic auto<\/h3><\/a><\/div>";
        strVar += "         <div class=\"col-3 mob-100\"><a href=\"\/fr\/notre-offre\/credits\/financements-et-formules-locatives-auto\/comparer-les-offres\" id=\"btn-comparer\"><div class=\"haut\"><\/div><h3>Financement ou location ?<br>Comparer les offres<\/h3><\/a><\/div>";
        strVar += "         <div class=\"col-3 mob-100\"><a href=\"\/fr\/notre-offre\/assurances\/assurances-des-biens\/assurance-auto\" id=\"btn-realiser\"><div class=\"haut\"><\/div><h3>Simuler son tarif<br>Assurance Auto<\/h3><\/a><\/div>";
        strVar += "       <\/div>";

        $elem.append(strVar);
    }
});

$(function fixFirefoxPrint() {
    try {
        var $body = $("body");
        var isGoodPage = window.location.pathname.includes("/comptes-et-contrats/mes-assurances-vie");
        var isGoodUnivers = $body.is(".bpf") || $body.is(".part");
        var isGoodContext = isGoodPage && isGoodUnivers;

        if (!isGoodContext) { return; }

        window.CLEAR_ID_FIXFIREFOX_PRINT = window.setInterval(function fix() {
            var $canvas = $('.canvasLoader canvas').eq(0);
            var isNotEmpty = $canvas.length > 0;
            var hasNoWidthOrHeight = isNotEmpty && (($canvas.attr("height") == 0) || ($canvas.attr("width") == 0));

            if (!hasNoWidthOrHeight) {
                return;
            }

            if (hasNoWidthOrHeight) {
                $canvas
                    .attr("height", parseInt($canvas.attr("height"), 10) || 1)
                    .attr("width", parseInt($canvas.attr("width"), 10) || 1);
            }
        }, 500);
    } catch (error) {
        //
    }
});

$(function scrollToTop() {
    var $body = $('body');
    var $scrollToTop;

    if (!$body.is('.part, .pro')) {
        return;
    }

    $body.append('<div class="scroll-to-top-btn"><i class="icon icon-back"></i></div>');
    $scrollToTop = $('.scroll-to-top-btn');

    $(window).scroll(function() {
        if ($(this).scrollTop() > 100) {
            $scrollToTop.fadeIn();
        } else {
            $scrollToTop.fadeOut();
        }
    });

    $scrollToTop.click(function(event) { //Click event to scroll to top
        event.preventDefault();

        $('html, body').animate({ scrollTop: 0 }, 800);
    });
});

(function(strTest) {
    var f = function() {
        var isMobile = (function() {
            return (strTest.match(/Android/i) ||
                strTest.match(/webOS/i) ||
                strTest.match(/iPhone/i) ||
                strTest.match(/iPad/i) ||
                strTest.match(/iPod/i) ||
                strTest.match(/BlackBerry/i) ||
                strTest.match(/Windows Phone/i) ||
                strTest.match(/Opera Mini/i) ||
                strTest.match(/IEMobile/i)
            );
        })();

        isMobile && $("#fp_nav").closest("table").css({ tableLayout: 'fixed' });
    };

    $(f);
})(navigator.userAgent);


/* Ajout Script CELEBRUS */
function insertCelebrus() {
  if (ENVIRONNEMENT=="PREVIEW") {
    var folderName = "pprod"
  }
  else {
    var folderName = "prod"
  }
  var s=document.createElement("script");
  s.async=true;
  s.src="/rsc/contrib/script/celebrus/"+folderName+"/CelebrusDynamicInsert.js";
  var s2=document.getElementsByTagName("body")[0];
  s2.appendChild(s);
}
$(document).ready(function() {
    if (window.location.host == 'mabanque.bnpparibas' ||
        window.location.host == 'prev-m-wev1s1-apv1s1.canalnet-part.bnpparibas.net' ||
        window.location.host == 'prev-m-wev1s1-apv1s1.canalnet-bpf.bnpparibas.net' ||
        window.location.host == 'prev-m-wev1s1-apv1s1.canalnet-pro.bnpparibas.net') {
        insertCelebrus();
    }
});

// BPF - Integration de bandeau en background pour mobile
(function() {
    $(function() {
      if ((ENVIRONNEMENT == 'PREVIEW') || (ENVIRONNEMENT == 'PROD')) {
            if ($('body').hasClass('bpf') && $('body').hasClass('mob')) {
                var $_img = $('.level2.fpbpf_headerTop').next().find('img');
                if($_img.length!=0){
                    var imgSource = $_img .attr('src');
                    $('.level2.fpbpf_headerTop').css({
                        'background':"url("+imgSource+") no-repeat",
                        'background-size':'cover',
                        'position':'static'
                    })
                    $_img.css({"display":"none"});
                    $('.level2.fpbpf_headerTop').css({"padding-top":"35px"});
                    $('.level2.fpbpf_headerTop').css({"padding-bottom":"35px"});
                }
            }

        }
    });
})();

// BPF - centrage du bton play - ne fctionne pas - video appelée dans une iframe sur un autre domaine.
/*(function() {
    $(function() {
      if (ENVIRONNEMENT == 'PREVIEW') {
        console.log('centrage');
        console.log('player present');
        var bigPlayCenter = setInterval(function() {
            if($('.vjs-big-play-button').length > 0){
                $('body.bpf.preview #vjs_video_3 .bc-player-434f97c9-7d58-42de-b0d0-f3298071aa52_default.vjs-mouse .vjs-big-play-button').css({
                    'top:' : '35%',
                    'left': '35%'
                })
            }
        },500);
      }
   });
})();*/


// BPF - centrage du bton play - surcharge de librairie ne fctionne pas
/*(function() {
    $(function() {
        var pathname = window.location.pathname;
        console.log("pathname",pathname);
        if (pathname.match(/strategie-privee/) != null  {
            console.log("strategie-privee");
                $('head').append('<link href="//players.brightcove.net/videojs-overlay/1/videojs-overlay.css" rel="stylesheet">');
        }
   });
})();*/


$(function () { // Patch libellé Conseillé sous IE
    var $body = $('body');
    var isGoodBrowser = !$body.is('.not-ie');
    var isGoodEnv = true; //(window.ENVIRONNEMENT === "PREVIEW");
    var isGoodUnivers = $body.is('.part');
    var isGoodPage = window.location.pathname.includes("/fr/connexion/mes-outils/messagerie");
    var isGoodContext = isGoodBrowser && isGoodEnv && isGoodUnivers && isGoodPage;

    if (!isGoodContext) {
        return;
    }

    var wf = GlobalSite.waitFor.bind(GlobalSite);

    wf(function () {
       return $(".flt-conseiller").length > 0;
    }).then(function () {
        var $fltConseiller = $(".flt-conseiller");
        var $textNode = $fltConseiller.contents().filter(function () {
            return (this.nodeType === Node.TEXT_NODE) &&
                (
                    (/\{.*config\.app\.messagerie\.liste\.conseiller\.*}/.test($.trim(this.nodeValue))) ||
                    (/\{.*/.test($.trim(this.nodeValue))) ||
                    (/config\.app\.messagerie\.liste\.conseiller\.*}/.test($.trim(this.nodeValue)))
                );
        });
        if ($textNode.length > 0) {
            $textNode.each(function(){
                $(this).remove();
            });
            $fltConseiller.prepend("Conseiller");
        }
    }).fail(function (err) {
        console.log(err);
    });
});

// Test pour fixe modification code secret mobile
try {
    window.onload = (function () {
        var isGoodEnv;
        var isGoodPage;
        var isGoodDevice;
        var isGoodContext;
        var $iaModificationCodeSecret;
        var $confirmation;
        var wf;

        isGoodEnv = true /* window.ENVIRONNEMENT === "PREVIEW"*/;
        isGoodPage = window.location.pathname.includes("mes-outils/profil/code-secret");
        isGoodDevice = DeviceSize.getContentState() === "mobile";
        isGoodContext = isGoodEnv && isGoodPage && isGoodDevice;

        if (!isGoodContext) {
            return;
        }

        $iaModificationCodeSecret = $("#ia-modifiercodesecret");
        $iaModificationCodeSecret.hide();
        $(".confirmation.messageInfo")
            .append("<button class='btn-primary' id='yes-read-code-format'>J'ai lu</button>")
            .on("click", function (event) {
                $("#yes-read-code-format").remove();
                $iaModificationCodeSecret.show();
            });

        wf = GlobalSite.waitFor.bind(GlobalSite);
        wf(function () { // modification retour vers la page profil
            $confirmation = $(".validation-CS .container.code-secret .confirmation");
            return $confirmation.length > 0;
        }).then(function () {
            [$confirmation]
                .map(function ($elt) {
                    $elt
                        .find("button")
                        .remove();

                    return $elt;
                })
                .map(function ($elt) {
                    $elt.append(function () {
                        var $body = $("body");
                        var $linkHtml = $("<a href='#' class='btn-primary'>Retour à la liste de mes comptes</a>");

                        return $body.is(".part") && $linkHtml.attr("href", "/fr/connexion/comptes-et-contrats")
                            || $body.is(".bpf") && $linkHtml.attr("href", "/fr/espace-prive/comptes-et-contrats")
                            || $body.is(".pro") && $linkHtml.attr("href", "/fr/espace-pro/comptes-et-contrats");
                    } ());

                    return $elt;
                });
        }).fail(function (err) {
            console.log(err);
        });
    });
} catch (error) {
    //---
}

// En cours de dev
// BPF - Responsive Mobie - portrait-expert -> Disparition du bton retour au scroll
(function() {
    $(function() {

    var $body = $('body');
    var isGoodEnv = (window.ENVIRONNEMENT === "PREVIEW");
    var isGoodUnivers = $body.is('.bpf');
    var isGoodPage = window.location.pathname.includes("fr/portraits-dexperts/");
    var isGoodContext =  isGoodEnv && isGoodUnivers && isGoodPage;

    if (!isGoodContext) {
        //console.log('return');
        return;
    }
    var $_btReturn = $(".portraits-expert .portrait-return ");
    var wf = GlobalSite.waitFor.bind(GlobalSite);
    console.log("wf",wf);
    wf(function () {
         //console.log('$(".portraits-expert .portrait-return ").length :',$(".portrait-expert .portrait-return ").length );
       return $(".portrait-expert .portrait-return").length > 0;
    }).then(function () {
            //console.log('success');
            var $_headerPortraitExperts = $('header.header-page-contact-bpf.header-page');
            $('.portrait-expert .portrait-return').remove();
            $_headerPortraitExperts.empty();
            $('#header').after('<div class="col-100 portrait-return return-experts fixed">'
                            +'<a href="/fr/portraits-dexperts" class="text-fleche">Retour</a>'
                            /*+'<img src="/rsc/contrib/image/webzine/close.png">'*/
                        +'</div>');

        }).fail(function (err) {
                console.log(err);
        });
   });
})();
// BPF - UDC _ Ajout bannière statique Le saviez vous
// Ne pas supprimer même si en commentaire
// (function() {
//     $(function() {
//         if(window.ENVIRONNEMENT === "PROD")  {
//             if($('body').hasClass('bpf') && window.location.pathname.includes("/espace-prive/comptes-et-contrats") ){
//                 console.log('UDC');
//                 var static_banner_interval = setInterval(function() {
//                 if( $('.udc-liquidite').length !=0 ){
//                     clearInterval(static_banner_interval);
//                         $('.list-vue1.udc-liquidite').after('<a href="http://isf.fondationdefrance.org/?utm_source=bnp&amp;utm_medium=affiliation&amp;utm_campaign=isf" target="_blank" id="bpf-001-banner" class="bpf-nbo-banner">'
//                             +'<div id="zp_udc">'
//                             +   '<div class="banner banner-basic banner-basic--wide banner-basic--small banner-basic-verysmall">'
//                             +       '<div class="asset__container">'
//                             +           '<article class="banner-basic__container">'
//                             +               '<div class="banner-udc__lesaviezvous bpf-plafond-cartes">'
//                             +                   '<h3>Le saviez-vous ?</h3>'
//                             +                   '<p>Votre réduction ISF en partenariat avec la Fondation de France.</p>'
//                             +                   '<button class="pull-right" type="button">Découvrir</button>'
//                             +               '</div>'
//                             +           '</article>'
//                             +       '</div>'
//                             +    '</div>'
//                             +'</div>'
//                         +'</a>');
//                     }
//                 },1000);
//             }
//         }
//    });
// })();


// -------------
// #Fonction Ouverture layer BCOM
// Ajoute un layer explicatif offres collaborateur BCOM
function openBcom() {
    var check = $(document).getUrlParam('rc');
    var url = window.location.pathname;
    // exception pour Simu Auto : chargement page redirection spécifique
    if (check == "bcom") {
        $.getJSON('/rsc/contrib/script/client/redirectionsBcom.json', function (data) {
            $.each(data, function(key,val){
              if (url == key) {
                $('body').append("<div class='bcomBanner'><p>"+val+"</p><span class='close pull-right'>x</span></div>");
              }
            })
            $('.bcomBanner').find('.close').on('click',function(){
              $('.bcomBanner').addClass('hidden');
            })
        });
    }
};
// // -------------
// #Remplacement liens ancien vers nouvel espace bourse
function replaceLinkBourse() {
    $.getJSON('/rsc/contrib/script/client/redirectionsBourse.json', function (data) {
        $.each(data, function(key,val){
            $('a[href*="/notre-offre/epargne-et-bourse/"]').each(function() {
                var url = $(this).attr('href')
                url = url.replace(/^.*\/\/[^\/]+/, '')
                if (url == key) {
                    $(this).attr('href', val);
                }
            });
        })
    });
};
$(document).ready(function(){
    openBcom();
	replaceLinkBourse();
})
// -------------

// ------- BPF - BANQUE-CONTACT - SITE SECURISE : replacement des flèches de navigation
//=> DEBUT
$(function() {
    var $body = $('body');
    var isGoodEnv = (window.ENVIRONNEMENT === "PREVIEW") || (window.ENVIRONNEMENT === "PROD");
    var isGoodUnivers = $body.is('.bpf');
    var isGoodPage =
                     window.location.pathname.includes("banque-contact/nous-contacter") ||
                     window.location.pathname.includes("/nous-trouver/trouver-une-agence") ||
                     window.location.pathname.includes("/banque-contact/site-securise") ||
                     window.location.pathname.includes("engagement-chartes-et-conventions/banque-en-ligne-les-bonnes-pratiques") ||
                     window.location.pathname.includes("banque-contact/besoin-d-aide");

    var isGoodContext =  isGoodEnv && isGoodUnivers && isGoodPage;

    if (!isGoodContext) {
        console.log('return');
        return;
    }
    var wf = GlobalSite.waitFor.bind(GlobalSite);
    console.log("wf",wf);
    wf(function () {
        return $(".onglet-nav .onglet-pagination.unselectable").length > 0;
    }).then(function () {
        if((window.ENVIRONNEMENT === "PREVIEW") || (window.ENVIRONNEMENT === "PROD")){
            console.log('preview');
            $('.onglet-pagination').removeClass('unselectable hidden');
            $_onglet_pagination = $('.onglet-pagination');
            $_onglet_pagination.clone().appendTo('.header-page.has-onglet');
            $_onglet_pagination.remove();
            $_newPositionOnglet = $('.xml-section.level3.header-page.has-onglet .onglet-pagination')
            $_newPositionOnglet.removeClass('hidden unselectable');
            WrapperWidth = $("#wrapper").width();
            OngletPaginationWidth = $('.xml-section.level3.header-page.has-onglet .onglet-pagination').width();
            OngletPaginationLeft = WrapperWidth/2 - OngletPaginationWidth/2;
            $_newPositionOnglet.css("left", "0px");
        }
    }).fail(function (err) {
            console.log(err);
    });
});
//<= FIN


$(function correctifJsLoaderMata() {
    var isGoodUnivers;
    var isGoodPage;
    var isGoodContext;

    isGoodUnivers = $("body").is(".espace-client");
    isGoodPage = window.location.pathname.includes("mes-outils/profil/adresse-et-agence");
    isGoodContext = isGoodUnivers && isGoodPage;

    if (!isGoodContext) {
        return;
    }

    GlobalSite.waitFor(function () {
        return $("#demoPopin4").length > 0;
    }).then(function () {
        GlobalSite.initJsLoader();
    });
});


// NBO - BPF - Bannière calage 2 lignes : provisoire

$(function() {
    var $body = $('body');
    var isGoodEnv = (window.ENVIRONNEMENT === "PREVIEW") || (window.ENVIRONNEMENT === "PROD") ;
    var isGoodUnivers = $body.is('.bpf');
    /*var isGoodPage =
                     window.location.pathname.includes("banque-contact/nous-contacter") ||
                     window.location.pathname.includes("/nous-trouver/trouver-une-agence") ||
                     window.location.pathname.includes("/banque-contact/site-securise") ||
                     window.location.pathname.includes("engagement-chartes-et-conventions/banque-en-ligne-les-bonnes-pratiques") ||
                     window.location.pathname.includes("banque-contact/besoin-d-aide");*/

    var isGoodContext =  isGoodEnv && isGoodUnivers ;

    if (!isGoodContext) {
        console.log('return');
        return;
    }
    var wf = GlobalSite.waitFor.bind(GlobalSite);
    console.log("wf",wf);
    wf(function () {
        return $('body.bpf .banner-udc__lesaviezvous.bpf p').length > 0;
    }).then(function () {
        if( (window.ENVIRONNEMENT === "PREVIEW") || (window.ENVIRONNEMENT === "PROD") ){
            $_banner_2_lines_one = $('body.bpf #426-banner .banner-udc__lesaviezvous.bpf p');
            $_banner_2_lines_two = $('body.bpf #431-banner .banner-udc__lesaviezvous.bpf p');
            if ( $_banner_2_lines_one.length > 0){
                $_banner_2_lines_one.css("width", "61%");
                $_banner_2_lines_one.css("margin-top", "1.3%");
            }
            if ( $_banner_2_lines_two.length > 0){
                $_banner_2_lines_two.css("width", "61%");
                $_banner_2_lines_two.css("margin-top", "1.3%");
            }

        }
    }).fail(function (err) {
            console.log(err);
    });
});




$(window).on('load',function(){
    if ((typeClientPourMultilingue == "bpf") && (document.location.href.match(/assurance-vie/) != null)) {

        if (! ($('#wcm-l-bottom-header-connected').length >0) ){
          $('.xml-section.level3.table-cell h3:first').hide();
          $('.xml-section.level3.table-cell h3:eq(1) span:eq(0)').text('1');
        }
    }
});

/*

A NE PAS SUPPRIMER

// Start JS pre-footer
if (ENVIRONNEMENT == 'PREVIEW') {
	$(window).load(function(preFooter){
		$.ajax({
			cache: true,
			url: "/rsc/contrib/script/client/redirect-prefooter.json"
		})
		.then(function(_json){
			var currPath = window.location.pathname;
	      	var selectorForPage;
		  	var prefooterHtmlUrl;
		  	var result = false;
			var  len = _json.length;

			for(var idx = 0;  idx < len; idx++ ){
				result = (function(idx){
					var urlParams = _json[idx];
					var url = urlParams.url;
					var selector = urlParams.selector;
					var isActive = urlParams.active;
					var isUrlAuthorized = currPath.endsWith(url);
					var isSelectorVerified =  $(selector).length > 0;

					if(isSelectorVerified && isActive && isUrlAuthorized) {
						selectorForPage = selector;
						prefooterHtmlUrl = urlParams.prefooterHtmlUrl;
						return true;
					}
				})(idx);

				if(result) {
					break;
				}
			}

			if(result) {
				$.ajax({
					cache: true,
			  		url: prefooterHtmlUrl,
					dataType: "html"
			  	})
				.then(function(html){
					console.log({
						mess: "recup html + json",
						html: html,
			  	  json: _json,
	          selectorForPage: selectorForPage,
						result: result
					});
					$(selectorForPage).after(html);
				})
				.fail(function (error) {
					 console.log({
			  	        mess: "recup html + json",
	                selectorForPage: selectorForPage,
			  	        html: html,
			  	        json: _json,
			  	        result: result
					});
					console.log({ error: error });
				});
			}
		})
		.fail(function (error) {
			console.log({ error: error });
		});
	});
}

// End JS pre-footer

A NE PAS SUPPRIMER

*/

/* Pour liste indicateurs : START */
if (ENVIRONNEMENT == 'PREVIEW') {
	$(function(){
		$.ajax({
			cache: false,
			url: "/rsc/contrib/script/client/indicateurs.json",
			dataType: "json"
		})
		.then(function(pathsJson){
			var normalizepathName = function(pathname){
				return (pathname||"").split("/").filter(function(item){ return !!item }).join("/");
			};

			var currLocation = window.location;
			var listUrl = Object.keys(pathsJson);
			var testUri;
			var curseur;
			var hasSamePathName;
			var getListOfParams;
			var isArrayIncludes;
			var testResult;

			hasSamePathName = function(uri1, uri2){
				return normalizepathName(uri1.pathname) === normalizepathName(uri2.pathname);
			};

			getListOfParams = function(uri){ // ex: "http://a?toto=1&titi=2 => ["toto=1", "titi=2"]
			return uri.search.split("?").filter(function(item){ return !!item })[0].split("&");
		};

		isArrayIncludes = function(arr1,arr2){ // on vérifie si tous les elts de arr1 sont dans arr2
			return arr1.filter(function(item){ return arr2.indexOf(item) < 0 }).length === 0;
		};

		testUri = function(currentUri){
			var hasHash = !!currLocation.hash;
			var hasSearch = !!currLocation.search;
			var hasNoSearchAndNoHash = !hasHash && !hasSearch;
			var hasSearchAndNoHash = hasSearch && !hasHash;
			var hasSearchAndHash = hasHash && hasSearch;
			var hasNoSearchAndHash = !hasSearch && hasHash;

			// 4 cas
			// 1) pas de paramètre url ni de hash
			if(hasNoSearchAndNoHash){
				return hasSamePathName(currentUri, currLocation);
			}
			// 2) cas de paramètre et pas de hash
			if(hasSearchAndNoHash){
				if(!hasSamePathName(currentUri, currLocation)) {
					return false;
				}
			}
			return isArrayIncludes(getListOfParams(currentUri),getListOfParams(currLocation));
			// 3) cas pas de paramètre et hash
			if(hasNoSearchAndHash){
				if(!hasSamePathName(currentUri, currLocation)) {
					return false;
				}
				return currentUri.hash === currLocation.hash;
			}
			// 4) cas de paramètre et de hash
			if(hasHash && hasSearch){
				if(!hasSamePathName(currentUri, currLocation)) {
					return false;
				}

				if(!isArrayIncludes(getListOfParams(currentUri),getListOfParams(currLocation))){
					return false;
				}

				if(currentUri.hash !== currLocation.hash){
					return false;
				}

				return true;
			}
		};

		for(var i = 0; i < listUrl.length; i++ ){
			testResult = (function(i){
				var result = false;
				var currentUri = listUrl[i];
				var currHrefTool = document.createElement("a");
				currHrefTool.href = currentUri;

				if(testUri(currHrefTool)){
					(function action(){
						var key = "/" + currHrefTool.toString()
						.replace(currHrefTool.hostname,"")
						.replace(currHrefTool.protocol,"")
						.replace("//:","")
						.replace(currHrefTool.port,"")
						.split("/")
						.filter(function(item ){ return !!item })
						.join("/");

						var code = pathsJson[key];

						// on envoi le tag
						$.ajax({
							cache: false,
							url: "/cre-autonomy-wspl/rpc/trame/consultation/produitTelematique",
							data : {
								produit: code
							}
						}).then(function(response){
							console.log(response);
						}).fail(function (error) {
							console.log({ error: error });
						});

						console.log({
							key: key,
							code: code,
							currHrefTool: currHrefTool.toString(),
							currLocation: currLocation.toString(),
							testUri: testUri(currHrefTool)
						});
					})();
					return true;
				}
			})(i);

			if(testResult) {
				break;
			}
		}

		console.log({
			debug: "debug",
			listUrl: listUrl
		});
	})
	.fail(function (error) {
		console.log({ error: error });
	});
	});
}
/* Pour liste indicateurs : END */
